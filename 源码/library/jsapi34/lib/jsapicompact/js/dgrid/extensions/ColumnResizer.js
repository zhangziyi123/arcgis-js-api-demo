//>>built
define("dgrid/extensions/ColumnResizer",["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){function _a(_b,_c,_d,_e,id){for(var i=1;i<_c;i++){_b[_d+i][_e]=id;}};function _f(_10){var i=_10.length,l=i,_11=_10[0].length,_12=new Array(i);while(i--){_12[i]=new Array(_11);}var _13={};for(i=0;i<l;i++){var row=_12[i],_14=_10[i];for(var j=0,js=0;j<_11;j++){var _15=_14[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=_15.id;if(_15.rowSpan&&_15.rowSpan>1){_a(_12,_15.rowSpan,i,j,_15.id);}if(i>0&&_15.colSpan&&_15.colSpan>1){for(k=1;k<_15.colSpan;k++){row[++j]=_15.id;if(_15.rowSpan&&_15.rowSpan>1){_a(_12,_15.rowSpan,i,j,_15.id);}}}_13[_15.id]=_10[0][j].id;js++;}}return _13;};function _16(_17,_18,_19,_1a){if(_19<=0){return;}var _1b={grid:_17,columnId:_18,width:_19,bubbles:true,cancelable:true};if(_1a){_1b.parentType=_1a;}if(_2.emit(_17.headerNode,"dgrid-columnresize",_1b)){_19=(_19!=="auto"?(_19+"px"):_19)+";";var old=_17._columnStyles[_18],x=_17.styleColumn(_18,"width: "+_19);old&&old.remove();_17._columnStyles[_18]=x;return true;}};var _1c,_1d=0;var _1e={create:function(){_1c=_9("div.dgrid-column-resizer");},destroy:function(){_9(_1c,"!");_1c=null;},show:function(_1f){var pos=_6.position(_1f.domNode,true);_1c.style.top=pos.y+"px";_1c.style.height=pos.h+"px";_9(document.body,_1c);},move:function(x){_1c.style.left=x+"px";},hide:function(){_1c.parentNode.removeChild(_1c);}};return _1("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,gridWidth:null,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_1d++){_1e.create();}},destroy:function(){this.inherited(arguments);if(!--_1d){_1e.destroy();}},resizeColumnWidth:function(_20,_21){return _16(this,_20,_21);},configStructure:function(){this._resizedColumns=false;for(var _22 in this._columnStyles){this._columnStyles[_22].remove();}this._columnStyles={};this.inherited(arguments);},_configColumn:function(_23,_24){this.inherited(arguments);if("width" in _23){this.resizeColumnWidth(_24,_23.width);}},renderHeader:function(){this.inherited(arguments);var _25=this;_25.gridWidth=_25.headerNode.clientWidth-1;var _26;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){_26=_4.mixin(_26||{},_f(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){_26=_f(this.subRows);}}var _27=_3(".dgrid-cell",_25.headerNode),i=_27.length;while(i--){var _28=_27[i],id=_28.columnId,col=_25.columns[id],_29=_28.childNodes;if(!col||col.resizable===false){continue;}var _2a=_9("div.dgrid-resize-header-container");_28.contents=_2a;while(_29.length>0){_9(_2a,_29[0]);}_9(_28,_2a,"div.dgrid-resize-handle.resizeNode-"+id).columnId=_26?_26[id]:id;}if(!_25.mouseMoveListen){_2(_25.headerNode,".dgrid-resize-handle:mousedown"+(_7("touch")?",.dgrid-resize-handle:touchstart":""),function(e){_25._resizeMouseDown(e,this);_25.mouseMoveListen.resume();_25.mouseUpListen.resume();});_25.mouseMoveListen=_2.pausable(document,"mousemove"+(_7("touch")?",touchmove":""),_8.throttleDelayed(function(e){_25._updateResizerPosition(e);}));_25.mouseUpListen=_2.pausable(document,"mouseup"+(_7("touch")?",touchend":""),function(e){_25._resizeMouseUp(e);_25.mouseMoveListen.pause();_25.mouseUpListen.pause();});_25.mouseMoveListen.pause();_25.mouseUpListen.pause();}},_resizeMouseDown:function(e,_2b){e.preventDefault();_5.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);var pos=_6.position(this.bodyNode);this._targetCell=_3(".dgrid-column-"+_2b.columnId,this.headerNode)[0];this._updateResizerPosition(e);_1e.show(this);},_resizeMouseUp:function(e){if(!this._resizedColumns){var _2c=_3(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_2c=_2c.filter(function(_2d){var idx=_2d.columnId.split("-");return idx[0]=="0";});}else{if(this.subRows&&this.subRows.length>1){_2c=_2c.filter(function(_2e){return _2e.columnId.charAt(0)=="0";});}}var _2f=_2c.map(function(_30){return _30.offsetWidth;});_2c.forEach(function(_31,i){this.resizeColumnWidth(_31.columnId,_2f[i]);},this);this._resizedColumns=true;}_5.setSelectable(this.domNode,true);var _32=this._targetCell,_33=this._getResizeMouseLocation(e)-this._startX,_34=_32.offsetWidth+_33,obj=this._getResizedColumnWidths(),_35=obj.totalWidth,_36=obj.lastColId,_37=_3(".dgrid-column-"+_36,this.headerNode)[0].offsetWidth;if(_34<this.minWidth){_34=this.minWidth;}if(_16(this,_32.columnId,_34,e.type)){if(_32.columnId!=_36){if(_35+_33<this.gridWidth){_16(this,_36,"auto",e.type);}else{if(_37-_33<=this.minWidth){_16(this,_36,this.minWidth,e.type);}}this.resize();}}_1e.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _38=this._getResizeMouseLocation(e),_39=_38-this._startX,_3a=this._targetCell.offsetWidth,_3b=_38;if(_3a+_39<this.minWidth){_3b=this._startX-(_3a-this.minWidth);}_1e.move(_3b);},_getResizeMouseLocation:function(e){var _3c=0;if(e.pageX){_3c=e.pageX;}else{if(e.clientX){_3c=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return _3c;},_getResizedColumnWidths:function(){var _3d=0,_3e=_3(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_3e=_3e.filter(function(_3f){var idx=_3f.columnId.split("-");return idx[1]=="0";});}else{if(this.subRows&&this.subRows.length>1){_3e=_3e.filter(function(_40){return _40.columnId.charAt(0)=="0";});}}var i=_3e.length;if(!i){return {};}var _41=_3e[i-1].columnId;while(i--){_3d+=_3e[i].offsetWidth;}return {totalWidth:_3d,lastColId:_41};}});});