/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"url:esri/dijit/templates/AttributeInspector.html":"<div class=\"esriAttributeInspector\">\r\n    <div class=\"atiLayerName\" dojoAttachPoint=\"layerName\"></div>\r\n    <div class=\"atiAttributes\" dojoAttachPoint=\"attributeTable\"></div>\r\n    <div dojoAttachPoint=\"attachmentEditor\"></div>\r\n    <div class=\"atiEditorTrackingInfo\" dojoAttachPoint=\"editorTrackingInfoDiv\"></div>\r\n    <div class=\"atiButtons\" dojoAttachPoint=\"editButtons\">\r\n        <button  dojoType=\"dijit.form.Button\" class=\"atiButton atiDeleteButton\"  dojoAttachPoint=\"deleteBtn\" dojoAttachEvent=\"onClick: onDeleteBtn\" showLabel=\"true\" type=\"button\">${NLS_deleteFeature}</button>\r\n        <div class=\"atiNavButtons\" dojoAttachPoint=\"navButtons\">\r\n            <div class=\"atiNavMessage\" dojoAttachPoint=\"navMessage\"></div>\r\n            <button  dojoType=\"dijit.form.Button\" iconClass=\"atiButton atiFirstIcon\" dojoAttachPoint=\"firstFeatureButton\" dojoAttachEvent=\"onClick: onFirstFeature\" showLabel=\"false\" type=\"button\">${NLS_first}</button>\r\n            <button  dojoType=\"dijit.form.Button\" iconClass=\"atiButton atiPrevIcon\" dojoAttachPoint=\"prevFeatureButton\" dojoAttachEvent=\"onClick: onPreviousFeature\" showLabel=\"false\" type=\"button\">${NLS_previous}</button>\r\n            <button  dojoType=\"dijit.form.Button\" iconClass=\"atiButton atiNextIcon\" dojoAttachPoint=\"nextFeatureButton\" dojoAttachEvent=\"onClick: onNextFeature\" showLabel=\"false\" type=\"button\">${NLS_next}</button>\r\n            <button  dojoType=\"dijit.form.Button\" iconClass=\"atiButton atiLastIcon\" dojoAttachPoint=\"lastFeatureButton\" dojoAttachEvent=\"onClick: onLastFeature\" showLabel=\"false\" type=\"button\">${NLS_last}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("esri/dijit/AttributeInspector",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/sniff","dojo/_base/kernel","dojo/has","dojo/dom-style","dojo/dom-construct","esri/kernel","esri/lang","esri/domUtils","esri/layers/InheritedDomain","esri/layers/FeatureLayer","dojo/i18n!esri/nls/jsapi","dojo/fx","dojox/gfx","dijit/_Widget","dijit/_Templated","dijit/Editor","dijit/_editor/plugins/LinkDialog","dijit/_editor/plugins/TextColor","esri/dijit/editing/AttachmentEditor","esri/dijit/editing/Util","esri/tasks/query","dijit/form/DateTextBox","dijit/form/TextBox","dijit/form/NumberTextBox","dijit/form/FilteringSelect","dijit/form/NumberSpinner","dijit/form/Button","dijit/form/SimpleTextarea","dijit/Tooltip","dojo/data/ItemFileReadStore","dojox/date/islamic","dojox/date/islamic/Date","dojox/date/islamic/locale","dojo/text!esri/dijit/templates/AttributeInspector.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,fx,gfx,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24){var ATI=_1([_10,_11],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:true,templateString:_24,_navMessage:"( ${idx} ${of} ${numFeatures} )",onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},constructor:function(_25,_26){_2.mixin(this,_f.widgets.attributeInspector);_25=_25||{};if(!_25.featureLayer&&!_25.layerInfos){console.error("esri.AttributeInspector: please provide correct parameter in the constructor");}this._userIds={};if(_25.featureLayer&&_25.featureLayer.credential){var _27=_25.featureLayer.id;this._userIds[_27]=_25.featureLayer.credential.userId;}else{if(_25.layerInfos){var _28=_25.layerInfos;_3.forEach(_28,function(_29){if(_29.featureLayer){var _2a=_29.featureLayer.id;if(_29.featureLayer.credential){this._userIds[_2a]=_29.featureLayer.credential.userId;}if(_29.userId){this._userIds[_2a]=_29.userId;}}},this);}}this._datePackage=this._getDatePackage(_25);this._layerInfos=_25.layerInfos||[{featureLayer:_25.featureLayer,options:_25.options||[]}];this._aiConnects=[];this._selection=[];this._toolTips=[];this._numFeatures=0;this._featureIdx=0;this._currentLInfo=null;this._currentFeature=null;this._hideNavButtons=_25.hideNavButtons||false;},postCreate:function(){this._initLayerInfos();this._createAttachmentEditor();this.onFirstFeature();},destroy:function(){this._destroyAttributeTable();_3.forEach(this._aiConnects,_4.disconnect);delete this._aiConnects;if(this._attachmentEditor){this._attachmentEditor.destroy();delete this._attachmentEditor;}delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments);},refresh:function(){this._updateSelection();},first:function(){this.onFirstFeature();},last:function(){this.onLastFeature();},next:function(){this.onNextFeature();},previous:function(){this.onPreviousFeature();},showFeature:function(_2b,_2c){if(_2c){this._createOnlyFirstTime=true;}this._updateSelection([_2b],_2c);this._updateUI();},onLayerSelectionChange:function(_2d,_2e,_2f){this._createOnlyFirstTime=false;this._featureIdx=(_2f===_e.SELECTION_NEW)?0:this._featureIdx;this._updateSelection();this._updateUI();},onLayerSelectionClear:function(){if(!this._selection||this._selection.length<=0){return;}this._numFeatures=0;this._featureIdx=0;this._selection=[];this._currentFeature=null;this._currentLInfo=null;this._updateUI();},onLayerEditsComplete:function(_30,_31,_32,_33){_33=_33||[];if(_33.length){var _34=this._selection;var _35=_30.featureLayer.objectIdField;_3.forEach(_33,_2.hitch(this,function(del){_3.some(_34,_2.hitch(this,function(_36,idx){if(_36.attributes[_35]!==del.objectId){return false;}this._selection.splice(idx,1);return true;}));}));}_31=_31||[];if(_31.length){this._selection=_16.findFeatures(_31,_30.featureLayer);this._featureIdx=0;}var _37=this._numFeatures=this._selection?this._selection.length:0;if(_31.length){var _38=_37?this._selection[this._featureIdx]:null;if(_38){var _39=_38.getLayer();var _3a=_39.getEditCapabilities();if(!(_3a.canCreate&&!_3a.canUpdate)){this._showFeature(_38);}}}this._updateUI();},onFieldValueChange:function(_3b,_3c){_3c=(typeof _3c==="undefined")?null:_3c;var _3d=_3b.field;if(_3d.type==="esriFieldTypeDate"){_3c=(_3c&&_3c.getTime)?_3c.getTime():(_3c&&_3c.toGregorian?_3c.toGregorian().getTime():_3c);}if(this._currentFeature.attributes[_3d.name]===_3c){return;}var _3e=this._currentLInfo;var _3f=this._currentFeature;var _40=_3d.name;if(_40===_3e.typeIdField){var _41=this._findFirst(_3e.types,"id",_3c);var _42=_3e.fieldInfos;_3.forEach(_42,function(_43){_3d=_43.field;if(!_3d||_3d.name===_3e.typeIdField){return;}var _44=_43.dijit;var _45=this._setFieldDomain(_44,_41,_3d);if(_45&&_44){this._setValue(_44,_3f.attributes[_3d.name]+"");if(_44.isValid()===false){this._setValue(_44,null);}}},this);}this.onAttributeChange(_3f,_40,_3c);},onDeleteBtn:function(evt){this._deleteFeature();},onNextFeature:function(evt){this._onNextFeature(1);},onPreviousFeature:function(evt){this._onNextFeature(-1);},onFirstFeature:function(evt){this._onNextFeature(this._featureIdx*-1);},onLastFeature:function(evt){this._onNextFeature((this._numFeatures-1)-this._featureIdx);},_initLayerInfos:function(){var _46=this._layerInfos;this._editorTrackingInfos={};_3.forEach(_46,this._initLayerInfo,this);},_initLayerInfo:function(_47){var _48=_47.featureLayer;this._connect(_48,"onSelectionComplete",_2.hitch(this,"onLayerSelectionChange",_47));this._connect(_48,"onSelectionClear",_2.hitch(this,"onLayerSelectionClear",_47));this._connect(_48,"onEditsComplete",_2.hitch(this,"onLayerEditsComplete",_47));_47.showAttachments=_48.hasAttachments?(_b.isDefined(_47.showAttachments)?_47.showAttachments:true):false;_47.hideFields=_47.hideFields||[];_47.htmlFields=_47.htmlFields||[];_47.isEditable=_48.isEditable()?(_b.isDefined(_47.isEditable)?_47.isEditable:true):false;_47.typeIdField=_48.typeIdField;_47.layerId=_48.id;_47.types=_48.types;if(!_47.showGlobalID&&_48.globalIdField){_47.hideFields.push(_48.globalIdField);}if(!_47.showObjectID){_47.hideFields.push(_48.objectIdField);}var _49=this._getFields(_47.featureLayer);if(!_49){return;}var _4a=_47.fieldInfos||[];_4a=_3.map(_4a,function(_4b){return _2.mixin({},_4b);});if(!_4a.length){_49=_3.filter(_49,_2.hitch(this,function(_4c){return !this._isInFields(_4c.name,_47.hideFields);}));_47.fieldInfos=_3.map(_49,_2.hitch(this,function(_4d){var _4e=(this._isInFields(_4d.name,_47.htmlFields)?ATI.STRING_FIELD_OPTION_RICHTEXT:ATI.STRING_FIELD_OPTION_TEXTBOX);return {"fieldName":_4d.name,"field":_4d,"stringFieldOption":_4e};}));}else{_47.fieldInfos=_3.filter(_3.map(_4a,_2.hitch(this,function(_4f){var _50=_4f.stringFieldOption||(this._isInFields(_4f.fieldName,_47.htmlFields)?ATI.STRING_FIELD_OPTION_RICHTEXT:ATI.STRING_FIELD_OPTION_TEXTBOX);return _2.mixin(_4f,{"field":this._findFirst(_49,"name",_4f.fieldName),"stringFieldOption":_50});})),"return item.field;");}var _51=[];if(_48.editFieldsInfo){if(_48.editFieldsInfo.creatorField){_51.push(_48.editFieldsInfo.creatorField);}if(_48.editFieldsInfo.creationDateField){_51.push(_48.editFieldsInfo.creationDateField);}if(_48.editFieldsInfo.editorField){_51.push(_48.editFieldsInfo.editorField);}if(_48.editFieldsInfo.editDateField){_51.push(_48.editFieldsInfo.editDateField);}}this._editorTrackingInfos[_48.id]=_51;},_createAttachmentEditor:function(){this._attachmentEditor=null;var _52=this._layerInfos;var _53=_3.filter(_52,function(_54){return _54.showAttachments;});if(!_53||!_53.length){return;}this._attachmentEditor=new _15({"class":"atiAttachmentEditor"},this.attachmentEditor);this._attachmentEditor.startup();},_setCurrentLInfo:function(_55){var _56=this._currentLInfo?this._currentLInfo.featureLayer:null;var _57=_55.featureLayer;if(_56&&_56.id===_57.id&&!_56.ownershipBasedAccessControlForFeatures){var _58=_57.getEditCapabilities();if(!(_58.canCreate&&!_58.canUpdate)){return;}}this._currentLInfo=_55;this._createTable();},_updateSelection:function(_59,_5a){this._selection=_59||[];var _5b=this._layerInfos;_3.forEach(_5b,this._getSelection,this);var _5c=this._numFeatures=this._selection.length;var _5d=_5c?this._selection[this._featureIdx]:null;this._showFeature(_5d,_5a);},_getSelection:function(_5e){var _5f=_5e.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(_5f);},_updateUI:function(){var _60=this._numFeatures;var _61=this._currentLInfo;this.layerName.innerHTML=(!_61||_60===0)?this.NLS_noFeaturesSelected:(_61.featureLayer?_61.featureLayer.name:"");_8.set(this.attributeTable,"display",_60?"":"none");_8.set(this.editButtons,"display",_60?"":"none");_8.set(this.navButtons,"display",(!this._hideNavButtons&&(_60>1)?"":"none"));this.navMessage.innerHTML=_b.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);if(this._attachmentEditor){_8.set(this._attachmentEditor.domNode,"display",((_61&&_61.showAttachments)&&_60)?"":"none");}var _62=((_61&&_61.showDeleteButton===false)||!this._canDelete)?false:true;_8.set(this.deleteBtn.domNode,"display",_62?"":"none");if(this.domNode.parentNode&&this.domNode.parentNode.scrollTop>0){this.domNode.parentNode.scrollTop=0;}},_onNextFeature:function(_63){this._featureIdx+=_63;if(this._featureIdx<0){this._featureIdx=this._numFeatures-1;}else{if(this._featureIdx>=this._numFeatures){this._featureIdx=0;}}var _64=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(_64);this._updateUI();this.onNext(_64);},_deleteFeature:function(){this.onDelete(this._currentFeature);},_showFeature:function(_65,_66){if(!_65){return;}this._currentFeature=_65;var _67=_66?_66:_65.getLayer();var _68=_67.getEditCapabilities({feature:_65,userId:this._userIds[_67.id]});this._canUpdate=_68.canUpdate;this._canDelete=_68.canDelete;var _69=this._getLInfoFromFeatureLayer(_67);if(!_69){return;}this._setCurrentLInfo(_69);var _6a=_65.attributes;var _6b=this._findFirst(_69.types,"id",_6a[_69.typeIdField]);var _6c,_6d=null;var _6e=_69.fieldInfos;_3.forEach(_6e,function(_6f){_6d=_6f.field;_6c=_6f.dijit||null;if(!_6c){return;}var _70=this._setFieldDomain(_6c,_6b,_6d);var _71=_6a[_6d.name];_71=(_71&&_70&&_70.codedValues&&_70.codedValues.length)?(_70.codedValues[_71]?_70.codedValues[_71].name:_71):_71;if(!_b.isDefined(_71)){_71="";}if(_6c.declaredClass==="dijit.form.DateTextBox"){_71=(_71==="")?null:new Date(_71);}else{if(_6c.declaredClass==="dijit.form.FilteringSelect"){_6c._lastValueReported=null;_71=_6a[_6d.name]+"";}}try{this._setValue(_6c,_71);if(_6c.declaredClass==="dijit.form.FilteringSelect"&&_6c.isValid()===false){this._setValue(_6c,null);}}catch(error){_6c.set("displayedValue",this.NLS_errorInvalid,false);}},this);if(this._attachmentEditor&&_69.showAttachments){this._attachmentEditor.showAttachments(this._currentFeature);}var _72=_67.getEditSummary(_65);if(_72){this.editorTrackingInfoDiv.innerHTML=_72;_c.show(this.editorTrackingInfoDiv);}else{_c.hide(this.editorTrackingInfoDiv);}},_setFieldDomain:function(_73,_74,_75){if(!_73){return null;}var _76=_75.domain;if(_74&&_74.domains){if(_74.domains[_75.name]&&_74.domains[_75.name] instanceof _d===false){_76=_74.domains[_75.name];}}if(!_76){return null;}if(_76.codedValues&&_76.codedValues.length>0){_73.set("store",this._toStore(_3.map(_76.codedValues,function(_77){return {id:_77.code+="",name:_77.name};})));this._setValue(_73,_76.codedValues[0].code);}else{_73.constraints={min:_b.isDefined(_76.minValue)?_76.minValue:Number.MIN_VALUE,max:_b.isDefined(_76.maxValue)?_76.maxValue:Number.MAX_VALUE};this._setValue(_73,_73.constraints.min);}return _76;},_setValue:function(_78,_79){if(!_78.set){return;}_78._onChangeActive=false;_78.set("value",_79,true);_78._onChangeActive=true;},_getFields:function(_7a){var _7b=_7a._getOutFields();if(!_7b){return null;}var _7c=_7a.fields;return (_7b=="*")?_7c:_3.filter(_3.map(_7b,_2.hitch(this,"_findFirst",_7c,"name")),_b.isDefined);},_isInFields:function(_7d,_7e){if(!_7d||!_7e&&!_7e.length){return false;}return _3.some(_7e,function(_7f){return _7f.toLowerCase()===_7d.toLowerCase();});},_findFirst:function(_80,_81,_82){var _83=_3.filter(_80,function(_84){return _84.hasOwnProperty(_81)&&_84[_81]===_82;});return (_83&&_83.length)?_83[0]:null;},_getLInfoFromFeatureLayer:function(_85){var _86=_85?_85.id:null;return this._findFirst(this._layerInfos,"layerId",_86);},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=_9.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var _87=_9.create("tbody",null,this._attributes);var _88=this._currentFeature;var _89=this._currentLInfo;var _8a=this._findFirst(_89.types,"id",_88.attributes[_89.typeIdField]);var _8b=_89.fieldInfos;_3.forEach(_8b,_2.hitch(this,"_createField",_8a,_87),this);this._createOnlyFirstTime=false;},_createField:function(_8c,_8d,_8e){var _8f=this._currentLInfo;var _90=_8e.field;if(this._isInFields(_90.name,_8f.hideFields)){return;}if(this._isInFields(_90.name,this._editorTrackingInfos[_8f.featureLayer.id])){return;}var _91=_9.create("tr",null,_8d);var td=_9.create("td",{innerHTML:_8e.label||_90.alias||_90.name,"class":"atiLabel"},_91);td=_9.create("td",null,_91);var _92=null;var _93=false;if(_8e.customField){_9.place(_8e.customField.domNode||_8e.customField,_9.create("div",null,td),"first");_92=_8e.customField;}else{if(_8f.isEditable===false||_90.editable===false||_8e.isEditable===false||_90.type==="esriFieldTypeOID"||_90.type==="esriFieldTypeGlobalID"||(!this._canUpdate&&!this._createOnlyFirstTime)){_93=true;}}if(!_92&&(_8f.typeIdField&&_90.name.toLowerCase()==_8f.typeIdField.toLowerCase())){_92=this._createTypeField(_90,_8e,td);}else{if(!_92){_92=this._createDomainField(_90,_8e,_8c,td);}}if(!_92){switch(_90.type){case "esriFieldTypeString":_92=this._createStringField(_90,_8e,td);break;case "esriFieldTypeDate":_92=this._createDateField(_90,_8e,td);break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":_92=this._createIntField(_90,_8e,td);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":_92=this._createFltField(_90,_8e,td);break;default:_92=this._createStringField(_90,_8e,td);break;}}if(_8e.tooltip&&_8e.tooltip.length){this._toolTips.push(new _1f({connectId:[_92.id],label:_8e.tooltip}));}_92.onChange=_2.hitch(this,"onFieldValueChange",_8e);_92.set("disabled",_93);_8e.dijit=_92;},_createTypeField:function(_94,_95,_96){return new _1b({"class":"atiField",name:_94.alias||_94.name,store:this._toStore(_3.map(this._currentLInfo.types,function(_97){return {id:_97.id,name:_97.name};})),searchAttr:"name"},_9.create("div",null,_96));},_createDomainField:function(_98,_99,_9a,_9b){var _9c=_98.domain;if(_9a&&_9a.domains){if(_9a.domains[_98.name]&&_9a.domains[_98.name] instanceof _d===false){_9c=_9a.domains[_98.name];}}if(!_9c){return null;}if(_9c.codedValues){return new _1b({"class":"atiField",name:_98.alias||_98.name,searchAttr:"name",required:_98.nullable||false},_9.create("div",null,_9b));}else{return new _1c({"class":"atiField"},_9.create("div",null,_9b));}},_createStringField:function(_9d,_9e,_9f){var _a0={"class":"atiField",trim:true,maxLength:_9d.length};if(_9e.stringFieldOption===ATI.STRING_FIELD_OPTION_TEXTAREA){_a0["class"]+=" atiTextAreaField";return new _1e(_a0,_9.create("div",null,_9f));}else{if(_9e.stringFieldOption===ATI.STRING_FIELD_OPTION_RICHTEXT){_a0["class"]+=" atiRichTextField";_a0.height="100%";_a0.width="100%";_a0.plugins=_9e.richTextPlugins||["bold","italic","underline","foreColor","hiliteColor","|","justifyLeft","justifyCenter","justifyRight","justifyFull","|","insertOrderedList","insertUnorderedList","indent","outdent","|","createLink"];return new _12(_a0,_9.create("div",null,_9f));}else{return new _19(_a0,_9.create("div",null,_9f));}}},_createDateField:function(_a1,_a2,_a3){var _a4={"class":"atiField","trim":true};if(this._datePackage){_a4.datePackage=this._datePackage;}return new _18(_a4,_9.create("div",null,_a3));},_createIntField:function(_a5,_a6,_a7){return new _1a({"class":"atiField",constraints:{places:0},invalidMessage:this.NLS_validationInt,trim:true},_9.create("div",null,_a7));},_createFltField:function(_a8,_a9,_aa){return new _1a({"class":"atiField",trim:true,invalidMessage:this.NLS_validationFlt},_9.create("div",null,_aa));},_toStore:function(_ab){return new _20({data:{identifier:"id",label:"name",items:_ab}});},_connect:function(_ac,evt,_ad){this._aiConnects.push(_4.connect(_ac,evt,_ad));},_getDatePackage:function(_ae){if(_ae.datePackage===null){return null;}else{if(_ae.datePackage){return _ae.datePackage;}else{if(_6.locale==="ar"){return "dojox.date.islamic";}}}return null;},_destroyAttributeTable:function(){var _af=this._layerInfos;_3.forEach(_af,function(_b0){var _b1=_b0.fieldInfos;_3.forEach(_b1,function(_b2){var _b3=_b2.dijit;if(_b3){_b3._onChangeHandle=null;if(_b2.customField){return;}if(_b3.destroyRecursive){_b3.destroyRecursive();}else{if(_b3.destroy){_b3.destroy();}}}_b2.dijit=null;},this);},this);var _b4=this._toolTips;_3.forEach(_b4,function(_b5){_b5.destroy();delete _b5;});this._toolTips=[];if(this._attributes){_9.destroy(this._attributes);}}});_2.mixin(ATI,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});if(_7("extend-esri")){_2.setObject("dijit.AttributeInspector",ATI,_a);}return ATI;});