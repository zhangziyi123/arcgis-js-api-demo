/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define("esri/dijit/Bookmarks",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/kernel","dojo/has","dojo/keys","dojo/query","dojo/dom","dojo/dom-construct","dojo/dom-class","dojo/dom-geometry","dojo/i18n!esri/nls/jsapi","esri/kernel","esri/domUtils","esri/geometry/Extent","esri/dijit/BookmarkItem"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11){var BM=_1(null,{declaredClass:"esri.dijit.Bookmarks",constructor:function(_12,_13){this.map=_12.map;this.editable=_12.editable;this.initBookmarks=_12.bookmarks;this._clickHandlers=this._mouseOverHandlers=this._mouseOutHandlers=this._removeHandlers=this._editHandlers=[];this.bookmarkDomNode=_a.create("div");_b.add(this.bookmarkDomNode,"esriBookmarks");this.bookmarkTable=_a.create("table");_b.add(this.bookmarkTable,"esriBookmarkTable");this.bookmarkDomNode.appendChild(this.bookmarkTable);_13=_9.byId(_13);_13.appendChild(this.bookmarkDomNode);this._addInitialBookmarks();},onClick:function(){},onEdit:function(){},onRemove:function(){},addBookmark:function(_14){var _15;if(_14.declaredClass=="esri.dijit.BookmarkItem"){_15=_14;this.bookmarks.push(_15);}else{var _16=new _10(_14.extent);_15=new _11({name:_14.name,extent:_16});this.bookmarks.push(_15);}var _17;if(this.editable){var _18=_d.widgets.bookmarks;console.log(_18);var _19=_18.NLS_bookmark_edit;var _1a=_18.NLS_bookmark_remove;_17=_a.create("div",{innerHTML:"<div class='esriBookmarkLabel'>"+_14.name+"</div><div title='"+_1a+"' class='esriBookmarkRemoveImage'><br/></div><div title='"+_19+"' class='esriBookmarkEditImage'><br/></div>"});var _1b=_5.query(".esriBookmarkEditImage",_17)[0];var _1c=_5.query(".esriBookmarkRemoveImage",_17)[0];this._removeHandlers.push(_2.connect(_1c,"onclick",this,"_removeBookmark"));this._editHandlers.push(_2.connect(_1b,"onclick",this,"_editBookmarkLabel"));}else{_17=_a.create("div",{innerHTML:"<div class='esriBookmarkLabel' style='width: 210px;'>"+_14.name+"</div>"});}_b.add(_17,"esriBookmarkItem");var _1d;if(_14.extent.declaredClass=="esri.geometry.Extent"){_1d=_14.extent;}else{_1d=new _10(_14.extent);}var _1e=_5.query(".esriBookmarkLabel",_17)[0];this._clickHandlers.push(_2.connect(_1e,"onclick",_3.hitch(this,"_onClickHandler",_14)));this._mouseOverHandlers.push(_2.connect(_17,"onmouseover",function(){_b.add(this,"esriBookmarkHighlight");}));this._mouseOutHandlers.push(_2.connect(_17,"onmouseout",function(){_b.remove(this,"esriBookmarkHighlight");}));var _1f=this.bookmarkTable;var _20;if(this.editable){_20=_1f.rows.length-1;}else{_20=_1f.rows.length;}var _21=_1f.insertRow(_20);var _22=_21.insertCell(0);_22.appendChild(_17);},removeBookmark:function(_23){var i;var _24=_5.query(".esriBookmarkLabel",this.bookmarkDomNode);var _25=_4.filter(_24,function(_26){return _26.innerHTML==_23;});_4.forEach(_25,function(_27){_27.parentNode.parentNode.parentNode.parentNode.removeChild(_27.parentNode.parentNode.parentNode);});for(i=this.bookmarks.length-1;i>=0;i--){if(this.bookmarks[i].name==_23){this.bookmarks.splice(i,1);}}this.onRemove();},hide:function(){_f.hide(this.bookmarkDomNode);},show:function(){_f.show(this.bookmarkDomNode);},destroy:function(){this.map=null;_4.forEach(this._clickHandlers,function(_28,idx){_2.disconnect(_28);});_4.forEach(this._mouseOverHandlers,function(_29,idx){_2.disconnect(_29);});_4.forEach(this._mouseOutHandlers,function(_2a,idx){_2.disconnect(_2a);});_4.forEach(this._removeHandlers,function(_2b,idx){_2.disconnect(_2b);});_4.forEach(this._editHandlers,function(_2c,idx){_2.disconnect(_2c);});_a.destroy(this.bookmarkDomNode);},toJson:function(){var _2d=[];_4.forEach(this.bookmarks,function(_2e,idx){_2d.push(_2e.toJson());});return _2d;},_addInitialBookmarks:function(){if(this.editable){var _2f=_d.widgets.bookmarks;var _30=_2f.NLS_add_bookmark;var _31=_a.create("div",{innerHTML:"<div>"+_30+"</div>"});_b.add(_31,"esriBookmarkItem");_b.add(_31,"esriAddBookmark");this._clickHandlers.push(_2.connect(_31,"onclick",this,this._newBookmark));this._mouseOverHandlers.push(_2.connect(_31,"onmouseover",function(){_b.add(this,"esriBookmarkHighlight");}));this._mouseOutHandlers.push(_2.connect(_31,"onmouseout",function(){_b.remove(this,"esriBookmarkHighlight");}));var _32=this.bookmarkTable;var _33=_32.insertRow(0);var _34=_33.insertCell(0);_34.appendChild(_31);}this.bookmarks=[];_4.forEach(this.initBookmarks,function(_35,idx){this.addBookmark(_35);},this);},_removeBookmark:function(e){this.bookmarks.splice(e.target.parentNode.parentNode.parentNode.rowIndex,1);e.target.parentNode.parentNode.parentNode.parentNode.removeChild(e.target.parentNode.parentNode.parentNode);this.onRemove();},_editBookmarkLabel:function(e){var _36=e.target.parentNode;var _37=_c.position(_36,true);var y=_37.y;var _38=_a.create("div",{innerHTML:"<input type='text' class='esriBookmarkEditBox' style='left:"+_37.x+"px; top:"+y+"px;'/>"});this._inputBox=_5.query("input",_38)[0];this._label=_5.query(".esriBookmarkLabel",_36)[0];var _39=_d.widgets.bookmarks;var _3a=_39.NLS_new_bookmark;if(this._label.innerHTML==_3a){this._inputBox.value="";}else{this._inputBox.value=this._label.innerHTML;}_2.connect(this._inputBox,"onkeyup",this,function(key){switch(key.keyCode){case _7.ENTER:this._finishEdit();break;default:break;}});_2.connect(this._inputBox,"onblur",this,"_finishEdit");_36.appendChild(_38);this._inputBox.focus();},_finishEdit:function(){this._inputBox.parentNode.parentNode.removeChild(this._inputBox.parentNode);var _3b=_d.widgets.bookmarks;var _3c=_3b.NLS_new_bookmark;if(this._inputBox.value==""){this._label.innerHTML=_3c;}else{this._label.innerHTML=this._inputBox.value;}var _3d=_5.query(".esriBookmarkLabel",this.bookmarkDomNode);_4.forEach(this.bookmarks,function(_3e,idx){_3e.name=_3d[idx].innerHTML;});this.onEdit();},_newBookmark:function(){var map=this.map,_3f=_d.widgets.bookmarks,_40=_3f.NLS_new_bookmark,_41=map.extent,_42;if(map.spatialReference._isWrappable()){var _43=_10.prototype._normalizeX(_41.xmin,map.spatialReference._getInfo()).x;var _44=_10.prototype._normalizeX(_41.xmax,map.spatialReference._getInfo()).x;if(_43>_44){var _45=map.spatialReference.isWebMercator(),_46=_45?20037508.342788905:180,_47=_45?-20037508.342788905:-180,_48,_49;if(Math.abs(_43-_46)>Math.abs(_44-_47)){_48=_43;_49=_46;}else{_48=_47;_49=_44;}_42=new _10(_48,_41.ymin,_49,_41.ymax,map.spatialReference);}else{_42=new _10(_43,_41.ymin,_44,_41.ymax,map.spatialReference);}}else{_42=_41;}var _4a=new _11({"name":_40,"extent":_42});this.addBookmark(_4a);var _4b=_5.query(".esriBookmarkItem",this.bookmarkDomNode);var _4c=_4b[_4b.length-2];var e={"target":{"parentNode":null}};e.target.parentNode=_4c;this._editBookmarkLabel(e);},_onClickHandler:function(_4d){var _4e=_4d.extent;if(!_4d.extent.declaredClass){_4e=new _10(_4d.extent);}this.map.setExtent(_4e);this.onClick();}});if(_6("extend-esri")){_3.setObject("dijit.Bookmarks",BM,_e);}return BM;});