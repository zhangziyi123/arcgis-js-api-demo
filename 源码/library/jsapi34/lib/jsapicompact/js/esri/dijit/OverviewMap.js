/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"url:esri/dijit/templates/OverviewMap.html":"<div class=\"esriOverviewMap\">\r\n  <div class=\"ovwContainer\" dojoattachpoint=\"_body\" style=\"width: ${width}px; height: ${height}px;\">\r\n    <div id=\"${id}-map\" style=\"width: 100%; height: 100%;\">\r\n      <div class=\"ovwHighlight\" dojoattachpoint=\"_focusDiv\" title=\"${NLS_drag}\" style=\"border: 1px solid ${color}; background-color: ${color};\"></div>\r\n    </div>\r\n  </div>\r\n  <div class=\"ovwButton ovwController\" title=\"${NLS_show}\" dojoattachpoint=\"_controllerDiv\" dojoattachevent=\"onclick: _visibilityHandler\">\r\n  </div>\r\n  <div class=\"ovwButton ovwMaximizer\" title=\"${NLS_maximize}\" dojoattachpoint=\"_maximizerDiv\" dojoattachevent=\"onclick: _maximizeHandler\">\r\n  </div>\r\n</div>\r\n"}});define("esri/dijit/OverviewMap",["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/html","dojo/has","dojo/sniff","dojo/dom-class","dojo/dom-style","dojo/dnd/Moveable","dijit/_Widget","dijit/_Templated","esri/map","esri/geometry/Point","esri/geometry/ScreenPoint","esri/layers/TiledMapServiceLayer","esri/layers/DynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/virtualearth/VETiledLayer","esri/kernel","esri/config","esri/domUtils","dojo/text!esri/dijit/templates/OverviewMap.html","dojo/i18n!esri/nls/jsapi"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b){var OM=_2([_b,_c],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:true,templateString:_1a,basePath:_1.toUrl("esri/dijit")+"/",constructor:function(_1c,_1d){_3.mixin(this,_1b.widgets.overviewMap);_1c=_1c||{};if(!_1c.map){console.error("esri.dijit.OverviewMap: "+this.NLS_noMap);return;}var _1e={};if(_1d){this._detached=true;_1e=_5.coords(_1d,true);}this.map=_1c.map;this.baseLayer=_1c.baseLayer;this.width=_1c.width||_1e.w||this.map.width/4;this.height=_1c.height||_1e.h||this.map.height/4;this.attachTo=_1c.attachTo||"top-right";this.expandFactor=_1c.expandFactor||2;this.color=_1c.color||"#000000";this.opacity=_1c.opacity||0.5;this.maximizeButton=!!_1c.maximizeButton;this.visible=!!_1c.visible;this._mainMapLayer=this.map.getLayer(this.map.layerIds[0]);if(!this._mainMapLayer){console.error("esri.dijit.OverviewMap: "+this.NLS_noLayer);return;}var _1f=this.baseLayer||this._mainMapLayer;var _20=this.map.spatialReference,_21=_1f.spatialReference;if((_21.wkid!==_20.wkid)&&(_21.wkt!==_20.wkt)){console.error("esri.dijit.OverviewMap: "+this.NLS_invalidSR);return;}var _22=_1f.declaredClass;if(_1f instanceof _10){if(_1c.baseLayer){this.baseLayer=_1c.baseLayer;}else{if(_22.indexOf("VETiledLayer")!==-1){this.baseLayer=new _16({resourceInfo:_1f.getResourceInfo(),culture:_1f.culture,mapStyle:_1f.mapStyle,bingMapsKey:_1f.bingMapsKey});}else{if(_22.indexOf("OpenStreetMapLayer")!==-1){this.baseLayer=new _15({tileServers:_1f.tileServers});}else{if(_22.indexOf("WebTiledLayer")!==-1){var _23=_1f.initialExtent,_24=_1f.fullExtent,_25=_1f.tileInfo;this.baseLayer=new _1f.constructor(_1f.urlTemplate,{initialExtent:_23&&new _23.constructor(_23.toJson()),fullExtent:_24&&new _24.constructor(_24.toJson()),tileInfo:_25&&new _25.constructor(_25.toJson()),tileServers:_1f.tileServers&&_1f.tileServers.slice(0)});}else{this.baseLayer=new _12(_1f.url,{resourceInfo:_1f.getResourceInfo()});}}}}}else{if(_1f instanceof _11){if(_1c.baseLayer){this.baseLayer=_1c.baseLayer;}else{if(_22.indexOf("ArcGISImageServiceLayer")!==-1){this.baseLayer=new _14(_1f.url);}else{this.baseLayer=new _13(_1f.url);this.baseLayer.setImageFormat("png24");}}}else{console.error("esri.dijit.OverviewMap: "+this.NLS_invalidType);return;}}if(this._detached){this.visible=true;}this._maximized=false;},startup:function(){this.inherited(arguments);if(_6("ie")){if(!this.domNode.parentElement){this.map.container.appendChild(this.domNode);}}else{if(!this.domNode.parentNode){this.map.container.appendChild(this.domNode);}}if(this._detached){_9.set(this._body,"display","block");_9.set(this._controllerDiv,"display","none");_9.set(this._maximizerDiv,"display","none");if(this.baseLayer.loaded){this._initialize();}else{_4.connect(this.baseLayer,"onLoad",this,this._initialize);}}else{if(this.attachTo.split("-")[0]==="bottom"){this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv);}if(!this.maximizeButton){_8.add(this._maximizerDiv,"ovwDisabledButton");}_8.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]);_8.add(this._controllerDiv,"ovwShow");_8.add(this._maximizerDiv,"ovwMaximize");if(this.visible){var _26=function(){this.visible=false;this.show();};if(this.baseLayer.loaded){_26.call(this);}else{_4.connect(this.baseLayer,"onLoad",this,_26);}}}_9.set(this._focusDiv,"opacity",this.opacity);},destroy:function(){this._deactivate();if(this.overviewMap){this.overviewMap.destroy();}this.overviewMap=this.baseLayer=null;this.inherited(arguments);},resize:function(_27){if(!_27||_27.w<=0||_27.h<=0){return;}this._resize(_27.w,_27.h);},show:function(){if(!this.visible){var div=this._controllerDiv;div.title=this.NLS_hide;_8.remove(div,"ovwShow");_8.add(div,"ovwHide");_19.show(this._body);_19.show(this._maximizerDiv);this._initialize();this.visible=true;}},hide:function(){if(this.visible){var div=this._controllerDiv;div.title=this.NLS_show;_8.remove(div,"ovwHide");_8.add(div,"ovwShow");if(this._maximized){this._maximizeHandler();}_19.hide(this._body);_19.hide(this._maximizerDiv);this._deactivate();this.visible=false;}},_visibilityHandler:function(){if(this.visible){this.hide();}else{this.show();}},_maximizeHandler:function(){var div=this._maximizerDiv;if(this._maximized){div.title=this.NLS_maximize;_8.remove(div,"ovwRestore");_8.add(div,"ovwMaximize");this._resize(this.width,this.height);}else{div.title=this.NLS_restore;_8.remove(div,"ovwMaximize");_8.add(div,"ovwRestore");this._resize(this.map.width,this.map.height);}this._maximized=!this._maximized;},_resize:function(_28,_29){_9.set(this._body,{width:_28+"px",height:_29+"px"});var _2a=_18.defaults.map.panDuration,_2b=this.overviewMap;_18.defaults.map.panDuration=0;_2b.resize(true);_2b.centerAt(this._focusExtent.getCenter());_18.defaults.map.panDuration=_2a;},_initialize:function(){if(!this.overviewMap){var _2c;_2c=(this.overviewMap=new _d(this.id+"-map",{slider:false,showAttribution:false,logo:false,lods:this._overviewLods,wrapAround180:this.map.wrapAround180}));_4.connect(_2c,"onLoad",this,function(){this._map_resize_override=_3.hitch(_2c,this._map_resize_override);_2c.disableMapNavigation();this._activate();});_2c.addLayer(this.baseLayer);}else{this._activate();}},_activate:function(){var map=this.map,_2d=this.overviewMap;this._moveableHandle=new _a(this._focusDiv);this._soeConnect=_4.connect(map,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=_4.connect(map,"onPan",this,this._updateFocus);this._oecConnect=_4.connect(_2d,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=_4.connect(_2d,"onPan",this,this._ovwPanHandler);this._ozsConnect=_4.connect(_2d,"onZoomStart",this,function(){_19.hide(this._focusDiv);});this._ozeConnect=_4.connect(_2d,"onZoomEnd",this,function(){_19.show(this._focusDiv);});this._omsConnect=_4.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(map.extent,null,null,null);},_deactivate:function(){_4.disconnect(this._soeConnect);_4.disconnect(this._ufoConnect);_4.disconnect(this._oecConnect);_4.disconnect(this._opaConnect);_4.disconnect(this._ozsConnect);_4.disconnect(this._ozeConnect);_4.disconnect(this._omsConnect);if(this._moveableHandle){this._moveableHandle.destroy();}},_syncOverviewMap:function(ext,_2e,_2f,lod){if(this._suspendPanHandling){this._suspendPanHandling=false;return;}this._focusExtent=ext;this.overviewMap.setExtent(ext.expand(this.expandFactor),true);},_updateFocus:function(ext){if(this._suspendPanHandling){return;}this._focusExtent=ext;this._drawFocusDiv(ext);},_drawFocusDiv:function(ext,_30){var _31=this.overviewMap;var tl=_31.toScreen(new _e(ext.xmin,ext.ymax,_31.spatialReference));var br=_31.toScreen(new _e(ext.xmax,ext.ymin,_31.spatialReference));var _32=br.x-tl.x,_33=br.y-tl.y,_34=true;if((_32>this.overviewMap.width)&&(_33>this.overviewMap.height)){_34=false;}_9.set(this._focusDiv,{left:tl.x+(_30?_30.x:0)+"px",top:tl.y+(_30?_30.y:0)+"px",width:_32+"px",height:_33+"px",display:_34?"block":"none"});},_moveStopHandler:function(evt){var _35=this._moveableHandle.node.style;var ext=this._focusExtent;var _36=this.overviewMap;var _37=_36.toMap(new _f(parseInt(_35.left,10),parseInt(_35.top,10)));var _38=new _e(ext.xmin,ext.ymax,_36.spatialReference);this._focusExtent=ext.offset(_37.x-_38.x,_37.y-_38.y);if(this._maximized){this._maximizeHandler();}else{_36.centerAt(this._focusExtent.getCenter());}this._suspendPanHandling=true;this.map.setExtent(this._focusExtent);},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent);},_ovwPanHandler:function(ext,_39){this._drawFocusDiv(this._focusExtent,_39);}});if(_6("extend-esri")){_3.setObject("dijit.OverviewMap",OM,_17);}return OM;});