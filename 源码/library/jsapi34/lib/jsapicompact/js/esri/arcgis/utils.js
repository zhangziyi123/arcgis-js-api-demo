/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"esri/layers/OnDemandMode":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/geometry/Point","esri/tasks/query","esri/layers/RenderMode","esri/layers/GridLayout"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var _b=_1([_9],{declaredClass:"esri.layers._OnDemandMode",constructor:function(_c){this.featureLayer=_c;this._featureMap={};this._queryErrorHandler=_3.hitch(this,this._queryErrorHandler);},initialize:function(_d){this.inherited(arguments);var _e=this.featureLayer,_f=_e._srInfo;this._gridLayer=new _a(new _7(_f?_f.valid[0]:_d.extent.xmin,_d.extent.ymax,_d.spatialReference),{width:_e._tileWidth,height:_e._tileHeight},{width:_d.width,height:_d.height},_f);this._cellMap={};this._gridLayer.setResolution(_d.extent);},startup:function(){this._ioQueue=[];if(!this.featureLayer.suspended){this._zoomHandler();this._enableConnectors();}},propertyChangeHandler:function(_10){if(this._init){if(_10<2){this._zoomHandler();}else{console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id = "+this.featureLayer.id+", Layer URL = "+this.featureLayer.url);}}},destroy:function(){this._disableConnectors();this.inherited(arguments);},drawFeature:function(_11){var _12=this._gridLayer,_13=_11.geometry,_14=[];if(!_13){return;}_14=_12.getCellsInExtent((_13.type==="point")?{xmin:_13.x,ymin:_13.y,xmax:_13.x,ymax:_13.y}:_13.getExtent(),false).cells;var _15=this._cellMap,i,_16,oid=_11.attributes[this.featureLayer.objectIdField],_17,row,col;for(i=0;i<_14.length;i++){_16=_14[i];_17=_16.latticeID;row=_16.row;col=_16.col;if(_17){_16=(_15[_17]=(_15[_17]||_16));}else{_15[row]=_15[row]||{};_16=(_15[row][col]=(_15[row][col]||_16));}_16.features=_16.features||[];_16.features.push(_11);this._addFeatureIIf(oid,_11);this._incRefCount(oid);}},suspend:function(){if(!this._init){return;}this._disableConnectors();},resume:function(){if(!this._init){return;}this._enableConnectors();this._zoomHandler();},refresh:function(){this._zoomHandler();},_enableConnectors:function(){var map=this.map;this._zoomConnect=_2.connect(map,"onZoomEnd",this,this._zoomHandler);this._panConnect=_2.connect(map,"onPanEnd",this,this._panHandler);this._resizeConnect=_2.connect(map,"onResize",this,this._panHandler);},_disableConnectors:function(){_2.disconnect(this._zoomConnect);_2.disconnect(this._panConnect);_2.disconnect(this._resizeConnect);},_zoomHandler:function(){this._processIOQueue(true);var _18=this.featureLayer,map=this.map;if(_18.suspended){return;}_18._fireUpdateStart();this._clearIIf();var _19=_18._trackManager;if(_19){_19.clearTracks();}this._cellMap={};this._gridLayer.setResolution(map.extent);this._sendRequest();},_panHandler:function(){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&arguments[0]);},_getRequestId:function(_1a,_1b){var id="_"+_1a.name+_1a.layerId+_1a._ulid+"_"+_1b.resolution+"_"+(_1b.latticeID||(_1b.row+"_"+_1b.col));return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_sendRequest:function(_1c){this._exceeds=false;var _1d=this.featureLayer,map=this.map,_1e=_1c||map.extent,_1f=this._gridLayer.getCellsInExtent(_1e,_1d.latticeTiling),_20=_1f.cells;if(!_1d.isEditable()){var _21=this._cellMap;_20=_4.filter(_20,function(_22){if(_22.lattice){if(_21[_22.latticeID]){return false;}}else{if(_21[_22.row]&&_21[_22.row][_22.col]){return false;}}return true;});}var _23=_1d._getOutFields(),_24=_1d.getDefinitionExpression(),_25=_1d._getOffsettedTE(_1d._mapTimeExtent),_26=_1d._usePatch,_27=this._ioQueue,i,_28=this,_29=this._drawFeatures,_2a,_2b,_2c;this._pending=this._pending||0;for(i=0;i<_20.length;i++){_2a=_20[i];_2b=new _8();_2b.geometry=_2a.extent||_2a.lattice;_2b.outFields=_23;_2b.where=_24;if(_1d.latticeTiling&&_2a.extent){_2b.spatialRelationship=_8.SPATIAL_REL_CONTAINS;}_2b.returnGeometry=true;_2b.timeExtent=_25;_2b.maxAllowableOffset=_1d._maxOffset;if(_1d._ts){_2b._ts=(new Date()).getTime();}_2c=null;if(_26){_2c=this._getRequestId(_1d,_2a);if(this._isPending(_2c)){continue;}}this._pending++;_27.push(_1d._task.execute(_2b,function(){var _2d=_2a;return function(_2e){_29.apply(_28,[_2e,_2d]);};}.call(this),this._queryErrorHandler,_2c));}this._removeOldCells(_1e);this._endCheck();},_drawFeatures:function(_2f,_30){this._exceeds=this._exceeds||_2f.exceededTransferLimit;this._finalizeIO();var _31=this.featureLayer,map=this.map,_32=map.extent,_33=_30.extent,row=_30.row,col=_30.col,_34=_31.objectIdField,_35=_2f.features,_36=this._gridLayer,_37=this._cellMap,i,len,_38=_30.latticeID,_39=_38?_37[_38]:(_37[row]&&_37[row][col]);if((_30.resolution!=_36._resolution)||(_38?(_38!==_36.getLatticeID(_32)):(!_36.intersects(_33,_32)))){if(_39){this._removeCell(row,col,_38);}}else{if(_39){this._updateCell(_39,_35);}else{_30.features=_35;if(_38){_37[_38]=_30;}else{_37[row]=_37[row]||{};_37[row][col]=_30;}len=_35.length;for(i=0;i<len;i++){var _3a=_35[i];var oid=_3a.attributes[_34];this._addFeatureIIf(oid,_3a);this._incRefCount(oid);}}}this._endCheck();},_queryErrorHandler:function(err){this._finalizeIO();this.featureLayer._errorHandler(err);this._endCheck(true);},_finalizeIO:function(){this._purgeRequests();this._pending--;},_endCheck:function(_3b){if(this._pending===0){this._processIOQueue();var _3c=this.featureLayer,_3d=_3c._trackManager;if(_3d){_3d.clearTracks();_3d.addFeatures(_3c.graphics);if(_3c._ager){_4.forEach(_3c.graphics,function(_3e){if(_3e._shape){_3c._repaint(_3e);}});}_3d.moveLatestToFront();_3d.drawTracks();}this.featureLayer._fireUpdateEnd(_3b&&new Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:true}:null);if(this._exceeds){_3c.onQueryLimitExceeded();}}},_processIOQueue:function(_3f){this._ioQueue=_4.filter(this._ioQueue,function(dfd){var _40=dfd.fired>-1?false:true;return _40;});if(_3f){_4.forEach(this._ioQueue,this._cancelPendingRequest);}},_removeOldCells:function(_41){var _42=this._cellMap,_43=this._gridLayer,_44,_45;for(_44 in _42){if(_42[_44]){var row=_42[_44],_46=row.latticeID,_47=0,_48=0;if(_46){_47++;if(_46!==_43.getLatticeID(_41)){this._removeCell(null,null,_46);_48++;}}else{for(_45 in row){if(row[_45]){_47++;var _49=row[_45].extent;if(!_43.intersects(_49,_41)){this._removeCell(_44,_45);_48++;}}}}if(_48===_47){delete _42[_44];}}}},_updateCell:function(_4a,_4b){var _4c=this.featureLayer,_4d=_4c.objectIdField,_4e=_4c._selectedFeatures,i,len=_4b.length;_4a.features=_4a.features||[];for(i=0;i<len;i++){var _4f=_4b[i];var oid=_4f.attributes[_4d];var _50=this._addFeatureIIf(oid,_4f);if(_50===_4f){this._incRefCount(oid);_4a.features.push(_50);}else{if(!(oid in _4e)){_50.setGeometry(_4f.geometry);_50.setAttributes(_4f.attributes);}}}},_removeCell:function(row,col,_51){var _52=this._cellMap,_53=this.featureLayer,_54=_53.objectIdField;var _55=_51?_52[_51]:(_52[row]&&_52[row][col]);if(_55){if(_51){delete _52[_51];}else{delete _52[row][col];}var _56=_55.features,i;for(i=0;i<_56.length;i++){var _57=_56[i];var oid=_57.attributes[_54];this._decRefCount(oid);if(oid in _53._selectedFeatures){continue;}this._removeFeatureIIf(oid);}}}});if(_5("extend-esri")){_3.setObject("layers._OnDemandMode",_b,_6);}return _b;});},"dijit/a11y":function(){define("dijit/a11y",["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-style","dojo/sniff","./main"],function(_58,_59,_5a,dom,_5b,_5c,has,_5d){var _5e=(_5d._isElementShown=function(_5f){var s=_5c.get(_5f);return (s.visibility!="hidden")&&(s.visibility!="collapsed")&&(s.display!="none")&&(_5b.get(_5f,"type")!="hidden");});_5d.hasDefaultTabStop=function(_60){switch(_60.nodeName.toLowerCase()){case "a":return _5b.has(_60,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return true;case "iframe":var _61;try{var _62=_60.contentDocument;if("designMode" in _62&&_62.designMode=="on"){return true;}_61=_62.body;}catch(e1){try{_61=_60.contentWindow.document.body;}catch(e2){return false;}}return _61&&(_61.contentEditable=="true"||(_61.firstChild&&_61.firstChild.contentEditable=="true"));default:return _60.contentEditable=="true";}};var _63=(_5d.isTabNavigable=function(_64){if(_5b.get(_64,"disabled")){return false;}else{if(_5b.has(_64,"tabIndex")){return _5b.get(_64,"tabIndex")>=0;}else{return _5d.hasDefaultTabStop(_64);}}});_5d._getTabNavigable=function(_65){var _66,_67,_68,_69,_6a,_6b,_6c={};function _6d(_6e){return _6e&&_6e.tagName.toLowerCase()=="input"&&_6e.type&&_6e.type.toLowerCase()=="radio"&&_6e.name&&_6e.name.toLowerCase();};var _6f=function(_70){for(var _71=_70.firstChild;_71;_71=_71.nextSibling){if(_71.nodeType!=1||(has("ie")<=9&&_71.scopeName!=="HTML")||!_5e(_71)){continue;}if(_63(_71)){var _72=+_5b.get(_71,"tabIndex");if(!_5b.has(_71,"tabIndex")||_72==0){if(!_66){_66=_71;}_67=_71;}else{if(_72>0){if(!_68||_72<_69){_69=_72;_68=_71;}if(!_6a||_72>=_6b){_6b=_72;_6a=_71;}}}var rn=_6d(_71);if(_5b.get(_71,"checked")&&rn){_6c[rn]=_71;}}if(_71.nodeName.toUpperCase()!="SELECT"){_6f(_71);}}};if(_5e(_65)){_6f(_65);}function rs(_73){return _6c[_6d(_73)]||_73;};return {first:rs(_66),last:rs(_67),lowest:rs(_68),highest:rs(_6a)};};_5d.getFirstInTabbingOrder=function(_74,doc){var _75=_5d._getTabNavigable(dom.byId(_74,doc));return _75.lowest?_75.lowest:_75.first;};_5d.getLastInTabbingOrder=function(_76,doc){var _77=_5d._getTabNavigable(dom.byId(_76,doc));return _77.last?_77.last:_77.highest;};return {hasDefaultTabStop:_5d.hasDefaultTabStop,isTabNavigable:_5d.isTabNavigable,_getTabNavigable:_5d._getTabNavigable,getFirstInTabbingOrder:_5d.getFirstInTabbingOrder,getLastInTabbingOrder:_5d.getLastInTabbingOrder};});},"esri/layers/ServiceGeneratedFeatureCollection":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/renderers/SimpleRenderer","esri/layers/layer","esri/layers/FeatureLayer","esri/dijit/PopupTemplate"],function(_78,_79,_7a,_7b,_7c,_7d,has,_7e,_7f,_80,_81,_82,_83,_84,_85){var _86=_78([_83],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(url,_87){this.pointSymbol=_87&&_87.pointSymbol;this.polylineSymbol=_87&&_87.polylineSymbol;this.polygonSymbol=_87&&_87.polygonSymbol;this._outSR=(_87&&(_87.outSpatialReference||_87.outSR))||new _7f({wkid:4326});this._options=_87;},parse:function(){console.error("parse function has not been implemented");},getFeatureLayers:function(){var _88=[];if(this._fLayers){_88=_88.concat(this._fLayers);}return _88;},onRefresh:function(){},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._createLayer();},_createLayer:function(_89){var _8a=this;this._fireUpdateStart();var _8b=this.parse(_89);_8b.addCallback(function(_8c){_8a._io=null;_8a._initLayer(_8c);});_8b.addErrback(function(err){_8a._io=null;err=_7a.mixin(new Error(),err);err.message="Unable to load resource: "+_8a.url+" "+(err.message||"");_8a._fireUpdateEnd(err);_8a.onError(err);});},_initLayer:function(_8d){if(this.loaded){this._removeInternalLayers();}this.name=_8d.name;this.description=_8d.description;this.snippet=_8d.snippet;if(_8d.visibility!==undefined){this.defaultVisibility=this.visible=!!_8d.visibility;}else{this.defaultVisibility=this.visible=true;}this.featureInfos=_8d.featureInfos;this.fullExtent=this.initialExtent=new _80(_8d.lookAtExtent);this.copyright=_8d.author||_8d.copyright;var _8e;var _8f=_7a.getObject("featureCollection.layers",false,_8d);if(_8f&&_8f.length>0){this._fLayers=[];_7b.forEach(_8f,function(_90,i){var _91=_7a.getObject("featureSet.features",false,_90),_92;if(_91&&_91.length>0){_8e=_7a.mixin({outFields:["*"],infoTemplate:_90.popupInfo?new _85(_90.popupInfo):null,editable:false},this._options);if(_8e.id){_8e.id=_8e.id+"_"+i;}_90.layerDefinition.capabilities="Query,Data";_92=new _84(_90,_8e);if(_92.geometryType){this["_"+_92.geometryType]=_92;}this._fLayers.push(_92);}},this);if(this._fLayers.length===0){delete this._fLayers;}}this.items=[];if(this._esriGeometryPoint){this.items=this.items.concat(this._esriGeometryPoint.graphics);if(this.pointSymbol){var _93=new _82(this.pointSymbol);this._esriGeometryPoint.setRenderer(_93);}}if(this._esriGeometryPolyline){this.items=this.items.concat(this._esriGeometryPolyline.graphics);if(this.polylineSymbol){var _94=new _82(this.polylineSymbol);this._esriGeometryPolyline.setRenderer(_94);}}if(this._esriGeometryPolygon){this.items=this.items.concat(this._esriGeometryPolygon.graphics);if(this.polygonSymbol){var _95=new _82(this.polygonSymbol);this._esriGeometryPolygon.setRenderer(_95);}}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();var _96=map.spatialReference,_97=this._outSR,_98;if(_96.wkid){_98=(_96._isWebMercator()&&_97._isWebMercator())||(_96.wkid===_97.wkid);}else{if(_96.wkt){_98=(_96.wkt===_97.wkt);}else{console.log("_setMap - map has invalid spatial reference");return;}}if(!_98){if(_96._isWebMercator()&&_97.wkid===4326){this._converter=_81.geographicToWebMercator;}else{if(_97._isWebMercator()&&_96.wkid===4326){this._converter=_81.webMercatorToGeographic;}else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return;}}}var _99=this._fLayers;if(_99&&_99.length>0){_7b.forEach(_99,function(_9a){if(this._converter){var _9b=_9a.graphics,i,_9c,len=_9b?_9b.length:0;for(i=0;i<len;i++){_9c=_9b[i].geometry;if(_9c){_9b[i].setGeometry(this._converter(_9c));}}}map.addLayer(_9a);},this);}this.setVisibility(this.visible);},_removeInternalLayers:function(){var map=this._map;if(map){_7b.forEach(this.getFeatureLayers(),map.removeLayer,map);}},onVisibilityChange:function(_9d){this._fireUpdateStart();_7b.forEach(this.getFeatureLayers(),function(_9e){_9e.setVisibility(_9d);});this._fireUpdateEnd();},_setMap:function(map,_9f){this.inherited(arguments);this._map=map;var div=this._div=_7c.create("div",null,_9f);_7d.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_a0){if(this._io){this._io.cancel();}_79.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_a0.removeChild(div);_7c.destroy(div);}this._div=null;this.inherited(arguments);}});if(has("extend-esri")){_7a.setObject("layers._ServiceGeneratedFeatureCollection",_86,_7e);}return _86;});},"esri/layers/GeoRSSLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/config","esri/request","esri/layers/ServiceGeneratedFeatureCollection"],function(_a1,_a2,_a3,has,_a4,_a5,_a6,_a7){var _a8=_a1([_a7],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(url,_a9){if(_a5.defaults.geoRSSService){this.serviceUrl=_a5.defaults.geoRSSService;}this._createLayer();},parse:function(){this._io=_a6({url:this.serviceUrl,content:{url:this._url.path,refresh:this.loaded?true:undefined,outSR:this._outSR?_a3.toJson(this._outSR.toJson()):undefined},callbackParamName:"callback"});return this._io;},_initLayer:function(_aa){this.inherited(arguments);if(!this.loaded){this.loaded=true;this.onLoad(this);}}});if(has("extend-esri")){_a2.setObject("layers.GeoRSSLayer",_a8,_a4);}return _a8;});},"esri/PopupInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/i18n","dojo/has","esri/kernel","esri/lang","dojo/i18n!dojo/cldr/nls/number"],function(_ab,_ac,_ad,_ae,_af,has,_b0,_b1){var _b2=_ab(null,{declaredClass:"esri.PopupInfo",initialize:function(_b3,_b4){if(!_b3){return;}_ac.mixin(this,_b4);this.info=_b3;this.title=this.getTitle;this.content=this.getContent;var _b5=(this._fieldLabels={}),_b6=(this._fieldsMap={});if(_b3.fieldInfos){_ad.forEach(_b3.fieldInfos,function(_b7){_b5[_b7.fieldName]=_b7.label;_b6[_b7.fieldName]=_b7;});}},toJson:function(){return _ae.fromJson(_ae.toJson(this.info));},getTitle:function(){},getContent:function(){},getComponents:function(_b8){var _b9=this.info,_ba=_b8.getLayer(),_bb=_ac.clone(_b8.attributes)||{},_bc=_ac.clone(_bb),_bd=_b9.fieldInfos,_be="",_bf="",_c0,_c1,_c2,_c3=_ba&&_ba._getDateOpts&&_ba._getDateOpts().properties,_c4={dateFormat:{properties:_c3,formatter:"DateFormat"+this._insertOffset(this._dateFormats["shortDateShortTime"])}};if(_bd){_ad.forEach(_bd,function(_c5){var _c6=_c5.fieldName,val=_bc[_c6];_bc[_c6]=this._formatValue(val,_c6,_c4);if(_c3&&_c5.format&&_c5.format.dateFormat){var pos=_ad.indexOf(_c3,_c6);if(pos>-1){_c3.splice(pos,1);}}},this);}if(_ba){var _c7=_ba.types,_c8=_ba.typeIdField,_c9=_c8&&_bb[_c8];for(_c1 in _bb){_c2=_bb[_c1];if(_b1.isDefined(_c2)){var _ca=this._getDomainName(_ba,_c7,_c9,_c1,_c2);if(_b1.isDefined(_ca)){_bc[_c1]=_ca;}else{if(_c1===_c8){var _cb=this._getTypeName(_ba,_c2);if(_b1.isDefined(_cb)){_bc[_c1]=_cb;}}}}}}if(_b9.title){_be=_ac.trim(_b1.substitute(_bc,this._fixTokens(_b9.title),_c4)||"");}if(_b9.description){_bf=_ac.trim(_b1.substitute(_bc,this._fixTokens(_b9.description),_c4)||"");}if(_bd){_c0=[];_ad.forEach(_bd,function(_cc){_c1=_cc.fieldName;if(_c1&&_cc.visible){_c0.push([_cc.label||_c1,_b1.substitute(_bc,"${"+_c1+"}",_c4)||""]);}});}var _cd,_ce;if(_b9.mediaInfos){_cd=[];_ad.forEach(_b9.mediaInfos,function(_cf){_ce=0;_c2=_cf.value;switch(_cf.type){case "image":var url=_c2.sourceURL;url=url&&_ac.trim(_b1.substitute(_bb,this._fixTokens(url)));_ce=!!url;break;case "piechart":case "linechart":case "columnchart":case "barchart":_ce=_ad.some(_c2.fields,function(_d0){return _b1.isDefined(_bb[_d0]);});break;default:return;}if(_ce){_cf=_ac.clone(_cf);_c2=_cf.value;_cf.title=_cf.title?_ac.trim(_b1.substitute(_bc,this._fixTokens(_cf.title),_c4)||""):"";_cf.caption=_cf.caption?_ac.trim(_b1.substitute(_bc,this._fixTokens(_cf.caption),_c4)||""):"";if(_cf.type==="image"){_c2.sourceURL=_b1.substitute(_bb,this._fixTokens(_c2.sourceURL));if(_c2.linkURL){_c2.linkURL=_ac.trim(_b1.substitute(_bb,this._fixTokens(_c2.linkURL))||"");}}else{var _d1=_bb[_c2.normalizeField]||0;_c2.fields=_ad.map(_c2.fields,function(_d2){var _d3=_bb[_d2];_d3=(_d3===undefined)?null:_d3;if(_d3&&_d1){_d3=_d3/_d1;}return {y:_d3,tooltip:(this._fieldLabels[_d2]||_d2)+":<br/>"+this._formatValue(_d3,_d2,_c4,!!_d1)};},this);}_cd.push(_cf);}},this);}return {title:_be,description:_bf,fields:(_c0&&_c0.length)?_c0:null,mediaInfos:(_cd&&_cd.length)?_cd:null,formatted:_bc,editSummary:(_ba&&_ba.getEditSummary)?_ba.getEditSummary(_b8):""};},getAttachments:function(_d4){var _d5=_d4.getLayer(),_d6=_d4.attributes;if(this.info.showAttachments&&_d5&&_d5.hasAttachments&&_d5.objectIdField){var oid=_d6&&_d6[_d5.objectIdField];if(oid){return _d5.queryAttachmentInfos(oid);}}},_dateFormats:{"shortDate":"(datePattern: 'M/d/y', selector: 'date')","longMonthDayYear":"(datePattern: 'MMMM d, y', selector: 'date')","dayShortMonthYear":"(datePattern: 'd MMM y', selector: 'date')","longDate":"(datePattern: 'EEEE, MMMM d, y', selector: 'date')","shortDateShortTime":"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')","shortDateShortTime24":"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')","shortDateLongTime":"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')","shortDateLongTime24":"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')","longMonthYear":"(datePattern: 'MMMM y', selector: 'date')","shortMonthYear":"(datePattern: 'MMM y', selector: 'date')","year":"(datePattern: 'y', selector: 'date')"},_fixTokens:function(_d7){return _d7.replace(/(\{[^\{\r\n]+\})/g,"$$$1");},_formatValue:function(val,_d8,_d9,_da){var _db=this._fieldsMap[_d8],fmt=_db&&_db.format;if(!_b1.isDefined(val)||!_db||!_b1.isDefined(fmt)){return val;}var _dc="",_dd=[],_de=fmt.hasOwnProperty("places")||fmt.hasOwnProperty("digitSeparator"),_df=fmt.hasOwnProperty("digitSeparator")?fmt.digitSeparator:true;if(_de){_dc="NumberFormat";_dd.push("places: "+((_b1.isDefined(fmt.places)&&(!_da||fmt.places>0))?Number(fmt.places):"Infinity"));if(_dd.length){_dc+=("("+_dd.join(",")+")");}}else{if(fmt.dateFormat){_dc="DateFormat"+this._insertOffset(this._dateFormats[fmt.dateFormat]||this._dateFormats["shortDateShortTime"]);}else{return val;}}var _e0=_b1.substitute({"myKey":val},"${myKey:"+_dc+"}",_d9)||"";if(_de&&!_df){var _e1=_af.getLocalization("dojo.cldr","number");if(_e1.group){_e0=_e0.replace(new RegExp("\\"+_e1.group,"g"),"");}}return _e0;},_insertOffset:function(_e2){if(_e2){_e2=_b1.isDefined(this.utcOffset)?_e2.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):_e2;}return _e2;},_getDomainName:function(_e3,_e4,_e5,_e6,_e7){var _e8,_e9;if(_e4&&_b1.isDefined(_e5)){_ad.some(_e4,function(_ea){if(_ea.id==_e5){_e8=_ea.domains&&_ea.domains[_e6];if(_e8&&_e8.type==="inherited"){_e8=this._getLayerDomain(_e3,_e6);_e9=true;}return true;}return false;},this);}if(!_e9&&!_e8){_e8=this._getLayerDomain(_e3,_e6);}if(_e8&&_e8.codedValues){var _eb;_ad.some(_e8.codedValues,function(_ec){if(_ec.code==_e7){_eb=_ec.name;return true;}return false;});return _eb;}},_getLayerDomain:function(_ed,_ee){var _ef=_ed.fields;if(_ef){var _f0;_ad.some(_ef,function(_f1){if(_f1.name===_ee){_f0=_f1.domain;return true;}return false;});return _f0;}},_getTypeName:function(_f2,id){var _f3=_f2.types;if(_f3){var _f4;_ad.some(_f3,function(_f5){if(_f5.id==id){_f4=_f5.name;return true;}return false;});return _f4;}}});if(has("extend-esri")){_b0.PopupInfo=_b0.PopupInfoTemplate=_b2;}return _b2;});},"esri/layers/KMLLayer":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/sniff","dojo/io-query","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/dijit/PopupTemplate","esri/layers/layer","esri/layers/KMLFolder","esri/layers/KMLGroundOverlay","esri/layers/MapImageLayer","esri/layers/FeatureLayer"],function(_f6,_f7,_f8,_f9,_fa,_fb,has,ioq,_fc,_fd,_fe,_ff,_100,_101,_102,_103,_104,_105,_106,_107,_108,_109){var _10a=_f7([_105],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(url,_10b){if(!url){console.log("KMLLayer:constructor - please provide url for the KML file");}this._outSR=(_10b&&_10b.outSR)||new _102({wkid:4326});this._options=_10b;if(_ff.defaults.kmlService){this.serviceUrl=_ff.defaults.kmlService;}var link=(this.linkInfo=_10b&&_10b.linkInfo);if(link){this.visible=!!link.visibility;this._waitingForMap=!!link.viewFormat;}if(!link||(link&&link.visibility&&!this._waitingForMap)){this._parseKml();}this.refresh=_f9.hitch(this,this.refresh);},getFeature:function(_10c){if(!_10c){return;}var type=_10c.type,id=_10c.id,_10d,i,len;switch(type){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var _10e=this["_"+type];if(_10e){_10d=_f9.getObject("_mode._featureMap."+id,false,_10e);}break;case "GroundOverlay":var _10f=this._groundLyr;if(_10f){var _110=_10f.getImages();len=_110.length;for(i=0;i<len;i++){if(_110[i].id===id){_10d=_110[i];break;}}}break;case "ScreenOverlay":break;case "NetworkLink":_fa.some(this._links,function(link){if(link.linkInfo&&link.linkInfo.id===id){_10d=link;return true;}else{return false;}});break;case "Folder":var _111=this.folders;len=_111?_111.length:0;for(i=0;i<len;i++){if(_111[i].id===id){_10d=_111[i];break;}}break;default:console.log("KMLLayer:getFeature - unknown feature type");break;}return _10d;},getLayers:function(){var _112=[];if(this._groundLyr){_112.push(this._groundLyr);}if(this._fLayers){_112=_112.concat(this._fLayers);}if(this._links){_fa.forEach(this._links,function(link){if(link.declaredClass){_112.push(link);}});}return _112;},setFolderVisibility:function(_113,_114){if(!_113){return;}this._fireUpdateStart();_113.visible=_114;if(_114){_114=this._areLocalAncestorsVisible(_113);}this._setState(_113,_114);this._fireUpdateEnd();},onRefresh:function(){},_parseKml:function(map){var self=this;this._fireUpdateStart();this._io=_101({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(map),model:"simple",folders:"",refresh:this.loaded?true:undefined,outSR:_fb.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(_115){self._io=null;self._initLayer(_115);},error:function(err){self._io=null;err=_f9.mixin(new Error(),err);err.message="Unable to load KML: "+self.url+" "+(err.message||"");self._fireUpdateEnd(err);self.onError(err);}});},_initLayer:function(json){if(this.loaded){this._removeInternalLayers();}this.name=json.name;this.description=json.description;this.snippet=json.snippet;this.visibility=json.visibility;this.featureInfos=json.featureInfos;var i,len;var _116=(this.folders=json.folders),_117=[],fldr;if(_116){len=_116.length;for(i=0;i<len;i++){fldr=(_116[i]=new _106(_116[i]));if(fldr.parentFolderId===-1){_117.push(fldr);}}}var _118=(this._links=json.networkLinks),_119;len=_118?_118.length:0;for(i=0;i<len;i++){if(_118[i].viewRefreshMode&&_118[i].viewRefreshMode.toLowerCase().indexOf("onregion")!==-1){continue;}_119=_f9.mixin({},this._options);_119.linkInfo=_118[i];if(_119.id){_119.id=_119.id+"_"+i;}_118[i]=new _10a(_118[i].href,_119);_118[i]._parentLayer=this;_118[i]._parentFolderId=this._getLinkParentId(_118[i].linkInfo.id);}var _11a=json.groundOverlays;if(_11a&&_11a.length>0){_119=_f9.mixin({},this._options);if(_119.id){_119.id=_119.id+"_"+"mapImage";}var _11b=(this._groundLyr=new _108(_119));len=_11a.length;for(i=0;i<len;i++){_11b.addImage(new _107(_11a[i]));}}var _11c=_f9.getObject("featureCollection.layers",false,json);if(_11c&&_11c.length>0){this._fLayers=[];_fa.forEach(_11c,function(_11d,i){var _11e=_f9.getObject("featureSet.features",false,_11d),_11f;if(_11e&&_11e.length>0){_119=_f9.mixin({outFields:["*"],infoTemplate:_11d.popupInfo?new _104(_11d.popupInfo):null,editable:false},this._options);if(_119.id){_119.id=_119.id+"_"+i;}_11d.layerDefinition.capabilities="Query,Data";_11f=new _109(_11d,_119);if(_11f.geometryType){this["_"+_11f.geometryType]=_11f;}this._fLayers.push(_11f);}},this);if(this._fLayers.length===0){delete this._fLayers;}}len=_117.length;for(i=0;i<len;i++){fldr=_117[i];this._setState(fldr,fldr.visible);}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}else{this.loaded=true;this.onLoad(this);}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();if(this._links){_fa.forEach(this._links,function(link){if(link.declaredClass){map.addLayer(link);if(link._waitingForMap){link._waitingForMap=null;if(link.visible){link._parseKml(map);}else{link._wMap=map;}}}});}var _120=map.spatialReference,_121=this._outSR,_122;if(!_120.equals(_121)){if(_120.isWebMercator()&&_121.wkid===4326){_122=_103.geographicToWebMercator;}else{if(_121.isWebMercator()&&_120.wkid===4326){_122=_103.webMercatorToGeographic;}else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");return;}}}if(this._groundLyr){if(_122){_fa.forEach(this._groundLyr.getImages(),function(_123){_123.extent=_122(_123.extent);});}map.addLayer(this._groundLyr);}var _124=this._fLayers;if(_124&&_124.length>0){_fa.forEach(_124,function(_125){if(_122){var _126=_125.graphics,i,geom,len=_126?_126.length:0;for(i=0;i<len;i++){geom=_126[i].geometry;if(geom){_126[i].setGeometry(_122(geom));}}}map.addLayer(_125);});}this.onVisibilityChange(this.visible);},_removeInternalLayers:function(){var map=this._map;if(this._links){_fa.forEach(this._links,function(link){if(link.declaredClass&&link._io){link._io.cancel();}});}if(map){_fa.forEach(this.getLayers(),map.removeLayer,map);}},_setState:function(_127,_128){var _129=_127.featureInfos,info,_12a,i,len=_129?_129.length:0,_12b=_128?"show":"hide";for(i=0;i<len;i++){info=_129[i];_12a=this.getFeature(info);if(!_12a){continue;}if(info.type==="Folder"){this._setState(_12a,_128&&_12a.visible);}else{if(info.type==="NetworkLink"){this._setInternalVisibility(_12a,_128);}else{_12a[_12b]();}}}},_areLocalAncestorsVisible:function(_12c){var _12d=_12c.parentFolderId,_12e=_12c.visible;while(_12e&&_12d!==-1){var _12f=this.getFeature({type:"Folder",id:_12d});_12e=_12e&&_12f.visible;_12d=_12f.parentFolderId;}return _12e;},_setInternalVisibility:function(_130,_131){var _132=_130._parentLayer,_133=_130._parentFolderId;_131=_131&&_130.visible;while(_131&&_132){_131=_131&&_132.visible;if(_133>-1){_131=_131&&_132._areLocalAncestorsVisible(_132.getFeature({type:"Folder",id:_133}));}_133=_132._parentFolderId;_132=_132._parentLayer;}this._setIntState(_130,_131);},_setIntState:function(link,_134){if(!link){return;}_fa.forEach(link.getLayers(),function(_135){if(_135.linkInfo){link._setIntState(_135,_134&&_135.visible&&link._areLocalAncestorsVisible(link.getFeature({type:"Folder",id:_135._parentFolderId})));}else{_135.setVisibility(_134);}});},_getLinkParentId:function(id){var _136=-1;if(this.folders){_fa.some(this.folders,function(_137){if(_137.networkLinkIds&&_fa.indexOf(_137.networkLinkIds,id)!==-1){_136=_137.id;return true;}return false;});}return _136;},_checkAutoRefresh:function(){var _138=this.linkInfo;if(_138){if(this.visible){if(this.loaded&&this._map){var _139=_138.refreshMode,_13a=_138.refreshInterval,_13b=_138.viewRefreshMode,_13c=_138.viewRefreshTime;if(_139&&_139.toLowerCase().indexOf("oninterval")!==-1&&_13a>0){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,_13a*1000);}if(_13b&&_13b.toLowerCase().indexOf("onstop")!==-1&&_13c>0){if(!this._extChgHandle){this._extChgHandle=_f8.connect(this._map,"onExtentChange",this,this._extentChanged);}}}}else{this._stopAutoRefresh();_f8.disconnect(this._extChgHandle);delete this._extChgHandle;}}},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null;},_getQueryParameters:function(map){map=map||this._map;var _13d={},_13e=this.linkInfo,_13f=map&&map.extent,_140;if(this._url.query){_f9.mixin(_13d,this._url.query);_140=!!this._url.query.token;}if(_fe.id&&!_140){var _141=_fe.id.findCredential(this._url.path);if(_141){_13d.token=_141.token;}}if(_13e){var _142=_13e.viewFormat,_143=_13e.httpQuery,_144=_13e.viewBoundScale;if(_13f&&_142){var _145=_13f,_146=_13f,sr=_13f.spatialReference;if(sr){if(sr.isWebMercator()){_145=_103.webMercatorToGeographic(_13f);}else{if(sr.wkid===4326){_146=_103.geographicToWebMercator(_13f);}}}var _147=_145.getCenter(),_148=Math.max(_146.getWidth(),_146.getHeight());if(_144){_145=_145.expand(_144);}_142=_142.replace(/\[bboxWest\]/ig,_145.xmin).replace(/\[bboxEast\]/ig,_145.xmax).replace(/\[bboxSouth\]/ig,_145.ymin).replace(/\[bboxNorth\]/ig,_145.ymax).replace(/\[lookatLon\]/ig,_147.x).replace(/\[lookatLat\]/ig,_147.y).replace(/\[lookatRange\]/ig,_148).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,_147.x).replace(/\[lookatTerrainLat\]/ig,_147.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,_147.x).replace(/\[cameraLat\]/ig,_147.y).replace(/\[cameraAlt\]/ig,_148).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,map.width).replace(/\[vertPixels\]/ig,map.height).replace(/\[terrainEnabled\]/ig,0);_f9.mixin(_13d,ioq.queryToObject(_142));}if(_143){_143=_143.replace(/\[clientVersion\]/ig,_fe.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,_f6.locale);_f9.mixin(_13d,ioq.queryToObject(_143));}}var _149=[],_14a;for(_14a in _13d){if(_100.isDefined(_13d[_14a])){_149.push(_14a+"="+_13d[_14a]);}}_149=_149.join("&");return _149?("?"+_149):"";},_setMap:function(map,_14b){this._map=map;var div=this._div=_fc.create("div",null,_14b);_fd.set(div,"position","absolute");this._addInternalLayers();return div;},_unsetMap:function(map,_14c){if(this._io){this._io.cancel();}this._stopAutoRefresh();_f8.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_14c.removeChild(div);_fc.destroy(div);}this._map=this._wMap=this._div=null;},onVisibilityChange:function(_14d){if(!this.loaded){if(this.linkInfo&&_14d){if(!this._waitingForMap){this._parseKml(this._wMap);}}return;}this._fireUpdateStart();this._setInternalVisibility(this,_14d);this._checkAutoRefresh();this._fireUpdateEnd();},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._parseKml();},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,this.linkInfo.viewRefreshTime*1000);}});if(has("extend-esri")){_f9.setObject("layers.KMLLayer",_10a,_fe);}return _10a;});},"dojo/hccss":function(){define(["require","./_base/config","./dom-class","./dom-style","./has","./ready","./_base/window"],function(_14e,_14f,_150,_151,has,_152,win){has.add("highcontrast",function(){var div=win.doc.createElement("div");div.style.cssText="border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;"+"background-image: url("+(_14f.blankGif||_14e.toUrl("./resources/blank.gif"))+");";win.body().appendChild(div);var cs=_151.getComputedStyle(div),_153=cs.backgroundImage,hc=(cs.borderTopColor==cs.borderRightColor)||(_153&&(_153=="none"||_153=="url(invalid-url:)"));if(has("ie")<=8){div.outerHTML="";}else{win.body().removeChild(div);}return hc;});_152(90,function(){if(has("highcontrast")){_150.add(win.body(),"dj_a11y");}});return has;});},"dijit/_WidgetBase":function(){define("dijit/_WidgetBase",["require","dojo/_base/array","dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/ready","dojo/Stateful","dojo/topic","dojo/_base/window","./Destroyable","./registry"],function(_154,_155,_156,_157,_158,_159,dom,_15a,_15b,_15c,_15d,_15e,has,_15f,lang,on,_160,_161,_162,win,_163,_164){has.add("dijit-legacy-requires",!_15f.isAsync);if(has("dijit-legacy-requires")){_160(0,function(){var _165=["dijit/_base/manager"];_154(_165);});}var _166={};function _167(obj){var ret={};for(var attr in obj){ret[attr.toLowerCase()]=true;}return ret;};function _168(attr){return function(val){_15a[val?"set":"remove"](this.domNode,attr,val);this._set(attr,val);};};return _159("dijit._WidgetBase",[_161,_163],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:_168("lang"),dir:"",_setDirAttr:_168("dir"),textDir:"","class":"",_setClassAttr:{node:"domNode",type:"class"},style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(val){this._set("ownerDocument",val);},attributeMap:{},_blankGif:_157.blankGif||_154.toUrl("dojo/resources/blank.gif"),postscript:function(_169,_16a){this.create(_169,_16a);},create:function(_16b,_16c){this.srcNodeRef=dom.byId(_16c);this._connects=[];this._supportingWidgets=[];if(this.srcNodeRef&&(typeof this.srcNodeRef.id=="string")){this.id=this.srcNodeRef.id;}if(_16b){this.params=_16b;lang.mixin(this,_16b);}this.postMixInProperties();if(!this.id){this.id=_164.getUniqueId(this.declaredClass.replace(/\./g,"_"));if(this.params){delete this.params.id;}}this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:win.doc);this.ownerDocumentBody=win.body(this.ownerDocument);_164.add(this);this.buildRendering();var _16d;if(this.domNode){this._applyAttributes();var _16e=this.srcNodeRef;if(_16e&&_16e.parentNode&&this.domNode!==_16e){_16e.parentNode.replaceChild(this.domNode,_16e);_16d=true;}this.domNode.setAttribute("widgetId",this.id);}this.postCreate();if(_16d){delete this.srcNodeRef;}this._created=true;},_applyAttributes:function(){var ctor=this.constructor,list=ctor._setterAttrs;if(!list){list=(ctor._setterAttrs=[]);for(var attr in this.attributeMap){list.push(attr);}var _16f=ctor.prototype;for(var _170 in _16f){if(_170 in this.attributeMap){continue;}var _171="_set"+_170.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase();})+"Attr";if(_171 in _16f){list.push(_170);}}}var _172={};for(var key in this.params||{}){_172[key]=this[key];}_155.forEach(list,function(attr){if(attr in _172){}else{if(this[attr]){this.set(attr,this[attr]);}}},this);for(key in _172){this.set(key,_172[key]);}},postMixInProperties:function(){},buildRendering:function(){if(!this.domNode){this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div");}if(this.baseClass){var _173=this.baseClass.split(" ");if(!this.isLeftToRight()){_173=_173.concat(_155.map(_173,function(name){return name+"Rtl";}));}_15b.add(this.domNode,_173);}},postCreate:function(){},startup:function(){if(this._started){return;}this._started=true;_155.forEach(this.getChildren(),function(obj){if(!obj._started&&!obj._destroyed&&lang.isFunction(obj.startup)){obj.startup();obj._started=true;}});},destroyRecursive:function(_174){this._beingDestroyed=true;this.destroyDescendants(_174);this.destroy(_174);},destroy:function(_175){this._beingDestroyed=true;this.uninitialize();function _176(w){if(w.destroyRecursive){w.destroyRecursive(_175);}else{if(w.destroy){w.destroy(_175);}}};_155.forEach(this._connects,lang.hitch(this,"disconnect"));_155.forEach(this._supportingWidgets,_176);if(this.domNode){_155.forEach(_164.findWidgets(this.domNode,this.containerNode),_176);}this.destroyRendering(_175);_164.remove(this.id);this._destroyed=true;},destroyRendering:function(_177){if(this.bgIframe){this.bgIframe.destroy(_177);delete this.bgIframe;}if(this.domNode){if(_177){_15a.remove(this.domNode,"widgetId");}else{_15c.destroy(this.domNode);}delete this.domNode;}if(this.srcNodeRef){if(!_177){_15c.destroy(this.srcNodeRef);}delete this.srcNodeRef;}},destroyDescendants:function(_178){_155.forEach(this.getChildren(),function(_179){if(_179.destroyRecursive){_179.destroyRecursive(_178);}});},uninitialize:function(){return false;},_setStyleAttr:function(_17a){var _17b=this.domNode;if(lang.isObject(_17a)){_15e.set(_17b,_17a);}else{if(_17b.style.cssText){_17b.style.cssText+="; "+_17a;}else{_17b.style.cssText=_17a;}}this._set("style",_17a);},_attrToDom:function(attr,_17c,_17d){_17d=arguments.length>=3?_17d:this.attributeMap[attr];_155.forEach(lang.isArray(_17d)?_17d:[_17d],function(_17e){var _17f=this[_17e.node||_17e||"domNode"];var type=_17e.type||"attribute";switch(type){case "attribute":if(lang.isFunction(_17c)){_17c=lang.hitch(this,_17c);}var _180=_17e.attribute?_17e.attribute:(/^on[A-Z][a-zA-Z]*$/.test(attr)?attr.toLowerCase():attr);if(_17f.tagName){_15a.set(_17f,_180,_17c);}else{_17f.set(_180,_17c);}break;case "innerText":_17f.innerHTML="";_17f.appendChild(this.ownerDocument.createTextNode(_17c));break;case "innerHTML":_17f.innerHTML=_17c;break;case "class":_15b.replace(_17f,_17c,this[attr]);break;}},this);},get:function(name){var _181=this._getAttrNames(name);return this[_181.g]?this[_181.g]():this[name];},set:function(name,_182){if(typeof name==="object"){for(var x in name){this.set(x,name[x]);}return this;}var _183=this._getAttrNames(name),_184=this[_183.s];if(lang.isFunction(_184)){var _185=_184.apply(this,Array.prototype.slice.call(arguments,1));}else{var _186=this.focusNode&&!lang.isFunction(this.focusNode)?"focusNode":"domNode",_187,map,tag;tag=this[_186]&&this[_186].tagName;if(tag){_187=_166[tag]||(_166[tag]=_167(this[_186]));}map=name in this.attributeMap?this.attributeMap[name]:_183.s in this?this[_183.s]:((_187&&_183.l in _187&&typeof _182!="function")||/^aria-|^data-|^role$/.test(name))?_186:null;if(map!=null){this._attrToDom(name,_182,map);}this._set(name,_182);}return _185||this;},_attrPairNames:{},_getAttrNames:function(name){var apn=this._attrPairNames;if(apn[name]){return apn[name];}var uc=name.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase();});return (apn[name]={n:name+"Node",s:"_set"+uc+"Attr",g:"_get"+uc+"Attr",l:uc.toLowerCase()});},_set:function(name,_188){var _189=this[name];this[name]=_188;if(this._created&&_188!==_189){if(this._watchCallbacks){this._watchCallbacks(name,_189,_188);}this.emit("attrmodified-"+name,{detail:{prevValue:_189,newValue:_188}});}},emit:function(type,_18a,_18b){_18a=_18a||{};if(_18a.bubbles===undefined){_18a.bubbles=true;}if(_18a.cancelable===undefined){_18a.cancelable=true;}if(!_18a.detail){_18a.detail={};}_18a.detail.widget=this;var ret,_18c=this["on"+type];if(_18c){ret=_18c.apply(this,_18b?_18b:[_18a]);}if(this._started&&!this._beingDestroyed){on.emit(this.domNode,type.toLowerCase(),_18a);}return ret;},on:function(type,func){var _18d=this._onMap(type);if(_18d){return _156.after(this,_18d,func,true);}return this.own(on(this.domNode,type,func))[0];},_onMap:function(type){var ctor=this.constructor,map=ctor._onMap;if(!map){map=(ctor._onMap={});for(var attr in ctor.prototype){if(/^on/.test(attr)){map[attr.replace(/^on/,"").toLowerCase()]=attr;}}}return map[typeof type=="string"&&type.toLowerCase()];},toString:function(){return "[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]";},getChildren:function(){return this.containerNode?_164.findWidgets(this.containerNode):[];},getParent:function(){return _164.getEnclosingWidget(this.domNode.parentNode);},connect:function(obj,_18e,_18f){return this.own(_158.connect(obj,_18e,this,_18f))[0];},disconnect:function(_190){_190.remove();},subscribe:function(t,_191){return this.own(_162.subscribe(t,lang.hitch(this,_191)))[0];},unsubscribe:function(_192){_192.remove();},isLeftToRight:function(){return this.dir?(this.dir=="ltr"):_15d.isBodyLtr(this.ownerDocument);},isFocusable:function(){return this.focus&&(_15e.get(this.domNode,"display")!="none");},placeAt:function(_193,_194){var _195=!_193.tagName&&_164.byId(_193);if(_195&&_195.addChild&&(!_194||typeof _194==="number")){_195.addChild(this,_194);}else{var ref=_195?(_195.containerNode&&!/after|before|replace/.test(_194||"")?_195.containerNode:_195.domNode):dom.byId(_193,this.ownerDocument);_15c.place(this.domNode,ref,_194);if(!this._started&&(this.getParent()||{})._started){this.startup();}}return this;},getTextDir:function(text,_196){return _196;},applyTextDir:function(){},defer:function(fcn,_197){var _198=setTimeout(lang.hitch(this,function(){_198=null;if(!this._destroyed){lang.hitch(this,fcn)();}}),_197||0);return {remove:function(){if(_198){clearTimeout(_198);_198=null;}return null;}};}});});},"esri/layers/FeatureLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/date/locale","dojo/sniff","dojo/io-query","dojo/dom-construct","dojo/i18n","esri/kernel","esri/lang","esri/request","esri/deferredUtils","esri/SpatialReference","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/jsonUtils","esri/renderers/SimpleRenderer","esri/renderers/UniqueValueRenderer","esri/renderers/jsonUtils","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/FeatureSet","esri/geometry/Extent","esri/geometry/jsonUtils","esri/geometry/normalizeUtils","esri/layers/GraphicsLayer","esri/layers/Field","esri/layers/TimeInfo","esri/layers/FeatureType","esri/layers/FeatureTemplate","esri/layers/FeatureEditResult","esri/layers/SnapshotMode","esri/layers/OnDemandMode","esri/layers/SelectionMode","esri/layers/TrackManager","dojo/i18n!esri/nls/jsapi","dojo/has!extend-esri?esri/layers/agscommon"],function(_199,_19a,lang,_19b,_19c,_19d,_19e,has,ioq,_19f,i18n,_1a0,_1a1,_1a2,_1a3,_1a4,_1a5,_1a6,_1a7,_1a8,_1a9,_1aa,_1ab,_1ac,_1ad,_1ae,_1af,_1b0,_1b1,_1b2,_1b3,_1b4,_1b5,_1b6,_1b7,_1b8,_1b9,_1ba,_1bb){var _1bc=_199(_1b2,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",constructor:function(url,_1bd){this.i18n=i18n.getLocalization("esri","jsapi");this._outFields=_1bd&&_1bd.outFields;this._loadCallback=_1bd&&_1bd.loadCallback;var _1be=_1bd&&_1bd._usePatch;this._usePatch=(_1be===null||_1be===undefined)?true:_1be;this._trackIdField=_1bd&&_1bd.trackIdField;this.objectIdField=_1bd&&_1bd.objectIdField;this._maxOffset=_1bd&&_1bd.maxAllowableOffset;this._optEditable=_1bd&&_1bd.editable;this._optAutoGen=_1bd&&_1bd.autoGeneralize;this.editSummaryCallback=_1bd&&_1bd.editSummaryCallback;this.userId=_1bd&&_1bd.userId;this.userIsAdmin=_1bd&&_1bd.userIsAdmin;this.useMapTime=(_1bd&&_1bd.hasOwnProperty("useMapTime"))?(!!_1bd.useMapTime):true;this.source=_1bd&&_1bd.source;this.gdbVersion=_1bd&&_1bd.gdbVersion;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var ctor=this.constructor,mode=this.mode=(_1a1.isDefined(_1bd&&_1bd.mode)?_1bd.mode:ctor.MODE_ONDEMAND);switch(mode){case ctor.MODE_SNAPSHOT:this._mode=new _1b8(this);this._isSnapshot=true;break;case ctor.MODE_ONDEMAND:this._tileWidth=(_1bd&&_1bd.tileWidth)||512;this._tileHeight=(_1bd&&_1bd.tileHeight)||512;this._mode=new _1b9(this);var _1bf=_1bd&&_1bd.latticeTiling;this.latticeTiling=_1bf;break;case ctor.MODE_SELECTION:this._mode=new _1ba(this);this._isSelOnly=true;break;}this._initLayer=lang.hitch(this,this._initLayer);this._selectHandler=lang.hitch(this,this._selectHandler);this._editable=false;if(lang.isObject(url)&&url.layerDefinition){var json=url;this._collection=true;this.mode=ctor.MODE_SNAPSHOT;this._initLayer(json);return this;}this._task=new _1ac(this.url,{source:this.source,gdbVersion:this.gdbVersion});var _1c0=this._url.path;this._fserver=false;if(_1c0.search(/\/FeatureServer\//i)!==-1){this._fserver=true;}var _1c1=_1bd&&_1bd.resourceInfo;if(_1c1){this._initLayer(_1c1);}else{if(this.source){var _1c2={source:this.source.toJson()};this._url.query=lang.mixin(this._url.query,{layer:_19c.toJson(_1c2)});}if(this.gdbVersion){this._url.query=lang.mixin(this._url.query,{gdbVersion:this.gdbVersion});}_1a2({url:_1c0,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}},_initLayer:function(_1c3,io){if(_1c3||io){this._json=_1c3;this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_1c3&&_1c3._ssl);if(ssl){this._useSSL();this._task._useSSL();}if(this._collection){this._mode=new _1b8(this);this._isSnapshot=true;this._featureSet=_1c3.featureSet;this._nextId=_1c3.nextObjectId;_1c3=_1c3.layerDefinition;}if(_1c3.hasOwnProperty("capabilities")){var _1c4=(this.capabilities=_1c3.capabilities);if(_1c4&&_1c4.toLowerCase().indexOf("editing")!==-1){this._editable=true;}else{this._editable=false;}}else{if(!this._collection){this._editable=this._fserver;}}if(_1a1.isDefined(this._optEditable)){this._editable=this._optEditable;delete this._optEditable;}this._json=_19c.toJson(this._json);if(this.isEditable()){delete this._maxOffset;}else{if(this.mode!==this.constructor.MODE_SNAPSHOT&&((_1c3.geometryType==="esriGeometryPolyline")||(_1c3.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_1a1.isDefined(this._optAutoGen)?this._optAutoGen:(this.mode===this.constructor.MODE_ONDEMAND);delete this._optAutoGen;}}var _1c5=_1c3.effectiveMinScale||_1c3.minScale,_1c6=_1c3.effectiveMaxScale||_1c3.maxScale;if(!this._hasMin&&_1c5){this.setMinScale(_1c5);}if(!this._hasMax&&_1c6){this.setMaxScale(_1c6);}this.layerId=_1c3.id;this.name=_1c3.name;this.description=_1c3.description;this.copyright=_1c3.copyrightText;this.type=_1c3.type;this.geometryType=_1c3.geometryType;this.displayField=_1c3.displayField;this.defaultDefinitionExpression=_1c3.definitionExpression;this.fullExtent=new _1af(_1c3.extent);this.initialExtent=new _1af(this.fullExtent.toJson());if(this.fullExtent.spatialReference){this.spatialReference=new _1a4(this.fullExtent.spatialReference.toJson());}this.defaultVisibility=_1c3.defaultVisibility;if((this.geometryType==="esriGeometryPoint")||(this.geometryType==="esriGeometryMultipoint")){this.latticeTiling=false;}this.indexedFields=_1c3.indexedFields;this.maxRecordCount=_1c3.maxRecordCount;this.canModifyLayer=_1c3.canModifyLayer;this.supportsStatistics=_1c3.supportsStatistics;this.supportsAdvancedQueries=_1c3.supportsAdvancedQueries;this.hasLabels=_1c3.hasLabels;this.canScaleSymbols=_1c3.canScaleSymbols;this.supportsRollbackOnFailure=_1c3.supportsRollbackOnFailure;this.syncCanReturnChanges=_1c3.syncCanReturnChanges;this.isDataVersioned=_1c3.isDataVersioned;this.editFieldsInfo=_1c3.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=_1c3.ownershipBasedAccessControlForFeatures;if(this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures){this.creatorField=this.editFieldsInfo.creatorField;}this.relationships=_1c3.relationships;this.allowGeometryUpdates=_1a1.isDefined(_1c3.allowGeometryUpdates)?_1c3.allowGeometryUpdates:true;this._isTable=(this.type==="Table");var _1c7=(this.fields=[]),_1c8=_1c3.fields,i;for(i=0;i<_1c8.length;i++){_1c7.push(new _1b3(_1c8[i]));}if(!this.objectIdField){this.objectIdField=_1c3.objectIdField;if(!this.objectIdField){_1c8=_1c3.fields;for(i=0;i<_1c8.length;i++){var _1c9=_1c8[i];if(_1c9.type==="esriFieldTypeOID"){this.objectIdField=_1c9.name;break;}}}if(!this.objectIdField){console.debug("esri.layers.FeatureLayer: "+_1a1.substitute({url:this.url},"objectIdField is not set [url: ${url}]"));}}if(!_1a1.isDefined(this._nextId)){var _1ca=this.objectIdField,_1cb=-1;if(this._collection&&_1ca){var fset=this._featureSet,_1cc=fset&&fset.features,il=_1cc?_1cc.length:0,oid,attr;for(i=0;i<il;i++){attr=_1cc[i].attributes;oid=attr&&attr[_1ca];if(oid>_1cb){_1cb=oid;}}}this._nextId=(_1cb+1);}this.globalIdField=_1c3.globalIdField;var _1cd=(this.typeIdField=_1c3.typeIdField),_1ce;if(_1cd){_1ce=!this._getField(_1cd)&&this._getField(_1cd,true);if(_1ce){this.typeIdField=_1ce.name;}}this.visibilityField=_1c3.visibilityField;var _1cf=_1c3.defaultSymbol;if(_1cf){this.defaultSymbol=_1a8.fromJson(_1cf);}var _1d0=this.types=[],_1d1=_1c3.types,_1d2,_1d3,_1d4,_1d5=this.editFieldsInfo,_1d6=_1d5&&_1d5.creatorField,_1d7=_1d5&&_1d5.editorField,fix=(_1d6||_1d7),_1d8=[];if(_1d1){for(i=0;i<_1d1.length;i++){_1d2=new _1b5(_1d1[i]);_1d3=_1d2.templates;if(fix&&_1d3&&_1d3.length){_1d8=_1d8.concat(_1d3);}_1d0.push(_1d2);}}var _1d9=_1c3.templates,_1da,_1db=this.templates=[];if(_1d9){for(i=0;i<_1d9.length;i++){_1da=new _1b6(_1d9[i]);if(fix){_1d8.push(_1da);}_1db.push(_1da);}}for(i=0;i<_1d8.length;i++){_1d4=lang.getObject("prototype.attributes",false,_1d8[i]);if(_1d4){if(_1d6){delete _1d4[_1d6];}if(_1d7){delete _1d4[_1d7];}}}var _1dc=_1c3.timeInfo;if(_1dc){this.timeInfo=new _1b4(_1dc);this._startTimeField=_1dc.startTimeField;this._endTimeField=_1dc.endTimeField;if(this._startTimeField&&this._endTimeField){this._twoTimeFields=true;}if(this._trackIdField){_1dc.trackIdField=this._trackIdField;}else{this._trackIdField=_1dc.trackIdField;}}this.hasAttachments=(!this._collection&&_1c3.hasAttachments)?true:false;this.htmlPopupType=_1c3.htmlPopupType;var _1dd=_1c3.drawingInfo,_1de;if(!this.renderer){if(_1dd&&_1dd.renderer){_1de=_1dd.renderer;this.setRenderer(_1ab.fromJson(_1de));if(_1de.type==="classBreaks"){this.renderer.setMaxInclusive(true);}if(!this._collection){var _1df=_1de.type,_1e0=[];_1de=this.renderer;switch(_1df){case "simple":_1e0.push(_1de.symbol);break;case "uniqueValue":case "classBreaks":_1e0.push(_1de.defaultSymbol);_1e0=_1e0.concat(_19b.map(_1de.infos,function(info){return info.symbol;}));break;}_1e0=_19b.filter(_1e0,_1a1.isDefined);var _1e1=this._url.path+"/images/",_1e2=this._getToken();_19b.forEach(_1e0,function(sym){var url=sym.url;if(url){if((url.search(/https?\:/)===-1)&&(url.indexOf("data:")===-1)){sym.url=_1e1+url;}if(_1e2&&sym.url.search(/https?\:/)!==-1){sym.url+=("?token="+_1e2);}}});}}else{if(_1cf){_1d1=this.types;if(_1d1.length>0){_1de=new _1aa(this.defaultSymbol,this.typeIdField);_19b.forEach(_1d1,function(type){_1de.addValue(type.id,type.symbol);});}else{_1de=new _1a9(this.defaultSymbol);}this.setRenderer(_1de);}else{if(!this._isTable){var _1e3;switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":_1e3=new _1a5();break;case "esriGeometryPolyline":_1e3=new _1a6();break;case "esriGeometryPolygon":_1e3=new _1a7();break;}this.setRenderer(_1e3?new _1a9(_1e3):null);}}}}var _1e4=(_1dd&&_1dd.transparency)||0;if(!_1a1.isDefined(this.opacity)&&_1e4>0){this.opacity=1-(_1e4/100);}this.version=_1c3.currentVersion;if(!this.version){var ver;if("capabilities" in _1c3||"drawingInfo" in _1c3||"hasAttachments" in _1c3||"htmlPopupType" in _1c3||"relationships" in _1c3||"timeInfo" in _1c3||"typeIdField" in _1c3||"types" in _1c3){ver=10;}else{ver=9.3;}this.version=ver;}if((has("ie")||has("safari"))&&this.isEditable()&&this.version<10.02){this._ts=true;}this.loaded=true;this._fixRendererFields();this._checkFields();this._updateCaps();var _1e5=function(){this.onLoad(this);var _1e6=this._loadCallback;if(_1e6){delete this._loadCallback;_1e6(this);}};if(this._collection){this._fireUpdateStart();var _1e7=this._featureSet;delete this._featureSet;this._mode._drawFeatures(new _1ae(_1e7));this._fcAdded=true;_1e5.call(this);}else{this._forceIdentity(_1e5);}}},setRenderer:function(ren){this.inherited("setRenderer",arguments);var _1e8=this.renderer;if(_1e8){this._ager=(_1e8.declaredClass.indexOf("TemporalRenderer")!==-1&&_1e8.observationAger&&_1e8.observationRenderer);var _1e9=_19b.filter([_1e8,_1e8.observationRenderer,_1e8.latestObservationRenderer,_1e8.trackRenderer],_1a1.isDefined);var _1ea=[];_19b.forEach(_1e9,function(rnd){if(!lang.isFunction(rnd.attributeField)){_1ea.push(rnd.attributeField);}_1ea.push(rnd.attributeField2);_1ea.push(rnd.attributeField3);},this);this._rendererFields=_19b.filter(_1ea,_1a1.isDefined);}else{this._ager=false;this._rendererFields=[];}if(this.loaded&&this._rendererFields.length>0){this._fixRendererFields();this._checkFields(this._rendererFields);}if(this.loaded&&this._collection){this._typesDirty=true;}},_setMap:function(map){var div=this.inherited(arguments),mode=this._mode;if(mode){mode.initialize(map);}return div;},_unsetMap:function(map){var mode=this._mode;if(mode){mode.suspend();}if(this._trackManager){this._trackManager.destroy();this._trackManager=null;}_19a.disconnect(this._zoomConnect);this._zoomConnect=null;this._toggleTime(false);this.inherited("_unsetMap",arguments);},refresh:function(){var mode=this._mode;if(mode){mode.refresh();}},setEditable:function(_1eb){if(!this._collection){console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service");return this;}if(!this.loaded){this._optEditable=_1eb;return this;}var _1ec=this._editable;this._editable=_1eb;this._updateCaps();if(_1ec!==_1eb){this.onCapabilitiesChange();}return this;},getEditCapabilities:function(_1ed){var _1ee={"canCreate":false,"canUpdate":false,"canDelete":false};if(!this.loaded||!this.isEditable()){return _1ee;}var _1ef=_1ed&&_1ed.feature,_1f0=_1ed&&_1ed.userId,caps=_19b.map((this.capabilities?this.capabilities.toLowerCase().split(","):[]),lang.trim),_1f1=_19b.indexOf(caps,"editing")>-1,_1f2=_1f1&&(_19b.indexOf(caps,"create")>-1),_1f3=_1f1&&(_19b.indexOf(caps,"update")>-1),_1f4=_1f1&&(_19b.indexOf(caps,"delete")>-1),_1f5=this.ownershipBasedAccessControlForFeatures,_1f6=this.editFieldsInfo,_1f7=_1f6&&_1f6.creatorField,_1f8=_1f6&&_1f6.realm,_1f9=_1ef&&_1ef.attributes,_1fa=(_1f9&&_1f7)?_1f9[_1f7]:undefined,_1fb,_1fc=!!this.userIsAdmin,_1fd=!_1f5||_1fc||!!(_1f5.allowOthersToUpdate||_1f5.allowUpdateToOthers),_1fe=!_1f5||_1fc||!!(_1f5.allowOthersToDelete||_1f5.allowDeleteToOthers);if(_1fc||(_1f1&&!(_1f2||_1f3||_1f4))){_1f2=_1f3=_1f4=true;}_1fb={"canCreate":_1f2,"canUpdate":_1f3,"canDelete":_1f4};if(_1fa===null){_1fb.canUpdate=_1f3&&_1fd;_1fb.canDelete=_1f4&&_1fe;}else{if(_1fa===""){return _1fb;}else{if(_1fa){_1f0=_1f0||this.getUserId();if(_1f0&&_1f8){_1f0=_1f0+"@"+_1f8;}if(_1f0.toLowerCase()===_1fa.toLowerCase()){return _1fb;}else{_1fb.canUpdate=_1f3&&_1fd;_1fb.canDelete=_1f4&&_1fe;}}}}return _1fb;},getUserId:function(){var _1ff;if(this.loaded){_1ff=(this.credential&&this.credential.userId)||this.userId||"";}return _1ff;},setUserIsAdmin:function(_200){this.userIsAdmin=_200;},setEditSummaryCallback:function(_201){this.editSummaryCallback=_201;},getEditSummary:function(_202,_203,_204){_204=_1a1.isDefined(_204)?_204:(new Date()).getTime();var _205="",info=this.getEditInfo(_202,_203,_204),_206=(_203&&_203.callback)||this.editSummaryCallback;if(_206){info=_206(_202,info)||"";}if(lang.isString(info)){_205=info;}else{if(info){var _207=info.action,_208=info.userId,_209=info.timeValue,_20a=0;if(_207){_20a++;}if(_208){_20a++;}if(_1a1.isDefined(_209)){_20a++;}if(_20a>1){_205=(_207==="edit"?"edit":"create")+(_208?"User":"")+(_1a1.isDefined(_209)?info.displayPattern:"");}}_205=_205&&_1a1.substitute(info,this.i18n.layers.FeatureLayer[_205]);}return _205;},getEditInfo:function(_20b,_20c,_20d){if(!this.loaded){return;}_20d=_1a1.isDefined(_20d)?_20d:(new Date()).getTime();var _20e=(_20c&&_20c.action)||"last",_20f=this.editFieldsInfo,_210=_20f&&_20f.creatorField,_211=_20f&&_20f.creationDateField,_212=_20f&&_20f.editorField,_213=_20f&&_20f.editDateField,_214=_20f&&_20f.realm,_215=_20b&&_20b.attributes,_216=(_215&&_210)?_215[_210]:undefined,_217=(_215&&_211)?_215[_211]:null,_218=(_215&&_212)?_215[_212]:undefined,_219=(_215&&_213)?_215[_213]:null,_21a=this._getEditData(_216,_217,_20d),_21b=this._getEditData(_218,_219,_20d),_21c;switch(_20e){case "creation":_21c=_21a;break;case "edit":_21c=_21b;break;case "last":_21c=_21b||_21a;break;}if(_21c){_21c.action=(_21c===_21b)?"edit":"creation";}return _21c;},_getEditData:function(_21d,_21e,_21f){var data,_220,_221,_222=60000,_223=3600000,_224=2*_223,_225=24*_223,_226=7*_225;if(_1a1.isDefined(_21e)){_220=_21f-_21e;if(_220<0){_221="Full";}else{if(_220<_222){_221="Seconds";}else{if(_220<(2*_222)){_221="Minute";}else{if(_220<_223){_221="Minutes";}else{if(_220<_224){_221="Hour";}else{if(_220<_225){_221="Hours";}else{if(_220<_226){_221="WeekDay";}else{_221="Full";}}}}}}}}if((_21d!==undefined)||_221){data=data||{};data.userId=_21d;if(_221){var _227=_19e.format,_228=new Date(_21e);data.minutes=Math.floor(_220/_222);data.hours=Math.floor(_220/_223);data.weekDay=_227(_228,{datePattern:"EEEE",selector:"date"});data.formattedDate=_227(_228,{selector:"date"});data.formattedTime=_227(_228,{selector:"time"});data.displayPattern=_221;data.timeValue=_21e;}}return data;},isEditable:function(){return !!(this._editable||this.userIsAdmin);},setMaxAllowableOffset:function(_229){if(!this.isEditable()){this._maxOffset=_229;}return this;},getMaxAllowableOffset:function(){return this._maxOffset;},setAutoGeneralize:function(_22a){if(!this.loaded){this._optAutoGen=_22a;}else{if(!this.isEditable()&&(this.mode!==this.constructor.MODE_SNAPSHOT)&&((this.geometryType==="esriGeometryPolyline")||(this.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_22a;if(_22a){var map=this._map;if(map&&map.loaded){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}else{delete this._maxOffset;}}}return this;},setGDBVersion:function(_22b){if(!this._collection&&(_22b!==this.gdbVersion)&&(_22b||this.gdbVersion)){this.gdbVersion=_22b;this._task.gdbVersion=_22b;this._url.query=lang.mixin(this._url.query,{gdbVersion:_22b});if(this.loaded){this.clearSelection();if(this._map){this.refresh();}}this.onGDBVersionChange();}return this;},setDefinitionExpression:function(expr){this._defnExpr=expr;var mode=this._mode;if(mode){mode.propertyChangeHandler(1);}return this;},getDefinitionExpression:function(){return this._defnExpr;},setTimeDefinition:function(_22c){if(this._isSnapshot){this._timeDefn=_22c;var mode=this._mode;if(mode){mode.propertyChangeHandler(2);}}else{console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id = "+this.id+", Layer URL = "+this.url);}return this;},getTimeDefinition:function(){return this._timeDefn;},setTimeOffset:function(_22d,_22e){this._timeOffset=_22d;this._timeOffsetUnits=_22e;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}return this;},setUseMapTime:function(use){this.useMapTime=use;this._toggleTime(!this.suspended);var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},selectFeatures:function(_22f,_230,_231,_232){_230=_230||this.constructor.SELECTION_NEW;var _233=this._getShallowClone(_22f),map=this._map,_234,dfd=_1a3._fixDfd(new _19d(_1a3._dfdCanceller));_233.outFields=this._getOutFields();_233.returnGeometry=true;if(map){_233.outSpatialReference=new _1a4(map.spatialReference.toJson());}if(!this._applyQueryFilters(_233)){_234={features:[]};this._selectHandler(_234,_230,_231,_232,dfd);return dfd;}var _235=this._canDoClientSideQuery(_233);if(_235){_234={features:this._doQuery(_233,_235)};this._selectHandler(_234,_230,_231,_232,dfd);return dfd;}else{if(this._collection){var err=new Error("FeatureLayer::selectFeatures - "+this.invalidParams);this._resolve([err],null,_232,dfd,true);return dfd;}var self=this;if(this._ts){_233._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task.execute(_233);temp.addCallbacks(function(_236){self._selectHandler(_236,_230,_231,_232,dfd);},function(err){self._resolve([err],null,_232,dfd,true);});return dfd;}},getSelectedFeatures:function(){var _237=this._selectedFeatures,_238=[],item;for(item in _237){if(_237.hasOwnProperty(item)){_238.push(_237[item]);}}return _238;},clearSelection:function(_239){var _23a=this._selectedFeatures,mode=this._mode,item;for(item in _23a){if(_23a.hasOwnProperty(item)){this._unSelectFeatureIIf(item,mode);mode._removeFeatureIIf(item);}}this._selectedFeatures={};if(this._isSelOnly){mode._applyTimeFilter(true);}if(!_239){this.onSelectionClear();}return this;},setSelectionSymbol:function(_23b){this._selectionSymbol=_23b;if(_23b){var _23c=this._selectedFeatures,item;for(item in _23c){if(_23c.hasOwnProperty(item)){_23c[item].setSymbol(_23b);}}}return this;},getSelectionSymbol:function(){return this._selectionSymbol;},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(adds,_23d,_23e,_23f,_240,_241){var _242=_241.assembly,dfd=_241.dfd;this._applyNormalized(adds,_242&&_242[0]);this._applyNormalized(_23d,_242&&_242[1]);this.onBeforeApplyEdits(adds,_23d,_23e);var i,_243={},_244=this.objectIdField,_245={f:"json"},_246=false;if(this._collection){var _247={};_247.addResults=adds?_19b.map(adds,function(){_246=true;return {objectId:this._nextId++,success:true};},this):null;_247.updateResults=_23d?_19b.map(_23d,function(_248){_246=true;var oid=_248.attributes[_244];_243[oid]=_248;return {objectId:oid,success:true};},this):null;_247.deleteResults=_23e?_19b.map(_23e,function(_249){_246=true;return {objectId:_249.attributes[_244],success:true};},this):null;if(_246){this._editHandler(_247,adds,_243,_23f,_240,dfd);}return;}if(adds&&adds.length>0){_245.adds=this._convertFeaturesToJson(adds,0,1);_246=true;}if(_23d&&_23d.length>0){for(i=0;i<_23d.length;i++){var _24a=_23d[i];_243[_24a.attributes[_244]]=_24a;}_245.updates=this._convertFeaturesToJson(_23d,0,0,1);_246=true;}if(_23e&&_23e.length>0){var ids=[];for(i=0;i<_23e.length;i++){ids.push(_23e[i].attributes[_244]);}_245.deletes=ids.join(",");_246=true;}if(_246){var self=this;return _1a2({url:this._url.path+"/applyEdits",content:lang.mixin(_245,this._url.query),callbackParamName:"callback",load:function(_24b){self._editHandler(_24b,adds,_243,_23f,_240,dfd);},error:function(err){self._resolve([err],null,_240,dfd,true);}},{usePost:true});}},queryFeatures:function(_24c,_24d,_24e){return this._query("execute","onQueryFeaturesComplete",_24c,_24d,_24e);},queryRelatedFeatures:function(_24f,_250,_251){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",_24f,_250,_251);},queryIds:function(_252,_253,_254){return this._query("executeForIds","onQueryIdsComplete",_252,_253,_254);},queryCount:function(_255,_256,_257){return this._query("executeForCount","onQueryCountComplete",_255,_256,_257);},queryAttachmentInfos:function(_258,_259,_25a){var url=this._url.path+"/"+_258+"/attachments",dfd=new _19d(_1a3._dfdCanceller),self=this;dfd._pendingDfd=_1a2({url:url,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(_25b){var _25c=_25b.attachmentInfos,_25d;_19b.forEach(_25c,function(info){_25d=ioq.objectToQuery({gdbVersion:self._url.query&&self._url.query.gdbVersion,layer:self._url.query&&self._url.query.layer,token:self._getToken()});info.url=url+"/"+info.id+(_25d?("?"+_25d):"");info.objectId=_258;});self._resolve([_25c],"onQueryAttachmentInfosComplete",_259,dfd);},error:function(err){self._resolve([err],null,_25a,dfd,true);}});return dfd;},addAttachment:function(_25e,_25f,_260,_261){return this._sendAttachment("add",_25e,_25f,_260,_261);},updateAttachment:function(_262,_263,_264,_265,_266){_264.appendChild(_19f.create("input",{type:"hidden",name:"attachmentId",value:_263}));return this._sendAttachment("update",_262,_264,_265,_266);},deleteAttachments:function(_267,_268,_269,_26a){var url=this._url.path+"/"+_267+"/deleteAttachments",dfd=new _19d(_1a3._dfdCanceller),self=this,_26b={f:"json",attachmentIds:_268.join(",")};dfd._pendingDfd=_1a2({url:url,content:lang.mixin(_26b,this._url.query),callbackParamName:"callback",load:lang.hitch(this,function(_26c){var _26d=_26c.deleteAttachmentResults;_26d=_19b.map(_26d,function(_26e){var res=new _1b7(_26e);res.attachmentId=res.objectId;res.objectId=_267;return res;});self._resolve([_26d],"onDeleteAttachmentsComplete",_269,dfd);}),error:function(err){self._resolve([err],null,_26a,dfd,true);}},{usePost:true});return dfd;},addType:function(_26f){var _270=this.types;if(_270){var _271=_19b.some(_270,function(type){if(type.id==_26f.id){return true;}return false;});if(_271){return false;}else{_270.push(_26f);}}else{this.types=[_26f];}this._typesDirty=true;return true;},deleteType:function(_272){if(!this._collection){return;}var _273=this.types;if(_273){var _274=-1;_19b.some(_273,function(type,_275){if(type.id==_272){_274=_275;return true;}return false;});if(_274>-1){this._typesDirty=true;return _273.splice(_274,1)[0];}}},toJson:function(){var _276=this._json,json=lang.isString(_276)?_19c.fromJson(_276):lang.clone(_276);if(!json){return;}json=json.layerDefinition?json:{layerDefinition:json};var _277=json.layerDefinition,_278=this._collection;if(_278&&this._typesDirty){_277.types=_19b.map(this.types||[],function(type){return type.toJson();});var _279=this.renderer,_27a=_277.drawingInfo;if(_27a&&_279&&_279.declaredClass.indexOf("TemporalRenderer")===-1){_27a.renderer=_279.toJson();}}var _27b=null;if(!(_278&&!this._fcAdded)){_27b={geometryType:_277.geometryType,features:this._convertFeaturesToJson(this.graphics,true)};}json.featureSet=lang.mixin({},json.featureSet||{},_27b);if(_278){json.nextObjectId=this._nextId;_277.capabilities=this.capabilities;}return json;},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(_27c){var self=this,path=this._url&&this._url.path;if((this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&path&&_1a0.id&&_1a0.id._hasPortalSession()&&_1a0.id._doPortalSignIn(path)){_1a0.id.getCredential(path).then(function(){self._findCredential();_27c.call(self);},function(){_27c.call(self);});}else{_27c.call(this);}},_updateCaps:function(){var _27d=this._editable,_27e=lang.trim(this.capabilities||""),_27f=_19b.map((_27e?_27e.split(","):[]),lang.trim),caps=_19b.map((_27e?_27e.toLowerCase().split(","):[]),lang.trim),_280=_19b.indexOf(caps,"editing"),cap,i,_281,_282={"Create":_19b.indexOf(caps,"create"),"Update":_19b.indexOf(caps,"update"),"Delete":_19b.indexOf(caps,"delete")};if(_27d&&_280===-1){_27f.push("Editing");}else{if(!_27d&&_280>-1){_281=[_280];for(cap in _282){if(_282[cap]>-1){_281.push(_282[cap]);}}_281.sort();for(i=_281.length-1;i>=0;i--){_27f.splice(_281[i],1);}}}this.capabilities=_27f.join(",");},_counter:{value:0},_getUniqueId:function(){return this._counter.value++;},onSuspend:function(){this.inherited(arguments);this._toggleTime(false);var mode=this._mode;if(mode){mode.suspend();}},onResume:function(evt){this.inherited(arguments);this._toggleTime(true);this._updateMaxOffset();var mode=this._mode,map=this._map,_283=this.renderer;if(evt.firstOccurrence){this.clearSelection();if(this.timeInfo){if(this._trackIdField||(_283&&(_283.latestObservationRenderer||_283.trackRenderer))){this._trackManager=new _1bb(this);this._trackManager.initialize(map);}}this._zoomConnect=_19a.connect(map,"onZoomEnd",this,this._updateMaxOffset);}if(mode){evt.firstOccurrence?mode.startup():mode.resume();}},_updateMaxOffset:function(){var map=this._map;if(map&&map.loaded){if(this._autoGeneralize){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}},_toggleTime:function(_284){var map=this._map;if(_284&&this.timeInfo&&this.useMapTime&&map){this._mapTimeExtent=map.timeExtent;if(!this._timeConnect){this._timeConnect=_19a.connect(map,"onTimeExtentChange",this,this._timeChangeHandler);}}else{this._mapTimeExtent=null;_19a.disconnect(this._timeConnect);this._timeConnect=null;}},_timeChangeHandler:function(_285){this._mapTimeExtent=_285;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},_getOffsettedTE:function(_286){var _287=this._timeOffset,_288=this._timeOffsetUnits;return (_286&&_287&&_288)?_286.offset(-1*_287,_288):_286;},_getTimeOverlap:function(_289,_28a){if(_289&&_28a){return _289.intersection(_28a);}else{return _289||_28a;}},_getTimeFilter:function(_28b){var _28c=this.getTimeDefinition(),_28d=null,_28e;if(_28c||_28d){_28e=this._getTimeOverlap(_28c,_28d);if(!_28e){return [false];}}if(_28b){_28b=_28e?this._getTimeOverlap(_28b,_28e):_28b;if(!_28b){return [false];}}else{_28b=_28e;}return [true,_28b];},_getAttributeFilter:function(_28f){var _290=this.getDefinitionExpression();if(_28f){_28f=_290?"("+_290+") AND ("+_28f+")":_28f;}else{_28f=_290;}return _28f;},_applyQueryFilters:function(_291){_291.where=this._getAttributeFilter(_291.where);_291.maxAllowableOffset=this._maxOffset;if(this.timeInfo){var _292=this._getTimeFilter(_291.timeExtent);if(!_292[0]){return false;}else{_291.timeExtent=_292[1];}}return true;},_add:function(_293){var _294=this._selectionSymbol,attr=_293.attributes,_295=this.visibilityField;if(_294&&this._isSelOnly){_293.setSymbol(_294);}if(_295&&attr&&attr.hasOwnProperty(_295)){_293[attr[_295]?"show":"hide"]();}return this.add.apply(this,arguments);},_remove:function(){return this.remove.apply(this,arguments);},_canDoClientSideQuery:function(_296){var _297=[],map=this._map;if(this._isTable||!map){return;}if(_296.text||(_296.where&&_296.where!==this.getDefinitionExpression())){return;}var _298=this._isSnapshot,_299=this._isSelOnly;var _29a=_296.geometry;if(_29a){if(!_299&&_296.spatialRelationship===_1ad.SPATIAL_REL_INTERSECTS&&(_29a.type==="extent"&&(_298||map.extent.contains(_29a)))){_297.push(1);}else{return;}}var ids=_296.objectIds;if(ids){if(_298){_297.push(2);}else{var len=ids.length,mode=this._mode,_29b=0,i;for(i=0;i<len;i++){if(mode._getFeature(ids[i])){_29b++;}}if(_29b===len){_297.push(2);}else{return;}}}if(this.timeInfo){var _29c=_296.timeExtent,_29d=this._mapTimeExtent;if(_298){if(_29c){_297.push(3);}}else{if(_299){if(_29c){return;}}else{if(_29d){if(_19b.indexOf(_297,2)!==-1){if(_29c){_297.push(3);}}else{return;}}else{if(_297.length>0){if(_29c){_297.push(3);}}else{if(_29c){return;}}}}}}return _297.length>0?_297:null;},_doQuery:function(_29e,_29f,_2a0){var _2a1=[],mode=this._mode,_2a2=this.objectIdField,i,len,_2a3;if(_19b.indexOf(_29f,2)!==-1){_2a1=[];var ids=_29e.objectIds;len=ids.length;for(i=0;i<len;i++){var obj=mode._getFeature(ids[i]);if(obj){_2a1.push(obj);}}if(_2a1.length===0){return [];}}if(_19b.indexOf(_29f,1)!==-1){_2a3=_2a1.length>0?_2a1:this.graphics;len=_2a3.length;var _2a4=_29e.geometry._normalize(null,true);_2a1=[];for(i=0;i<len;i++){var _2a5=_2a3[i],_2a6=_2a5.geometry;if(_2a6){if(this.normalization&&_2a4.length){if(_2a4[0].intersects(_2a6)||_2a4[1].intersects(_2a6)){_2a1.push(_2a5);}}else{if(_2a4.intersects(_2a6)){_2a1.push(_2a5);}}}}if(_2a1.length===0){return [];}}if(_19b.indexOf(_29f,3)!==-1){if(this.timeInfo){_2a3=_2a1.length>0?_2a1:this.graphics;var time=_29e.timeExtent,_2a7=this._filterByTime(_2a3,time.startTime,time.endTime);_2a1=_2a7.match;}}if(_2a0){return _19b.map(_2a1,function(obj){return obj.attributes[_2a2];},this);}else{return _2a1;}},_filterByTime:function(_2a8,_2a9,_2aa){var _2ab=this._startTimeField,_2ac=this._endTimeField,_2ad;if(!this._twoTimeFields){_2ad=_2ab||_2ac;}var _2ae=_1a1.isDefined,yea=[],nay=[],i,len=_2a8.length,_2af,_2b0;_2a9=_2a9?_2a9.getTime():-Infinity;_2aa=_2aa?_2aa.getTime():Infinity;if(_2ad){for(i=0;i<len;i++){_2af=_2a8[i];_2b0=_2af.attributes;var time=_2b0[_2ad];if(time>=_2a9&&time<=_2aa){yea.push(_2af);}else{nay.push(_2af);}}}else{for(i=0;i<len;i++){_2af=_2a8[i];_2b0=_2af.attributes;var _2b1=_2b0[_2ab],end=_2b0[_2ac];_2b1=_2ae(_2b1)?_2b1:-Infinity;end=_2ae(end)?end:Infinity;if((_2b1>=_2a9&&_2b1<=_2aa)||(end>=_2a9&&end<=_2aa)||(_2a9>=_2b1&&_2aa<=end)){yea.push(_2af);}else{nay.push(_2af);}}}return {match:yea,noMatch:nay};},_resolve:function(args,_2b2,_2b3,dfd,_2b4){if(_2b2){this[_2b2].apply(this,args);}if(_2b3){_2b3.apply(null,args);}if(dfd){_1a3._resDfd(dfd,args,_2b4);}},_getShallowClone:function(_2b5){var _2b6=new _1ad(),prop;for(prop in _2b5){if(_2b5.hasOwnProperty(prop)){_2b6[prop]=_2b5[prop];}}return _2b6;},_query:function(type,_2b7,_2b8,_2b9,_2ba){var that=this,map=this._map,dfd=new _19d(_1a3._dfdCanceller),_2bb=_2b8;var _2bc=function(_2bd,_2be){if(!_2be&&type==="execute"&&!that._isTable){var _2bf=_2bd.features,mode=that._mode,_2c0=that.objectIdField,il=_2bf.length,i;for(i=il-1;i>=0;i--){var oid=_2bf[i].attributes[_2c0];var _2c1=mode._getFeature(oid);if(_2c1){_2bf.splice(i,1,_2c1);}}}that._resolve([_2bd],_2b7,_2b9,dfd);};if(type!=="executeRelationshipQuery"){_2bb=this._getShallowClone(_2b8);_2bb.outFields=this._getOutFields();_2bb.returnGeometry=(!map&&_2b8.hasOwnProperty("returnGeometry"))?_2b8.returnGeometry:true;var _2c2;if(map){_2bb.outSpatialReference=new _1a4(map.spatialReference.toJson());}if(!this._applyQueryFilters(_2bb)){switch(type){case "execute":_2c2=new _1ae({features:[]});break;case "executeForIds":_2c2=[];break;case "executeForCount":_2c2=0;break;}_2bc(_2c2,true);return dfd;}var _2c3=this._canDoClientSideQuery(_2bb);if(_2c3){var _2c4=this._doQuery(_2bb,_2c3,(type==="executeForIds"||type==="executeForCount"));switch(type){case "execute":_2c2=new _1ae();_2c2.features=_2c4;break;case "executeForIds":_2c2=_2c4;break;case "executeForCount":_2c2=_2c4.length;break;}_2bc(_2c2,true);return dfd;}}if(this._collection){var err=new Error("FeatureLayer::_query - "+this.invalidParams);this._resolve([err],null,_2ba,dfd,true);return dfd;}if(this._ts){_2bb._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task[type](_2bb);temp.addCallbacks(_2bc,function(err){that._resolve([err],null,_2ba,dfd,true);});return dfd;},_convertFeaturesToJson:function(_2c5,_2c6,_2c7,_2c8){var json=[],_2c9=this._selectionSymbol,_2ca=this.visibilityField,i,_2cb,_2cc=this.objectIdField;if(this.loaded&&(_2c7||_2c8)){_2cb=_19b.filter(this.fields,function(_2cd){return (_2cd.editable===false)&&(!_2c8||(_2cd.name!==_2cc));});}for(i=0;i<_2c5.length;i++){var _2ce=_2c5[i],_2cf={},_2d0=_2ce.geometry,attr=_2ce.attributes,_2d1=_2ce.symbol;if(_2d0&&(!_2c8||!this.loaded||this.allowGeometryUpdates)){_2cf.geometry=_2d0.toJson();}if(_2ca){_2cf.attributes=attr=lang.mixin({},attr);attr[_2ca]=_2ce.visible?1:0;}else{if(attr){_2cf.attributes=lang.mixin({},attr);}}if(_2cf.attributes&&_2cb&&_2cb.length){_19b.forEach(_2cb,function(_2d2){delete _2cf.attributes[_2d2.name];});}if(_2d1&&(_2d1!==_2c9)){_2cf.symbol=_2d1.toJson();}json.push(_2cf);}return _2c6?json:_19c.toJson(json);},_selectHandler:function(_2d3,_2d4,_2d5,_2d6,dfd){var _2d7,ctor=this.constructor;switch(_2d4){case ctor.SELECTION_NEW:this.clearSelection(true);_2d7=true;break;case ctor.SELECTION_ADD:_2d7=true;break;case ctor.SELECTION_SUBTRACT:_2d7=false;break;}var i,_2d8=_2d3.features,mode=this._mode,_2d9=[],_2da=this.objectIdField,_2db,oid;if(_2d7){for(i=0;i<_2d8.length;i++){_2db=_2d8[i];oid=_2db.attributes[_2da];var _2dc=mode._addFeatureIIf(oid,_2db);_2d9.push(_2dc);this._selectFeatureIIf(oid,_2dc,mode);}}else{for(i=0;i<_2d8.length;i++){_2db=_2d8[i];oid=_2db.attributes[_2da];this._unSelectFeatureIIf(oid,mode);var _2dd=mode._removeFeatureIIf(oid);_2d9.push(_2dd||_2db);}}if(this._isSelOnly){mode._applyTimeFilter(true);}this._resolve([_2d9,_2d4,_2d3.exceededTransferLimit?{queryLimitExceeded:true}:null],"onSelectionComplete",_2d5,dfd);if(_2d3.exceededTransferLimit){this.onQueryLimitExceeded();}},_selectFeatureIIf:function(oid,_2de,mode){var _2df=this._selectedFeatures,_2e0=_2df[oid];if(!_2e0){mode._incRefCount(oid);_2df[oid]=_2de;if(!this._isTable){this._setSelectSymbol(_2de);}}return _2e0||_2de;},_unSelectFeatureIIf:function(oid,mode){var _2e1=this._selectedFeatures[oid];if(_2e1){mode._decRefCount(oid);delete this._selectedFeatures[oid];if(!this._isTable){this._setUnSelectSymbol(_2e1);}}return _2e1;},_isSelected:function(_2e2){},_setSelectSymbol:function(_2e3){var _2e4=this._selectionSymbol;if(_2e4&&!this._isSelOnly){_2e3.setSymbol(_2e4);}},_setUnSelectSymbol:function(_2e5){var _2e6=this._selectionSymbol;if(_2e6&&!this._isSelOnly){if(_2e6===_2e5.symbol){_2e5.setSymbol(null,true);}}},_getOutFields:function(){var _2e7=_19b.filter([this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields),function(_2e8,_2e9,arr){return !!_2e8&&(_19b.indexOf(arr,_2e8)===_2e9);});var _2ea=lang.clone(this._outFields);if(_2ea){if(_19b.indexOf(_2ea,"*")!==-1){return _2ea;}_19b.forEach(_2e7,function(_2eb){if(_19b.indexOf(_2ea,_2eb)===-1){_2ea.push(_2eb);}});return _2ea;}else{return _2e7;}},_checkFields:function(_2ec){var _2ed=_2ec||this._getOutFields();_19b.forEach(_2ed,function(_2ee){if(_2ee==="*"){return;}if(!this._getField(_2ee)){console.debug("esri.layers.FeatureLayer: "+_1a1.substitute({url:this.url,field:_2ee},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]"));}},this);if(!_2ec&&!this._isTable&&!this._fserver&&!this._collection){var _2ef=_19b.some(this.fields,function(_2f0){return (_2f0&&_2f0.type==="esriFieldTypeGeometry")?true:false;});if(!_2ef){console.debug("esri.layers.FeatureLayer: "+_1a1.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"));}}},_fixRendererFields:function(){var _2f1=this.renderer;if(_2f1&&this.fields.length>0){var _2f2=_19b.filter([_2f1,_2f1.observationRenderer,_2f1.latestObservationRenderer,_2f1.trackRenderer],_1a1.isDefined);var _2f3=[];_19b.forEach(_2f2,function(rnd){var _2f4,_2f5;_2f5=rnd.attributeField;if(_2f5&&!lang.isFunction(_2f5)){_2f4=!this._getField(_2f5)&&this._getField(_2f5,true);if(_2f4){rnd.attributeField=_2f4.name;}}_2f5=rnd.attributeField2;if(_2f5){_2f4=!this._getField(_2f5)&&this._getField(_2f5,true);if(_2f4){rnd.attributeField2=_2f4.name;}}_2f5=rnd.attributeField3;if(_2f5){_2f4=!this._getField(_2f5)&&this._getField(_2f5,true);if(_2f4){rnd.attributeField3=_2f4.name;}}if(!lang.isFunction(rnd.attributeField)){_2f3.push(rnd.attributeField);}_2f3.push(rnd.attributeField2);_2f3.push(rnd.attributeField3);},this);this._rendererFields=_19b.filter(_2f3,_1a1.isDefined);}},_getField:function(_2f6,_2f7){var _2f8=this.fields;if(_2f8.length===0){return null;}var _2f9;if(_2f7){_2f6=_2f6.toLowerCase();}_19b.some(_2f8,function(_2fa){var _2fb=false;if(_2f7){_2fb=(_2fa&&_2fa.name.toLowerCase()===_2f6)?true:false;}else{_2fb=(_2fa&&_2fa.name===_2f6)?true:false;}if(_2fb){_2f9=_2fa;}return _2fb;});return _2f9;},_getDateOpts:function(){if(!this._dtOpts){var _2fc=_19b.map(_19b.filter(this.fields,function(_2fd){return !!(_2fd&&_2fd.type==="esriFieldTypeDate");}),function(_2fe){return _2fe.name;});this._dtOpts={properties:_2fc};}return this._dtOpts;},_applyNormalized:function(_2ff,_300){if(_2ff&&_300){_19b.forEach(_2ff,function(_301,_302){if(_301&&_300[_302]){_301.setGeometry(_300[_302]);}});}},_editHandler:function(_303,adds,_304,_305,_306,dfd){var _307=_303.addResults,_308=_303.updateResults,_309=_303.deleteResults,i,_30a,oid,_30b,attr,_30c=this.objectIdField,mode=this._mode,_30d=this._isTable;var _30e=this.editFieldsInfo,_30f=this._getOutFields()||[],_310=_30e&&_30e.creatorField,_311=_30e&&_30e.creationDateField,_312=_30e&&_30e.editorField,_313=_30e&&_30e.editDateField,_314=_30e&&_30e.realm;if(_19b.indexOf(_30f,"*")===-1){if(_310&&_19b.indexOf(_30f,_310)===-1){_310=null;}if(_311&&_19b.indexOf(_30f,_311)===-1){_311=null;}if(_312&&_19b.indexOf(_30f,_312)===-1){_312=null;}if(_313&&_19b.indexOf(_30f,_313)===-1){_313=null;}}var _315=(_311||_313)?(new Date()).getTime():null,_316=(_310||_312)?this.getUserId():undefined;if(_316&&_314){_316=_316+"@"+_314;}if(_307){for(i=0;i<_307.length;i++){_307[i]=new _1b7(_307[i]);if(_30d){continue;}_30a=_307[i];if(_30a.success){oid=_30a.objectId;_30b=adds[i];var gl=_30b._graphicsLayer;if(gl&&gl!==this){gl.remove(_30b);}attr=_30b.attributes||{};attr[_30c]=oid;if(_310){attr[_310]=_316;}if(_312){attr[_312]=_316;}if(_311){attr[_311]=_315;}if(_313){attr[_313]=_315;}_30b.setAttributes(attr);if(mode._init){mode.drawFeature(_30b);}}}}if(_308){for(i=0;i<_308.length;i++){_308[i]=new _1b7(_308[i]);if(_30d){continue;}_30a=_308[i];if(_30a.success){oid=_30a.objectId;_30b=_304[oid];var _317=mode._getFeature(oid);if(_317){if(_317.geometry!==_30b.geometry){_317.setGeometry(_1b0.fromJson(_30b.geometry.toJson()));}this._repaint(_317,oid);}_30b=_317||_30b;attr=_30b.attributes||{};if(_312){attr[_312]=_316;}if(_313){attr[_313]=_315;}_30b.setAttributes(attr);}}}if(_309){var _318=[];for(i=0;i<_309.length;i++){_309[i]=new _1b7(_309[i]);if(_30d){continue;}_30a=_309[i];if(_30a.success){oid=_30a.objectId;_30b=mode._getFeature(oid);if(_30b){if(this._unSelectFeatureIIf(oid,mode)){_318.push(_30b);}_30b._count=0;mode._removeFeatureIIf(oid);}}}if(_318.length>0){this.onSelectionComplete(_318,this.constructor.SELECTION_SUBTRACT);}}this._resolve([_307,_308,_309],"onEditsComplete",_305,dfd);},_sendAttachment:function(type,_319,_31a,_31b,_31c){var _31d=(type==="add")?"addAttachment":"updateAttachment",url=this._url.path+"/"+_319+"/"+_31d,self=this;var dfd=_1a2({url:url,form:_31a,content:lang.mixin(this._url.query,{f:"json",token:this._getToken()||undefined}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(_31e){var _31f=(type==="add")?"addAttachmentResult":"updateAttachmentResult",_320=(type==="add")?"onAddAttachmentComplete":"onUpdateAttachmentComplete",_321=new _1b7(_31e[_31f]);_321.attachmentId=_321.objectId;_321.objectId=_319;self._resolve([_321],_320,_31b);return _321;}).addErrback(function(_322){self._resolve([_322],null,_31c,null,true);});return dfd;},_repaint:function(_323,oid,_324){oid=_1a1.isDefined(oid)?oid:_323.attributes[this.objectIdField];if(!(oid in this._selectedFeatures)||!this._selectionSymbol){_323.setSymbol(_323.symbol,_324);}},_getKind:function(_325){var _326=this._trackManager;if(_326){return _326.isLatestObservation(_325)?1:0;}return 0;}});lang.mixin(_1bc,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});_1b1._createWrappers(_1bc);if(has("extend-esri")){lang.setObject("layers.FeatureLayer",_1bc,_1a0);}return _1bc;});},"esri/virtualearth/VETiledLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/_base/array","dojo/_base/config","dojo/has","dojo/string","dojo/_base/Deferred","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/layers/TileInfo","esri/layers/TiledMapServiceLayer","esri/geometry/Extent","esri/request"],function(_327,lang,_328,_329,_32a,has,_32b,_32c,_32d,_32e,_32f,_330,_331,_332,_333){var VET=_327(_331,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(_334){try{_334=lang.mixin({bingMapsKey:null,culture:"en-US"},_334||{});var _335=window.location.protocol;if(_335==="file:"){_335="http:";}this.url=_335+"//dev.virtualearth.net/REST/v1";this._url=_32e.urlToObject(this.url);this.spatialReference=new _32f({wkid:102100});this.tileInfo=new _330({rows:256,cols:256,dpi:96,origin:{x:-20037508.342787,y:20037508.342787},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:295828763.795777},{level:2,resolution:39135.7584820001,scale:147914381.897889},{level:3,resolution:19567.8792409999,scale:73957190.948944},{level:4,resolution:9783.93962049996,scale:36978595.474472},{level:5,resolution:4891.96981024998,scale:18489297.737236},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=(this.fullExtent=new _332(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _32f({wkid:102100})));lang.mixin(this,_334);this.hasAttributionData=this.showAttribution;this._initLayer=lang.hitch(this,this._initLayer);this._errorHandler=lang.hitch(this,this._errorHandler);this._getTileInfo=lang.hitch(this,this._getTileInfo);if(this.bingMapsKey){this._getTileInfo();}else{throw new Error("BingMapsKey must be provided.");}}catch(e){this.onError(e);throw e;}},_unsetMap:function(map,_336){this.inherited("_unsetMap",arguments);},_getTileInfo:function(){if(!this.mapStyle){return;}var url=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var info=this.resourceInfo;if(!this.loaded&&info){this._initLayer(info);}else{_333({url:url,content:lang.mixin({},{key:this.bingMapsKey,ss:true,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler});}}},_initLayer:function(_337,io){try{this.resourceInfo=_328.toJson(_337);var _338=_337.resourceSets[0].resources[0];var _339=_338.imageUrl.replace("{","${");this.tileServers=_329.map(_338.imageUrlSubdomains,function(_33a){var _33b=window.location.protocol;if(_33b==="file:"){_33b="http:";}return _32b.substitute(_339,{subdomain:_33a}).replace("http:",_33b);});this._tsLength=this.tileServers.length;if(!this.loaded){this.copyright=this.copyright||"&copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=true;this.onLoad(this);var _33c=this.loadCallback;if(_33c){delete this.loadCallback;_33c(this);}}else{this.refresh();this.onMapStyleChange();}}catch(e){this.onError(e);}},getAttributionData:function(){var dfd=new _32c(),_33d=_328.fromJson(this.resourceInfo),_33e;if(this.hasAttributionData&&_33d){_33e=lang.getObject("resourceSets.0.resources.0.imageryProviders",false,_33d);}if(_33e){dfd.callback({contributors:_33e});}else{var err=new Error("Layer does not have attribution data");err.log=_32a.isDebug;dfd.errback(err);}return dfd;},getTileUrl:function(_33f,row,col){var _340=this.tileServers[row%this._tsLength],_341=_340.replace(/\{/g,"${");return _32b.substitute(_341,{quadkey:this._getQuadKey(_33f,row,col),culture:this.culture,token:this.bingMapsKey});},_getQuadKey:function(_342,row,col){var _343="",_344,mask,i;for(i=_342;i>0;i--){_344="0";mask=1<<(i-1);if((col&mask)!=0){_344++;}if((row&mask)!=0){_344++;_344++;}_343=_343+_344;}return _343;},setMapStyle:function(_345){this.mapStyle=_345;this._getTileInfo();},setCulture:function(_346){this.culture=_346;this._getTileInfo();},setBingMapsKey:function(_347){this.bingMapsKey=_347;},onMapStyleChange:function(){}});lang.mixin(VET,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});if(has("extend-esri")){lang.setObject("virtualearth.VETiledLayer",VET,_32d);}return VET;});},"dojo/touch":function(){define(["./_base/kernel","./aspect","./dom","./_base/lang","./on","./has","./mouse","./domReady","./_base/window"],function(dojo,_348,dom,lang,on,has,_349,_34a,win){var _34b=navigator.msPointerEnabled;var _34c;function _34d(_34e,_34f,_350){if(_34b&&_350){return function(node,_351){return on(node,_350,_351);};}else{if(has("touch")){return function(node,_352){var _353=on(node,_34f,_352),_354=on(node,_34e,function(evt){if(!_34c||(new Date()).getTime()>_34c+1000){_352.call(this,evt);}});return {remove:function(){_353.remove();_354.remove();}};};}else{return function(node,_355){return on(node,_34e,_355);};}}};var _356,_357,_358;if(has("touch")&&!_34b){_34a(function(){_358=win.body();win.doc.addEventListener("touchstart",function(_359){_34c=(new Date()).getTime();var _35a=_358;_358=_359.target;if(_358.dojoElementFromPoint){_358=_358.dojoElementFromPoint(_359.changedTouches[0].clientX,_359.changedTouches[0].clientY);}if(_35a){on.emit(_35a,"dojotouchout",{target:_35a,relatedTarget:_358,bubbles:true});}if(_358){on.emit(_358,"dojotouchover",{target:_358,relatedTarget:_35a,bubbles:true});}},true);on(win.doc,"touchmove",function(_35b){_34c=(new Date()).getTime();_357=_35b;var _35c=win.doc.elementFromPoint(_35b.clientX,_35b.clientY);if(_35c){var _35d=_35c;if(_35c.dojoElementFromPoint){_35c=_35c.dojoElementFromPoint(_35b.clientX,_35b.clientY);}if(_358!==_35c){if(_358){on.emit(_35d,"dojotouchout",{target:_358,relatedTarget:_35c,bubbles:true});}if(_35c){on.emit(_35d,"dojotouchover",{target:_35c,relatedTarget:_358,bubbles:true});}_358=_35c;}on.emit(_35d,"dojotouchmove",{target:_35c,bubbles:true});}});on(win.doc,"touchend",function(_35e){var node=win.doc.elementFromPoint(_35e.clientX,_35e.clientY);var _35f=node;if(node.dojoElementFromPoint){node=node.dojoElementFromPoint(_35e.clientX,_35e.clientY);}if(node){on.emit(_35f,"dojotouchend",lang.delegate(_35e,{target:node,bubbles:true}));}});});_356=function(node,_360){return on(node,"dojotouchmove",function(_361){_360(lang.delegate(_357,{target:_361.target,preventDefault:function(){_357.preventDefault();},stopPropagation:function(){_361.stopPropagation();}}));});};}var _362={press:_34d("mousedown","touchstart","MSPointerDown"),move:_34d("mousemove",_356,"MSPointerMove"),release:_34d("mouseup","dojotouchend","MSPointerUp"),cancel:_34d(_349.leave,"touchcancel",has("touch")?"MSPointerCancel":null),over:_34d("mouseover","dojotouchover","MSPointerOver"),out:_34d("mouseout","dojotouchout","MSPointerOut"),enter:_349._eventHandler(_34d("mouseover","dojotouchover","MSPointerOver")),leave:_349._eventHandler(_34d("mouseout","dojotouchout","MSPointerOut"))};1&&(dojo.touch=_362);return _362;});},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(_363,lang,_364,has,_365){var _366=_363(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(_367){if(_367){this.name=_367.name;this.title=_367.title;this.description=_367.description;this.extent=_367.extent;this.legendURL=_367.legendURL;this.subLayers=_367.subLayers?_367.subLayers:[];this.allExtents=_367.allExtents?_367.allExtents:[];this.spatialReferences=_367.spatialReferences?_367.spatialReferences:[];}},clone:function(){var info={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},wkid;if(this.extent){info.extent=this.extent.getExtent();}info.subLayers=[];_364.forEach(this.subLayers,function(_368){info.subLayers.push(_368.clone());});info.allExtents=[];for(wkid in this.allExtents){wkid=parseInt(wkid,10);if(!isNaN(wkid)){info.allExtents[wkid]=this.allExtents[wkid].getExtent();}}info.spatialReferences=[];_364.forEach(this.spatialReferences,function(wkid){info.spatialReferences.push(wkid);});return info;}});if(has("extend-esri")){lang.setObject("layers.WMSLayerInfo",_366,_365);}return _366;});},"dijit/_WidgetsInTemplateMixin":function(){define("dijit/_WidgetsInTemplateMixin",["dojo/_base/array","dojo/_base/declare","dojo/parser"],function(_369,_36a,_36b){return _36a("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:false,widgetsInTemplate:true,_beforeFillContent:function(){if(this.widgetsInTemplate){var node=this.domNode;var cw=(this._startupWidgets=_36b.parse(node,{noStart:!this._earlyTemplatedStartup,template:true,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,scope:"dojo"}));if(!cw.isFulfilled()){throw new Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), "+"unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}this._attachTemplateNodes(cw,function(n,p){return n[p];});}},startup:function(){_369.forEach(this._startupWidgets,function(w){if(w&&!w._started&&w.startup){w.startup();}});this.inherited(arguments);}});});},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(_36c,lang,has,_36d,_36e){var _36f=_36c(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(json){lang.mixin(this,json);if(_36e.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLFolder",_36f,_36d);}return _36f;});},"esri/layers/RenderMode":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/io/script","esri/kernel"],function(_370,_371,lang,_372,has,_373,_374){var _375=_371(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(_370._scopeName||"dojo")+"IoScript";},initialize:function(map){this.map=map;this._init=true;},startup:function(){},propertyChangeHandler:function(type){},destroy:function(){this._init=false;},drawFeature:function(_376){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(oid){var _377=this._featureMap[oid];if(_377){_377._count++;}},_decRefCount:function(oid){var _378=this._featureMap[oid];if(_378){_378._count--;}},_getFeature:function(oid){return this._featureMap[oid];},_addFeatureIIf:function(oid,_379){var fmap=this._featureMap,_37a=fmap[oid],_37b=this.featureLayer;if(!_37a){fmap[oid]=_379;_37b._add(_379);_379._count=0;}return _37a||_379;},_removeFeatureIIf:function(oid){var _37c=this._featureMap[oid],_37d=this.featureLayer;if(_37c){if(_37c._count){return;}delete this._featureMap[oid];_37d._remove(_37c);}return _37c;},_clearIIf:function(){var i,_37e=this.featureLayer,_37f=_37e.graphics,_380=_37e._selectedFeatures,_381=_37e.objectIdField;for(i=_37f.length-1;i>=0;i--){var _382=_37f[i];var oid=_382.attributes[_381];if(oid in _380){_382._count=1;continue;}_382._count=0;this._removeFeatureIIf(oid);}},_isPending:function(id){var dfd=_373[this._prefix+id];return dfd?true:false;},_cancelPendingRequest:function(dfd,id){dfd=dfd||_373[this._prefix+id];if(dfd){try{dfd.cancel();_373._validCheck(dfd);}catch(e){}}},_purgeRequests:function(){_373._validCheck(null);},_toggleVisibility:function(show){var _383=this.featureLayer,_384=_383.graphics,_385=show?"show":"hide",i,len=_384.length;show=show&&_383._ager;for(i=0;i<len;i++){var _386=_384[i];_386[_385]();if(show){_383._repaint(_386);}}},_applyTimeFilter:function(_387){var _388=this.featureLayer;if(!_388.timeInfo||_388.suspended){return;}if(!_387){_388._fireUpdateStart();}var _389=_388._trackManager;if(_389){_389.clearTracks();}var defn=_388.getTimeDefinition(),_38a=_388._getOffsettedTE(_388._mapTimeExtent);if(_38a){_38a=_388._getTimeOverlap(defn,_38a);if(_38a){var _38b=_388._filterByTime(_388.graphics,_38a.startTime,_38a.endTime);if(_389){_389.addFeatures(_38b.match);}_372.forEach(_38b.match,function(_38c){var _38d=_38c._shape;if(!_38c.visible){_38c.show();_38d=_38c._shape;_38d&&_38d._moveToFront();}if(_388._ager&&_38d){_388._repaint(_38c);}});_372.forEach(_38b.noMatch,function(_38e){if(_38e.visible){_38e.hide();}});}else{this._toggleVisibility(false);}}else{if(_389){_389.addFeatures(_388.graphics);}this._toggleVisibility(true);}if(_389){_389.moveLatestToFront();_389.drawTracks();}if(!_387){_388._fireUpdateEnd();}}});if(has("extend-esri")){lang.setObject("layers._RenderMode",_375,_374);}return _375;});},"esri/layers/FeatureType":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/symbols/jsonUtils","esri/layers/RangeDomain","esri/layers/CodedValueDomain","esri/layers/InheritedDomain","esri/layers/FeatureTemplate"],function(_38f,lang,_390,has,_391,_392,_393,_394,_395,_396,_397){var _398=_38f(null,{declaredClass:"esri.layers.FeatureType",constructor:function(json){if(json&&lang.isObject(json)){this.id=json.id;this.name=json.name;var _399=json.symbol;if(_399){this.symbol=_393.fromJson(_399);}var _39a=json.domains,_39b,i;var _39c=this.domains={};for(_39b in _39a){if(_39a.hasOwnProperty(_39b)){var _39d=_39a[_39b];switch(_39d.type){case "range":_39c[_39b]=new _394(_39d);break;case "codedValue":_39c[_39b]=new _395(_39d);break;case "inherited":_39c[_39b]=new _396(_39d);break;}}}var _39e=json.templates;if(_39e){var _39f=this.templates=[];for(i=0;i<_39e.length;i++){_39f.push(new _397(_39e[i]));}}}},toJson:function(){var json={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()};var _3a0,_3a1=this.domains,_3a2=this.templates,_3a3=_392.fixJson;if(_3a1){var _3a4=json.domains={};for(_3a0 in _3a1){if(_3a1.hasOwnProperty(_3a0)){_3a4[_3a0]=_3a1[_3a0]&&_3a1[_3a0].toJson();}}_3a3(_3a4);}if(_3a2){json.templates=_390.map(_3a2,function(_3a5){return _3a5.toJson();});}return _3a3(json);}});if(has("extend-esri")){lang.setObject("layers.FeatureType",_398,_391);}return _398;});},"esri/layers/TrackManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(_3a6,lang,_3a7,has,_3a8,_3a9,_3aa,_3ab){var _3ac=_3a6(null,{declaredClass:"esri.layers._TrackManager",constructor:function(_3ad){this.layer=_3ad;this.trackMap={};},initialize:function(map){this.map=map;var _3ae=this.layer,_3af=_3ae.renderer.trackRenderer;if(_3af&&(_3ae.geometryType==="esriGeometryPoint")){var _3b0=(this.container=new _3ab._GraphicsLayer({id:_3ae.id+"_tracks",_child:true}));_3b0.loaded=true;_3b0.onLoad(_3b0);_3b0._setMap(map,_3ae._div);_3b0.setRenderer(_3af);}},addFeatures:function(_3b1){var tkid,_3b2=this.trackMap,_3b3=this.layer,_3b4=_3b3._trackIdField;_3a7.forEach(_3b1,function(_3b5){var _3b6=_3b5.attributes;tkid=_3b6[_3b4];var ary=(_3b2[tkid]=(_3b2[tkid]||[]));ary.push(_3b5);});var _3b7=_3b3._startTimeField,_3b8=_3b3.objectIdField;var _3b9=function(a,b){var _3ba=a.attributes[_3b7],_3bb=b.attributes[_3b7];if(_3ba===_3bb){return (a.attributes[_3b8]<b.attributes[_3b8])?-1:1;}else{return (_3ba<_3bb)?-1:1;}};for(tkid in _3b2){_3b2[tkid].sort(_3b9);}},drawTracks:function(){var _3bc=this.container;if(!_3bc){return;}var _3bd=this.trackMap,sr=this.map.spatialReference,tkid,ary,path,i,_3be,_3bf=this.layer._trackIdField,_3c0;for(tkid in _3bd){ary=_3bd[tkid];path=[];for(i=ary.length-1;i>=0;i--){_3be=ary[i].geometry;if(_3be){path.push([_3be.x,_3be.y]);}}_3c0={};_3c0[_3bf]=tkid;if(path.length>0){_3bc.add(new _3a9(new _3aa({paths:[path],spatialReference:sr}),null,_3c0));}}},moveLatestToFront:function(){_3a7.forEach(this.getLatestObservations(),function(_3c1){var _3c2=_3c1._shape;_3c2&&_3c2._moveToFront();this._repaint(_3c1,null,true);},this.layer);},getLatestObservations:function(){var _3c3=[];if(!this.layer.renderer.latestObservationRenderer){return _3c3;}var _3c4=this.trackMap,tkid;for(tkid in _3c4){var ary=_3c4[tkid];_3c3.push(ary[ary.length-1]);}return _3c3;},clearTracks:function(){var _3c5=this.getLatestObservations();this.trackMap={};var _3c6=this.container;if(_3c6){_3c6.clear();}_3a7.forEach(_3c5,function(_3c7){this._repaint(_3c7,null,true);},this.layer);},isLatestObservation:function(_3c8){var _3c9=this.layer._trackIdField;var _3ca=this.trackMap[_3c8.attributes[_3c9]];if(_3ca){return (_3ca[_3ca.length-1]===_3c8);}return false;},destroy:function(){var _3cb=this.container;if(_3cb){_3cb.clear();_3cb._unsetMap(this.map,this.layer._div);this.container=null;}this.map=null;this.layer=null;this.trackMap=null;}});if(has("extend-esri")){lang.setObject("layers._TrackManager",_3ac,_3a8);}return _3ac;});},"esri/layers/GridLayout":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/Polyline"],function(_3cc,lang,_3cd,has,_3ce,_3cf,_3d0,_3d1){var _3d2=_3cc(null,{declaredClass:"esri.layers._GridLayout",constructor:function(_3d3,_3d4,_3d5,_3d6){this.origin=_3d3;this.cellWidth=_3d4.width;this.cellHeight=_3d4.height;this.mapWidth=_3d5.width;this.mapHeight=_3d5.height;this.srInfo=_3d6;},setResolution:function(_3d7){this._resolution=(_3d7.xmax-_3d7.xmin)/this.mapWidth;if(this.srInfo){var _3d8=Math.round((2*this.srInfo.valid[1])/this._resolution),_3d9=Math.round(_3d8/this.cellWidth);this._frameStats=[_3d9,0,_3d9-1];}},getCellCoordinates:function(_3da){var res=this._resolution,_3db=this.origin;return {row:Math.floor((_3db.y-_3da.y)/(this.cellHeight*res)),col:Math.floor((_3da.x-_3db.x)/(this.cellWidth*res))};},normalize:function(col){var _3dc=this._frameStats;if(_3dc){var _3dd=_3dc[0],m180=_3dc[1],p180=_3dc[2];if(col<m180){col=col%_3dd;col=col<m180?col+_3dd:col;}else{if(col>p180){col=col%_3dd;}}}return col;},intersects:function(_3de,_3df){var _3e0=this.srInfo;if(_3e0){return _3cd.some(_3df._getParts(_3e0),function(_3e1){return _3de.intersects(_3e1.extent);});}else{return _3de.intersects(_3df);}},getCellExtent:function(row,col){var res=this._resolution,_3e2=this.origin,_3e3=this.cellWidth,_3e4=this.cellHeight;return new _3d0((col*_3e3*res)+_3e2.x,_3e2.y-((row+1)*_3e4*res),((col+1)*_3e3*res)+_3e2.x,_3e2.y-(row*_3e4*res),new _3cf(_3e2.spatialReference.toJson()));},getLatticeID:function(_3e5){var _3e6=this.getCellCoordinates({x:_3e5.xmin,y:_3e5.ymax}),_3e7=this.getCellCoordinates({x:_3e5.xmax,y:_3e5.ymin}),_3e8=_3e6.row,_3e9=_3e7.row,_3ea=this.normalize(_3e6.col),_3eb=this.normalize(_3e7.col);return _3e8+"_"+_3e9+"_"+_3ea+"_"+_3eb;},sorter:function(a,b){return (a<b)?-1:1;},getCellsInExtent:function(_3ec,_3ed){var _3ee=this.getCellCoordinates({x:_3ec.xmin,y:_3ec.ymax}),_3ef=this.getCellCoordinates({x:_3ec.xmax,y:_3ec.ymin}),_3f0=_3ee.row,_3f1=_3ef.row,_3f2=_3ee.col,_3f3=_3ef.col,_3f4=[],i,j,nj,_3f5=[],_3f6=[],len,xmin,xmax,ymin,ymax,_3f7=[],_3f8,_3f9;for(i=_3f0;i<=_3f1;i++){for(j=_3f2;j<=_3f3;j++){nj=this.normalize(j);_3ec=this.getCellExtent(i,nj);_3f4.push({row:i,col:nj,extent:_3ec,resolution:this._resolution});if(_3ed){_3f5.push(_3ec.xmin,_3ec.xmax);_3f6.push(_3ec.ymin,_3ec.ymax);}}}_3f2=this.normalize(_3f2);_3f3=this.normalize(_3f3);_3f5.sort(this.sorter);_3f6.sort(this.sorter);len=_3f5.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_3f5[i]===_3f5[i+1]){_3f5.splice(i,1);}}}len=_3f6.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_3f6[i]===_3f6[i+1]){_3f6.splice(i,1);}}}if(_3f5.length&&_3f6.length){xmin=_3f5[0];xmax=_3f5[_3f5.length-1];ymin=_3f6[0];ymax=_3f6[_3f6.length-1];len=_3f5.length;for(i=0;i<len;i++){_3f7.push([[_3f5[i],ymax],[_3f5[i],ymin]]);}len=_3f6.length;for(i=0;i<len;i++){_3f7.push([[xmin,_3f6[i]],[xmax,_3f6[i]]]);}_3f8=new _3d1({paths:_3f7,spatialReference:this.origin.spatialReference.toJson()});_3f9=_3f0+"_"+_3f1+"_"+_3f2+"_"+_3f3;_3f4.push({latticeID:_3f9,lattice:_3f8,resolution:this._resolution});}return {minRow:_3f0,maxRow:_3f1,minCol:_3f2,maxCol:_3f3,cells:_3f4};}});if(has("extend-esri")){lang.setObject("layers._GridLayout",_3d2,_3ce);}return _3d2;});},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(lang,_3fa,_3fb){var _3fc={};lang.setObject("dojo.data.util.simpleFetch",_3fc);_3fc.errorHandler=function(_3fd,_3fe){if(_3fe.onError){var _3ff=_3fe.scope||_3fa.global;_3fe.onError.call(_3ff,_3fd,_3fe);}};_3fc.fetchHandler=function(_400,_401){var _402=_401.abort||null,_403=false,_404=_401.start?_401.start:0,_405=(_401.count&&(_401.count!==Infinity))?(_404+_401.count):_400.length;_401.abort=function(){_403=true;if(_402){_402.call(_401);}};var _406=_401.scope||_3fa.global;if(!_401.store){_401.store=this;}if(_401.onBegin){_401.onBegin.call(_406,_400.length,_401);}if(_401.sort){_400.sort(_3fb.createSortFunction(_401.sort,this));}if(_401.onItem){for(var i=_404;(i<_400.length)&&(i<_405);++i){var item=_400[i];if(!_403){_401.onItem.call(_406,item,_401);}}}if(_401.onComplete&&!_403){var _407=null;if(!_401.onItem){_407=_400.slice(_404,_405);}_401.onComplete.call(_406,_407,_401);}};_3fc.fetch=function(_408){_408=_408||{};if(!_408.store){_408.store=this;}this._fetchItems(_408,lang.hitch(this,"fetchHandler"),lang.hitch(this,"errorHandler"));return _408;};return _3fc;});},"dojox/data/CsvStore":function(){define("dojox/data/CsvStore",["dojo/_base/lang","dojo/_base/declare","dojo/_base/xhr","dojo/_base/kernel","dojo/data/util/filter","dojo/data/util/simpleFetch"],function(lang,_409,xhr,_40a,_40b,_40c){var _40d=_409("dojox.data.CsvStore",null,{constructor:function(_40e){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=false;if(_40e.url){this.url=_40e.url;}this._csvData=_40e.data;if(_40e.label){this.label=_40e.label;}else{if(this.label===""){this.label=undefined;}}this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];this.identifier=_40e.identifier;if(this.identifier===""){delete this.identifier;}else{this._idMap={};}if("separator" in _40e){this.separator=_40e.separator;}if("urlPreventCache" in _40e){this.urlPreventCache=_40e.urlPreventCache?true:false;}},url:"",label:"",identifier:"",separator:",",urlPreventCache:false,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error(this.declaredClass+": a function was passed an item argument that was not an item");}},_getIndex:function(item){var idx=this.getIdentity(item);if(this.identifier){idx=this._idMap[idx];}return idx;},getValue:function(item,_40f,_410){this._assertIsItem(item);var _411=_410;if(typeof _40f==="string"){var ai=this._attributeIndexes[_40f];if(ai!=null){var _412=this._dataArray[this._getIndex(item)];_411=_412[ai]||_410;}}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}return _411;},getValues:function(item,_413){var _414=this.getValue(item,_413);return (_414?[_414]:[]);},getAttributes:function(item){this._assertIsItem(item);var _415=[];var _416=this._dataArray[this._getIndex(item)];for(var i=0;i<_416.length;i++){if(_416[i]!==""){_415.push(this._attributes[i]);}}return _415;},hasAttribute:function(item,_417){this._assertIsItem(item);if(typeof _417==="string"){var _418=this._attributeIndexes[_417];var _419=this._dataArray[this._getIndex(item)];return (typeof _418!=="undefined"&&_418<_419.length&&_419[_418]!=="");}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}},containsValue:function(item,_41a,_41b){var _41c=undefined;if(typeof _41b==="string"){_41c=_40b.patternToRegExp(_41b,false);}return this._containsValue(item,_41a,_41b,_41c);},_containsValue:function(item,_41d,_41e,_41f){var _420=this.getValues(item,_41d);for(var i=0;i<_420.length;++i){var _421=_420[i];if(typeof _421==="string"&&_41f){return (_421.match(_41f)!==null);}else{if(_41e===_421){return true;}}}return false;},isItem:function(_422){if(_422&&_422[this._storeProp]===this){var _423=_422[this._idProp];if(this.identifier){var data=this._dataArray[this._idMap[_423]];if(data){return true;}}else{if(_423>=0&&_423<this._dataArray.length){return true;}}}return false;},isItemLoaded:function(_424){return this.isItem(_424);},loadItem:function(item){},getFeatures:function(){return this._features;},getLabel:function(item){if(this.label&&this.isItem(item)){return this.getValue(item,this.label);}return undefined;},getLabelAttributes:function(item){if(this.label){return [this.label];}return null;},_fetchItems:function(_425,_426,_427){var self=this;var _428=function(_429,_42a){var _42b=null;if(_429.query){var key,_42c;_42b=[];var _42d=_429.queryOptions?_429.queryOptions.ignoreCase:false;var _42e={};for(key in _429.query){_42c=_429.query[key];if(typeof _42c==="string"){_42e[key]=_40b.patternToRegExp(_42c,_42d);}}for(var i=0;i<_42a.length;++i){var _42f=true;var _430=_42a[i];for(key in _429.query){_42c=_429.query[key];if(!self._containsValue(_430,key,_42c,_42e[key])){_42f=false;}}if(_42f){_42b.push(_430);}}}else{_42b=_42a.slice(0,_42a.length);}_426(_42b,_429);};if(this._loadFinished){_428(_425,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_425,filter:_428});}else{this._loadInProgress=true;var _431={url:self.url,handleAs:"text",preventCache:self.urlPreventCache};var _432=xhr.get(_431);_432.addCallback(function(data){try{self._processData(data);_428(_425,self._arrayOfAllItems);self._handleQueuedFetches();}catch(e){_427(e,_425);}});_432.addErrback(function(_433){self._loadInProgress=false;if(_427){_427(_433,_425);}else{throw _433;}});var _434=null;if(_425.abort){_434=_425.abort;}_425.abort=function(){var df=_432;if(df&&df.fired===-1){df.cancel();df=null;}if(_434){_434.call(_425);}};}}else{if(this._csvData){try{this._processData(this._csvData);this._csvData=null;_428(_425,this._arrayOfAllItems);}catch(e){_427(e,_425);}}else{var _435=new Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(_427){_427(_435,_425);}else{throw _435;}}}}},close:function(_436){},_getArrayOfArraysFromCsvFileContents:function(_437){if(lang.isString(_437)){var _438=new RegExp("^\\s+","g");var _439=new RegExp("\\s+$","g");var _43a=new RegExp("\"\"","g");var _43b=[];var i;var _43c=this._splitLines(_437);for(i=0;i<_43c.length;++i){var _43d=_43c[i];if(_43d.length>0){var _43e=_43d.split(this.separator);var j=0;while(j<_43e.length){var _43f=_43e[j];var _440=_43f.replace(_438,"");var _441=_440.replace(_439,"");var _442=_441.charAt(0);var _443=_441.charAt(_441.length-1);var _444=_441.charAt(_441.length-2);var _445=_441.charAt(_441.length-3);if(_441.length===2&&_441=="\"\""){_43e[j]="";}else{if((_442=="\"")&&((_443!="\"")||((_443=="\"")&&(_444=="\"")&&(_445!="\"")))){if(j+1===_43e.length){return;}var _446=_43e[j+1];_43e[j]=_440+this.separator+_446;_43e.splice(j+1,1);}else{if((_442=="\"")&&(_443=="\"")){_441=_441.slice(1,(_441.length-1));_441=_441.replace(_43a,"\"");}_43e[j]=_441;j+=1;}}}_43b.push(_43e);}}this._attributes=_43b.shift();for(i=0;i<this._attributes.length;i++){this._attributeIndexes[this._attributes[i]]=i;}this._dataArray=_43b;}},_splitLines:function(_447){var _448=[];var i;var line="";var _449=false;for(i=0;i<_447.length;i++){var c=_447.charAt(i);switch(c){case "\"":_449=!_449;line+=c;break;case "\r":if(_449){line+=c;}else{_448.push(line);line="";if(i<(_447.length-1)&&_447.charAt(i+1)=="\n"){i++;}}break;case "\n":if(_449){line+=c;}else{_448.push(line);line="";}break;default:line+=c;}}if(line!==""){_448.push(line);}return _448;},_processData:function(data){this._getArrayOfArraysFromCsvFileContents(data);this._arrayOfAllItems=[];if(this.identifier){if(this._attributeIndexes[this.identifier]===undefined){throw new Error(this.declaredClass+": Identity specified is not a column header in the data set.");}}for(var i=0;i<this._dataArray.length;i++){var id=i;if(this.identifier){var _44a=this._dataArray[i];id=_44a[this._attributeIndexes[this.identifier]];this._idMap[id]=i;}this._arrayOfAllItems.push(this._createItemFromIdentity(id));}this._loadFinished=true;this._loadInProgress=false;},_createItemFromIdentity:function(_44b){var item={};item[this._storeProp]=this;item[this._idProp]=_44b;return item;},getIdentity:function(item){if(this.isItem(item)){return item[this._idProp];}return null;},fetchItemByIdentity:function(_44c){var item;var _44d=_44c.scope?_44c.scope:_40a.global;if(!this._loadFinished){var self=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_44c});}else{this._loadInProgress=true;var _44e={url:self.url,handleAs:"text"};var _44f=xhr.get(_44e);_44f.addCallback(function(data){try{self._processData(data);var item=self._createItemFromIdentity(_44c.identity);if(!self.isItem(item)){item=null;}if(_44c.onItem){_44c.onItem.call(_44d,item);}self._handleQueuedFetches();}catch(error){if(_44c.onError){_44c.onError.call(_44d,error);}}});_44f.addErrback(function(_450){this._loadInProgress=false;if(_44c.onError){_44c.onError.call(_44d,_450);}});}}else{if(this._csvData){try{self._processData(self._csvData);self._csvData=null;item=self._createItemFromIdentity(_44c.identity);if(!self.isItem(item)){item=null;}if(_44c.onItem){_44c.onItem.call(_44d,item);}}catch(e){if(_44c.onError){_44c.onError.call(_44d,e);}}}}}else{item=this._createItemFromIdentity(_44c.identity);if(!this.isItem(item)){item=null;}if(_44c.onItem){_44c.onItem.call(_44d,item);}}},getIdentityAttributes:function(item){if(this.identifier){return [this.identifier];}else{return null;}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _451=this._queuedFetches[i];var _452=_451.filter;var _453=_451.args;if(_452){_452(_453,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_451.args);}}this._queuedFetches=[];}}});lang.extend(_40d,_40c);return _40d;});},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(lang,_454){var _455={};lang.setObject("dojo.date.stamp",_455);_455.fromISOString=function(_456,_457){if(!_455._isoRegExp){_455._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;}var _458=_455._isoRegExp.exec(_456),_459=null;if(_458){_458.shift();if(_458[1]){_458[1]--;}if(_458[6]){_458[6]*=1000;}if(_457){_457=new Date(_457);_454.forEach(_454.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(prop){return _457["get"+prop]();}),function(_45a,_45b){_458[_45b]=_458[_45b]||_45a;});}_459=new Date(_458[0]||1970,_458[1]||0,_458[2]||1,_458[3]||0,_458[4]||0,_458[5]||0,_458[6]||0);if(_458[0]<100){_459.setFullYear(_458[0]||1970);}var _45c=0,_45d=_458[7]&&_458[7].charAt(0);if(_45d!="Z"){_45c=((_458[8]||0)*60)+(Number(_458[9])||0);if(_45d!="-"){_45c*=-1;}}if(_45d){_45c-=_459.getTimezoneOffset();}if(_45c){_459.setTime(_459.getTime()+_45c*60000);}}return _459;};_455.toISOString=function(_45e,_45f){var _460=function(n){return (n<10)?"0"+n:n;};_45f=_45f||{};var _461=[],_462=_45f.zulu?"getUTC":"get",date="";if(_45f.selector!="time"){var year=_45e[_462+"FullYear"]();date=["0000".substr((year+"").length)+year,_460(_45e[_462+"Month"]()+1),_460(_45e[_462+"Date"]())].join("-");}_461.push(date);if(_45f.selector!="date"){var time=[_460(_45e[_462+"Hours"]()),_460(_45e[_462+"Minutes"]()),_460(_45e[_462+"Seconds"]())].join(":");var _463=_45e[_462+"Milliseconds"]();if(_45f.milliseconds){time+="."+(_463<100?"0":"")+_460(_463);}if(_45f.zulu){time+="Z";}else{if(_45f.selector!="time"){var _464=_45e.getTimezoneOffset();var _465=Math.abs(_464);time+=(_464>0?"-":"+")+_460(Math.floor(_465/60))+":"+_460(_465%60);}}_461.push(time);}return _461.join("T");};return _455;});},"dijit/_Templated":function(){define("dijit/_Templated",["./_WidgetBase","./_TemplatedMixin","./_WidgetsInTemplateMixin","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/kernel"],function(_466,_467,_468,_469,_46a,lang,_46b){lang.extend(_466,{waiRole:"",waiState:""});return _46a("dijit._Templated",[_467,_468],{widgetsInTemplate:false,constructor:function(){_46b.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0");},_attachTemplateNodes:function(_46c,_46d){this.inherited(arguments);var _46e=lang.isArray(_46c)?_46c:(_46c.all||_46c.getElementsByTagName("*"));var x=lang.isArray(_46c)?0:-1;for(;x<_46e.length;x++){var _46f=(x==-1)?_46c:_46e[x];var role=_46d(_46f,"waiRole");if(role){_46f.setAttribute("role",role);}var _470=_46d(_46f,"waiState");if(_470){_469.forEach(_470.split(/\s*,\s*/),function(_471){if(_471.indexOf("-")!=-1){var pair=_471.split("-");_46f.setAttribute("aria-"+pair[0],pair[1]);}});}}}});});},"esri/dijit/PopupRenderer":function(){define(["require","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/kernel","dojo/has","dojo/query","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_Widget","dijit/_Templated","esri/kernel","dojo/i18n!esri/nls/jsapi","dojo/NodeList-dom"],function(_472,_473,_474,lang,_475,_476,has,_477,dom,_478,_479,_47a,_47b,_47c,_47d,_47e,_47f){var _480=0;var PR=_473([_47c,_47d],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=lang.mixin({},_47f.widgets.popup);},templateString:"<div class='esriViewPopup'>"+"<div class='mainSection'>"+"<div class='header' dojoAttachPoint='_title'></div>"+"<div class='hzLine'></div>"+"<div dojoAttachPoint='_description'></div>"+"<div class='break'></div>"+"</div>"+"<div class='attachmentsSection hidden'>"+"<div>${_nls.NLS_attach}:</div>"+"<ul dojoAttachPoint='_attachmentsList'>"+"</ul>"+"<div class='break'></div>"+"</div>"+"<div class='mediaSection hidden'>"+"<div class='header' dojoAttachPoint='_mediaTitle'></div>"+"<div class='hzLine'></div>"+"<div class='caption' dojoAttachPoint='_mediaCaption'></div>"+"<div class='gallery' dojoAttachPoint='_gallery'>"+"<div class='mediaHandle prev' dojoAttachPoint='_prevMedia' dojoAttachEvent='onclick: _goToPrevMedia'></div>"+"<div class='mediaHandle next' dojoAttachPoint='_nextMedia' dojoAttachEvent='onclick: _goToNextMedia'></div>"+"<ul class='summary'>"+"<li class='image mediaCount hidden' dojoAttachPoint='_imageCount'>0</li>"+"<li class='image mediaIcon hidden'></li>"+"<li class='chart mediaCount hidden' dojoAttachPoint='_chartCount'>0</li>"+"<li class='chart mediaIcon hidden'></li>"+"</ul>"+"<div class='frame' dojoAttachPoint='_mediaFrame'></div>"+"</div>"+"</div>"+"<div class='editSummarySection hidden' dojoAttachPoint='_editSummarySection'>"+"<div class='break'></div>"+"<div class='break hidden' dojoAttachPoint='_mediaBreak'></div>"+"<div class='editSummary' dojoAttachPoint='_editSummary'></div>"+"</div>"+"</div>",startup:function(){this.inherited(arguments);var _481=this.template,_482=this.graphic,_483=_481.getComponents(_482),_484=_483.title,_485=_483.description,_486=_483.fields,_487=_483.mediaInfos,_488=this.domNode,nls=this._nls;this._prevMedia.title=nls.NLS_prevMedia;this._nextMedia.title=nls.NLS_nextMedia;_478.set(this._title,"innerHTML",_484);if(!_484){_479.add(this._title,"hidden");}if(!_485&&_486){_485="";_475.forEach(_486,function(row){_485+=("<tr valign='top'>");_485+=("<td class='attrName'>"+row[0]+"</td>");_485+=("<td class='attrValue'>"+row[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"<a target='_blank' href='$1' title='$1'>"+nls.NLS_moreInfo+"</a>")+"</td>");_485+=("</tr>");});if(_485){_485="<table class='attrTable' cellpadding='0px' cellspacing='0px'>"+_485+"</table>";}}_478.set(this._description,"innerHTML",_485);if(!_485){_479.add(this._description,"hidden");}_476.query("a",this._description).forEach(function(node){_478.set(node,"target","_blank");});if(_484&&_485){_476.query(".mainSection .hzLine",_488).removeClass("hidden");}else{if(_484||_485){_476.query(".mainSection .hzLine",_488).addClass("hidden");}else{_476.query(".mainSection",_488).addClass("hidden");}}var dfd=(this._dfd=_481.getAttachments(_482));if(dfd){dfd.addBoth(lang.hitch(this,this._attListHandler,dfd));_478.set(this._attachmentsList,"innerHTML","<li>"+nls.NLS_searching+"...</li>");_476.query(".attachmentsSection",_488).removeClass("hidden");}if(_487&&_487.length){_476.query(".mediaSection",_488).removeClass("hidden");dom.setSelectable(this._mediaFrame,false);this._mediaInfos=_487;this._mediaPtr=0;this._updateUI();this._displayMedia();}if(_483.editSummary){_478.set(this._editSummary,"innerHTML",_483.editSummary);if(_487&&_487.length){_479.remove(this._mediaBreak,"hidden");}_479.remove(this._editSummarySection,"hidden");}},destroy:function(){if(this._dfd){this._dfd.cancel();}this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments);},_goToPrevMedia:function(){var ptr=this._mediaPtr-1;if(ptr<0){return;}this._mediaPtr--;this._updateUI();this._displayMedia();},_goToNextMedia:function(){var ptr=this._mediaPtr+1;if(ptr===this._mediaInfos.length){return;}this._mediaPtr++;this._updateUI();this._displayMedia();},_updateUI:function(){var _489=this._mediaInfos,_48a=_489.length,_48b=this.domNode,_48c=this._prevMedia,_48d=this._nextMedia;if(_48a>1){var _48e=0,_48f=0;_475.forEach(_489,function(info){if(info.type==="image"){_48e++;}else{if(info.type.indexOf("chart")!==-1){_48f++;}}});if(_48e){_478.set(this._imageCount,"innerHTML",_48e);_476.query(".summary .image",_48b).removeClass("hidden");}if(_48f){_478.set(this._chartCount,"innerHTML",_48f);_476.query(".summary .chart",_48b).removeClass("hidden");}}else{_476.query(".summary",_48b).addClass("hidden");_479.add(_48c,"hidden");_479.add(_48d,"hidden");}var ptr=this._mediaPtr;if(ptr===0){_479.add(_48c,"hidden");}else{_479.remove(_48c,"hidden");}if(ptr===_48a-1){_479.add(_48d,"hidden");}else{_479.remove(_48d,"hidden");}this._destroyFrame();},_displayMedia:function(){var info=this._mediaInfos[this._mediaPtr],_490=info.title,_491=info.caption,_492=_476.query(".mediaSection .hzLine",this.domNode)[0];_478.set(this._mediaTitle,"innerHTML",_490);_479[_490?"remove":"add"](this._mediaTitle,"hidden");_478.set(this._mediaCaption,"innerHTML",_491);_479[_491?"remove":"add"](this._mediaCaption,"hidden");_479[(_490&&_491)?"remove":"add"](_492,"hidden");this._rid=null;if(info.type==="image"){this._showImage(info.value);}else{var self=this,_493=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],_494=info.value.theme||this.chartTheme||"esri/dijit/Rainbow";if(lang.isString(_494)){_494=_494.replace(/\./gi,"/");if(_494.indexOf("/")===-1){_494="dojox/charting/themes/"+_494;}_493.push(_494);}try{var rid=(this._rid=_480++);_472(_493,function(_495,_496,_497){if(rid===self._rid){self._rid=null;self._showChart(info.type,info.value,_495,_496,_497);}});}catch(err){console.log("PopupRenderer: error loading modules");}}},_showImage:function(_498){_479.add(this._mediaFrame,"image");var _499=_47b.get(this._gallery,"height"),html="<img class='esriPopupMediaImage' src='"+_498.sourceURL+"' />";if(_498.linkURL){html="<a target='_blank' href='"+_498.linkURL+"'>"+html+"</a>";}_478.set(this._mediaFrame,"innerHTML",html);var img=_476.query(".esriPopupMediaImage",this._mediaFrame)[0],self=this,_49a;_49a=_474.connect(img,"onload",function(){_474.disconnect(_49a);_49a=null;self._imageLoaded(img,_499);});},_showChart:function(type,_49b,_49c,_49d,_49e){_479.remove(this._mediaFrame,"image");var _49f=this._chart=new _49c(_47a.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});if(_49e){_49f.setTheme(_49e);}switch(type){case "piechart":_49f.addPlot("default",{type:"Pie",labels:false});_49f.addSeries("Series A",_49b.fields);break;case "linechart":_49f.addPlot("default",{type:"Markers"});_49f.addAxis("x",{min:0,majorTicks:false,minorTicks:false,majorLabels:false,minorLabels:false});_49f.addAxis("y",{includeZero:true,vertical:true,fixUpper:"minor"});_475.forEach(_49b.fields,function(info,idx){info.x=idx+1;});_49f.addSeries("Series A",_49b.fields);break;case "columnchart":_49f.addPlot("default",{type:"Columns",gap:3});_49f.addAxis("y",{includeZero:true,vertical:true,fixUpper:"minor"});_49f.addSeries("Series A",_49b.fields);break;case "barchart":_49f.addPlot("default",{type:"Bars",gap:3});_49f.addAxis("x",{includeZero:true,fixUpper:"minor",minorLabels:false});_49f.addAxis("y",{vertical:true,majorTicks:false,minorTicks:false,majorLabels:false,minorLabels:false});_49f.addSeries("Series A",_49b.fields);break;}this._action=new _49d(_49f);_49f.render();},_destroyFrame:function(){this._rid=null;if(this._chart){this._chart.destroy();this._chart=null;}if(this._action){this._action.destroy();this._action=null;}_478.set(this._mediaFrame,"innerHTML","");},_imageLoaded:function(img,_4a0){var _4a1=img.height;if(_4a1<_4a0){var diff=Math.round((_4a0-_4a1)/2);_47b.set(img,"marginTop",diff+"px");}},_attListHandler:function(dfd,_4a2){if(dfd===this._dfd){this._dfd=null;var html="";if(!(_4a2 instanceof Error)&&_4a2&&_4a2.length){_475.forEach(_4a2,function(info){html+=("<li>");html+=("<a href='"+info.url+"' target='_blank'>"+(info.name||"[No name]")+"</a>");html+=("</li>");});}_478.set(this._attachmentsList,"innerHTML",html||"<li>"+this._nls.NLS_noAttach+"</li>");}}});if(has("extend-esri")){lang.setObject("dijit._PopupRenderer",PR,_47e);}return PR;});},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(lang){var _4a3={};lang.setObject("dojo.data.util.sorter",_4a3);_4a3.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_4a3.createSortFunction=function(_4a4,_4a5){var _4a6=[];function _4a7(attr,dir,comp,s){return function(_4a8,_4a9){var a=s.getValue(_4a8,attr);var b=s.getValue(_4a9,attr);return dir*comp(a,b);};};var _4aa;var map=_4a5.comparatorMap;var bc=_4a3.basicComparator;for(var i=0;i<_4a4.length;i++){_4aa=_4a4[i];var attr=_4aa.attribute;if(attr){var dir=(_4aa.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_4a6.push(_4a7(attr,dir,comp,_4a5));}}return function(rowA,rowB){var i=0;while(i<_4a6.length){var ret=_4a6[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _4a3;});},"esri/layers/KMLGroundOverlay":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/layers/MapImage"],function(_4ab,lang,has,_4ac,_4ad,_4ae){var _4af=_4ab([_4ae],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(json){if(_4ad.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLGroundOverlay",_4af,_4ac);}return _4af;});},"esri/layers/MapImageLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/sniff","esri/domUtils","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/layers/layer"],function(_4b0,_4b1,lang,_4b2,_4b3,_4b4,_4b5,_4b6,has,_4b7,_4b8,_4b9,_4ba){var _4bb=_4b0([_4ba],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(_4bc){this.inherited(arguments,[null,_4bc]);this._mapImages=[];var _4bd=lang.hitch;this._panStart=_4bd(this,this._panStart);this._pan=_4bd(this,this._pan);this._extentChange=_4bd(this,this._extentChange);this._zoom=_4bd(this,this._zoom);this._zoomStart=_4bd(this,this._zoomStart);this._scale=_4bd(this,this._scale);this._resize=_4bd(this,this._resize);_4b1.connect(this,"onSuspend",this,this._onSuspend);_4b1.connect(this,"onResume",this,this._onResume);this.loaded=true;this.onLoad(this);},opacity:1,_transform:_4b5._getDOMAccessor("transform"),addImage:function(_4be){var _4bf=this._mapImages.push(_4be);_4bf=_4bf-1;_4be._idx=_4bf;_4be._layer=this;if(this._div){this._createImage(_4be,_4bf);}},removeImage:function(_4c0){if(_4c0){var idx=_4c0._idx,_4c1=this._mapImages;if(_4c1[idx]===_4c0){delete _4c1[idx];var node=_4c0._node;if(node){this._clearEvents(node);node.e_idx=node.e_bl=node.e_tr=node.e_l=node.e_t=node.e_w=node.e_h=null;if(node.parentNode){node.parentNode.removeChild(node);_4b3.destroy(node);}}_4c0._node=_4c0._idx=_4c0._layer=null;}}},removeAllImages:function(){var _4c2=this._mapImages,i,len=_4c2.length;for(i=0;i<len;i++){var _4c3=_4c2[i];if(_4c3){this.removeImage(_4c3);}}this._mapImages=[];},getImages:function(){var _4c4=this._mapImages,_4c5=[],i,len=_4c4.length;for(i=0;i<len;i++){if(_4c4[i]){_4c5.push(_4c4[i]);}}return _4c5;},setOpacity:function(_4c6){if(this.opacity!=_4c6){this._opacityChanged(this.opacity=_4c6);this.onOpacityChange();}},onOpacityChange:function(){},_opacityChanged:function(_4c7){var div=this._div,i,len,_4c8;if(div){if(!has("ie")||has("ie")>8){_4b4.set(div,"opacity",_4c7);}else{_4c8=div.childNodes;len=_4c8.length;for(i=0;i<len;i++){_4b4.set(_4c8[i],"opacity",_4c7);}}}},_createImage:function(_4c9,idx){var node=_4b3.create("img");_4b4.set(node,{position:"absolute"});if(has("ie")<=8){_4b4.set(node,"opacity",this.opacity);}if(_4c9.rotation){var _4ca="rotate("+(360-_4c9.rotation)+"deg)";if(has("ie")<9){}else{_4b4.set(node,this._transform,_4ca);_4b4.set(node,"transform",_4ca);}}_4c9._node=node;node.e_idx=idx;node.e_layer=this;node.e_load=_4b1.connect(node,"onload",_4bb.prototype._imageLoaded);node.e_error=_4b1.connect(node,"onerror",_4bb.prototype._imageError);node.e_abort=_4b1.connect(node,"onabort",_4bb.prototype._imageError);node.src=_4c9.href;},_imageLoaded:function(evt,img){var node=img||evt.target||evt.currentTarget,self=node.e_layer,_4cb=self._mapImages[node.e_idx],map=self._map;if(map&&(map.__zooming||map.__panning||!self._sr)){self._standby.push(node);return;}self._clearEvents(node);if(!_4cb||_4cb._node!==node){return;}if(map){self._attach(_4cb);}},_imageError:function(evt){var node=evt.target||evt.currentTarget,self=node.e_layer,_4cc=self._mapImages[node.e_idx];self._clearEvents(node);if(_4cc){_4cc._node=null;}},_clearEvents:function(node){var _4cd=_4b1.disconnect;_4cd(node.e_load);_4cd(node.e_error);_4cd(node.e_abort);node.e_load=node.e_error=node.e_abort=node.e_layer=null;},_attach:function(_4ce){var _4cf=_4ce.extent,_4d0=_4cf.spatialReference,_4d1=this._sr,div=this._div,node=_4ce._node,_4d2=new _4b8({x:_4cf.xmin,y:_4cf.ymin,spatialReference:_4d0}),_4d3=new _4b8({x:_4cf.xmax,y:_4cf.ymax,spatialReference:_4d0});if(!_4d1.equals(_4d0)){if(_4d1.isWebMercator()&&_4d0.wkid===4326){_4d2=_4b9.geographicToWebMercator(_4d2);_4d3=_4b9.geographicToWebMercator(_4d3);}else{if(_4d0.isWebMercator()&&_4d1.wkid===4326){_4d2=_4b9.webMercatorToGeographic(_4d2);_4d3=_4b9.webMercatorToGeographic(_4d3);}}}node.e_bl=_4d2;node.e_tr=_4d3;if(_4ce.visible){this._setPos(node,div._left,div._top);(this._active||div).appendChild(node);}},_setPos:function(node,_4d4,_4d5){var _4d6=node.e_bl,_4d7=node.e_tr,map=this._map;_4d6=map.toScreen(_4d6);_4d7=map.toScreen(_4d7);var left=_4d6.x-_4d4,top=_4d7.y-_4d5,_4d8=Math.abs(_4d7.x-_4d6.x),_4d9=Math.abs(_4d6.y-_4d7.y),css={width:_4d8+"px",height:_4d9+"px"},_4da=this._mapImages[node.e_idx];if(map.navigationMode==="css-transforms"){css[_4b5._css.names.transform]=_4b5._css.translate(left,top)+(_4da.rotation?(" "+_4b5._css.rotate(360-_4da.rotation)):"");}else{css.left=left+"px";css.top=top+"px";}_4b4.set(node,css);node.e_l=left;node.e_t=top;node.e_w=_4d8;node.e_h=_4d9;},managedSuspension:true,_setMap:function(map,_4db){this.inherited(arguments);var div=this._div=_4b3.create("div",null,_4db),_4dc=_4b5._css.names,css={position:"absolute"},vd=map.__visibleDelta;if(!has("ie")||has("ie")>8){css.opacity=this.opacity;}if(map.navigationMode==="css-transforms"){css[_4dc.transform]=_4b5._css.translate(vd.x,vd.y);_4b4.set(div,css);div._left=vd.x;div._top=vd.y;css={position:"absolute",width:map.width+"px",height:map.height+"px",overflow:"visible"};this._active=_4b3.create("div",null,div);_4b4.set(this._active,css);this._passive=_4b3.create("div",null,div);_4b4.set(this._passive,css);}else{div._left=0;div._top=0;_4b4.set(div,css);}this._standby=[];var _4dd=this._mapImages,i,len=_4dd.length;for(i=0;i<len;i++){var _4de=_4dd[i],node=_4de._node;if(!node){this._createImage(_4de,_4de._idx);}}_4b7.hide(div);return div;},_unsetMap:function(map,_4df){this._disconnect();var div=this._div;if(div){var _4e0=this._mapImages,i,len=_4e0.length;for(i=0;i<len;i++){var _4e1=_4e0[i];if(_4e1){var node=_4e1._node;if(node){this._clearEvents(node);node.e_idx=node.e_bl=node.e_tr=node.e_l=node.e_t=node.e_w=node.e_h=null;}_4e1._node=null;}}_4df.removeChild(div);_4b3.destroy(div);}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments);},_onSuspend:function(){this._disconnect();_4b7.hide(this._div);},_onResume:function(evt){if(evt.firstOccurrence){this._sr=this._map.spatialReference;this._processStandbyList();}var map=this._map,div=this._div,vd=map.__visibleDelta;if(map.navigationMode==="css-transforms"){div._left=vd.x;div._top=vd.y;_4b4.set(div,_4b5._css.names.transform,_4b5._css.translate(div._left,div._top));}this._redraw(map.navigationMode==="css-transforms");this._connect(map);_4b7.show(div);},_connect:function(map){if(!this._connections){var _4e2=_4b1.connect,_4e3=(map.navigationMode==="css-transforms");this._connections=[_4e2(map,"onPanStart",this._panStart),_4e2(map,"onPan",this._pan),_4e2(map,"onExtentChange",this._extentChange),_4e3&&_4e2(map,"onZoomStart",this._zoomStart),_4e3?_4e2(map,"onScale",this._scale):_4e2(map,"onZoom",this._zoom),_4e3&&_4e2(map,"onResize",this._resize)];}},_disconnect:function(){if(this._connections){_4b2.forEach(this._connections,_4b1.disconnect);this._connections=null;}},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top;},_pan:function(_4e4,_4e5){var div=this._div;div._left=this._panL+_4e5.x;div._top=this._panT+_4e5.y;if(this._map.navigationMode==="css-transforms"){_4b4.set(div,_4b5._css.names.transform,_4b5._css.translate(div._left,div._top));}else{_4b4.set(div,{left:div._left+"px",top:div._top+"px"});}},_extentChange:function(_4e6,_4e7,_4e8){if(_4e8){this._redraw(this._map.navigationMode==="css-transforms");}else{if(_4e7){this._pan(_4e6,_4e7);}}this._processStandbyList();},_processStandbyList:function(){var i,_4e9=this._standby;if(_4e9&&_4e9.length){for(i=_4e9.length-1;i>=0;i--){this._imageLoaded(null,_4e9[i]);_4e9.splice(i,1);}}},_redraw:function(_4ea){if(_4ea){var _4eb=this._passive,_4ec=_4b5._css.names;_4b4.set(_4eb,_4ec.transition,"none");this._moveImages(_4eb,this._active);_4b4.set(_4eb,_4ec.transform,"none");}var div=this._active||this._div,_4ed=this._div._left,_4ee=this._div._top,i,len=div.childNodes.length,node;for(i=0;i<len;i++){node=div.childNodes[i];this._setPos(node,_4ed,_4ee);}},_zoom:function(_4ef,_4f0,_4f1){var div=this._div,_4f2=div._left,_4f3=div._top,i,len=div.childNodes.length,node;for(i=0;i<len;i++){node=div.childNodes[i];var _4f4=node.e_w*_4f0,_4f5=node.e_h*_4f0,_4f6=(_4f1.x-_4f2-node.e_l)*(_4f4-node.e_w)/node.e_w,_4f7=(_4f1.y-_4f3-node.e_t)*(_4f5-node.e_h)/node.e_h;_4f6=isNaN(_4f6)?0:_4f6;_4f7=isNaN(_4f7)?0:_4f7;_4b4.set(node,{left:(node.e_l-_4f6)+"px",top:(node.e_t-_4f7)+"px",width:_4f4+"px",height:_4f5+"px"});}},_zoomStart:function(){this._moveImages(this._active,this._passive);},_moveImages:function(_4f8,dest){var _4f9=_4f8.childNodes,i,len=_4f9.length;if(len>0){for(i=len-1;i>=0;i--){dest.appendChild(_4f9[i]);}}},_scale:function(mtx,_4fa){var css={},_4fb=_4b5._css.names,_4fc=this._passive;_4b4.set(_4fc,_4fb.transition,_4fa?"none":(_4fb.transformName+" "+_4b6.defaults.map.zoomDuration+"ms ease"));css[_4fb.transform]=_4b5._css.matrix(mtx);_4b4.set(_4fc,_4fb.transform,_4b5._css.matrix(mtx));},_resize:function(_4fd,_4fe,_4ff){_4b4.set(this._active,{width:_4fe+"px",height:_4ff+"px"});_4b4.set(this._passive,{width:_4fe+"px",height:_4ff+"px"});}});if(has("extend-esri")){lang.setObject("layers.MapImageLayer",_4bb,_4b5);}return _4bb;});},"esri/tasks/SpatialRelationship":function(){define(["dojo/_base/lang","dojo/has","esri/kernel"],function(lang,has,_500){var _501={SPATIAL_REL_INTERSECTS:"esriSpatialRelIntersects",SPATIAL_REL_CONTAINS:"esriSpatialRelContains",SPATIAL_REL_CROSSES:"esriSpatialRelCrosses",SPATIAL_REL_ENVELOPEINTERSECTS:"esriSpatialRelEnvelopeIntersects",SPATIAL_REL_INDEXINTERSECTS:"esriSpatialRelIndexIntersects",SPATIAL_REL_OVERLAPS:"esriSpatialRelOverlaps",SPATIAL_REL_TOUCHES:"esriSpatialRelTouches",SPATIAL_REL_WITHIN:"esriSpatialRelWithin",SPATIAL_REL_RELATION:"esriSpatialRelRelation"};if(has("extend-esri")){lang.setObject("tasks._SpatialRelationship",_501,_500);}return _501;});},"esri/layers/WebTiledLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/has","dojo/string","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/TiledMapServiceLayer","esri/layers/TileInfo"],function(_502,lang,_503,Url,has,_504,_505,_506,_507,_508,_509,_50a){var _50b=_502(_509,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(_50c,_50d){if(!_50d){_50d={};}this.urlTemplate=_50c;var _50e=new _508(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _507({wkid:102100}));var _50f=new _508(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _507({wkid:102100}));this.initialExtent=_50d.initialExtent||_50e;this.fullExtent=_50d.fullExtent||_50f;if(_50d.tileInfo){this.tileInfo=_50d.tileInfo;}else{var lods=[{"level":0,"resolution":156543.033928,"scale":591657527.591555},{"level":1,"resolution":78271.5169639999,"scale":295828763.795777},{"level":2,"resolution":39135.7584820001,"scale":147914381.897889},{"level":3,"resolution":19567.8792409999,"scale":73957190.948944},{"level":4,"resolution":9783.93962049996,"scale":36978595.474472},{"level":5,"resolution":4891.96981024998,"scale":18489297.737236},{"level":6,"resolution":2445.98490512499,"scale":9244648.868618},{"level":7,"resolution":1222.99245256249,"scale":4622324.434309},{"level":8,"resolution":611.49622628138,"scale":2311162.217155},{"level":9,"resolution":305.748113140558,"scale":1155581.108577},{"level":10,"resolution":152.874056570411,"scale":577790.554289},{"level":11,"resolution":76.4370282850732,"scale":288895.277144},{"level":12,"resolution":38.2185141425366,"scale":144447.638572},{"level":13,"resolution":19.1092570712683,"scale":72223.819286},{"level":14,"resolution":9.55462853563415,"scale":36111.909643},{"level":15,"resolution":4.77731426794937,"scale":18055.954822},{"level":16,"resolution":2.38865713397468,"scale":9027.977411},{"level":17,"resolution":1.19432856685505,"scale":4513.988705},{"level":18,"resolution":0.597164283559817,"scale":2256.994353},{"level":19,"resolution":0.298582141647617,"scale":1128.497176}];var _510=new _50a({"rows":256,"cols":256,"origin":{"x":-20037508.342787,"y":20037508.342787},"spatialReference":{"wkid":102100},"lods":lods});this.tileInfo=_510;}this.spatialReference=new _507(this.tileInfo.spatialReference.toJson());this.copyright=_50d.copyright||"";var url=new Url(_50c);var _511=url.scheme+"://"+url.authority+"/";this.urlPath=_50c.substring(_511.length);this.tileServers=_50d.tileServers||[];if(url.authority.indexOf("{subDomain}")===-1){this.tileServers.push(_511);}if(_50d.subDomains&&_50d.subDomains.length>0&&url.authority.split(".").length>1){this.subDomains=_50d.subDomains;var _512;_503.forEach(_50d.subDomains,function(_513,idx){if(url.authority.indexOf("${subDomain}")>-1){_512=url.scheme+"://"+_504.substitute(url.authority,{subDomain:_513})+"/";}else{if(url.authority.indexOf("{subDomain}")>-1){_512=url.scheme+"://"+url.authority.replace(/\{subDomain\}/gi,_513)+"/";}}this.tileServers.push(_512);},this);}this.tileServers=_503.map(this.tileServers,function(item){if(item.charAt(item.length-1)!=="/"){item+="/";}return item;});this._levelToLevelValue=[];_503.forEach(this.tileInfo.lods,function(item){this._levelToLevelValue[item.level]=item.levelValue?item.levelValue:item.level;},this);this.loaded=true;this.onLoad(this);},getTileUrl:function(_514,row,col){_514=this._levelToLevelValue[_514];var _515=this.tileServers[row%this.tileServers.length];var _516=_515+_504.substitute(this.urlPath,{level:_514,col:col,row:row});_516=_516.replace(/\{level\}/gi,_514);_516=_516.replace(/\{row\}/gi,row);_516=_516.replace(/\{col\}/gi,col);return _506.addProxy(_516);}});if(has("extend-esri")){lang.setObject("layers.WebTiledLayer",_50b,_505);}return _50b;});},"esri/layers/SnapshotMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/SpatialReference","esri/tasks/query","esri/layers/RenderMode"],function(_517,lang,has,_518,_519,_51a,_51b){var _51c=_517([_51b],{declaredClass:"esri.layers._SnapshotMode",constructor:function(_51d){this.featureLayer=_51d;this._featureMap={};this._drawFeatures=lang.hitch(this,this._drawFeatures);this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},startup:function(){if(this.featureLayer._collection){this._applyTimeFilter();}else{this._fetchAll();}},propertyChangeHandler:function(type){if(this._init){if(type){if(this.featureLayer._collection){console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id = "+this.featureLayer.id);}else{this._fetchAll();}}else{this._applyTimeFilter();}}},drawFeature:function(_51e){var _51f=this.featureLayer,_520=_51f.objectIdField,oid=_51e.attributes[_520];this._addFeatureIIf(oid,_51e);this._incRefCount(oid);},resume:function(){this.propertyChangeHandler(0);},refresh:function(){var _521=this.featureLayer;if(_521._collection){_521._fireUpdateStart();_521._refresh(true);_521._fireUpdateEnd();}else{this._fetchAll();}},_getRequestId:function(_522){var id="_"+_522.name+_522.layerId+_522._ulid;return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_fetchAll:function(){var _523=this.featureLayer;if(_523._collection){return;}_523._fireUpdateStart();this._clearIIf();this._sendRequest();},_sendRequest:function(){var map=this.map,_524=this.featureLayer,_525=_524.getDefinitionExpression();var _526=new _51a();_526.outFields=_524._getOutFields();_526.where=_525||"1=1";_526.returnGeometry=true;_526.outSpatialReference=new _519(map.spatialReference.toJson());_526.timeExtent=_524.getTimeDefinition();_526.maxAllowableOffset=_524._maxOffset;if(_524._ts){_526._ts=(new Date()).getTime();}var _527;if(_524._usePatch){_527=this._getRequestId(_524);this._cancelPendingRequest(null,_527);}_524._task.execute(_526,this._drawFeatures,this._queryErrorHandler,_527);},_drawFeatures:function(_528){this._purgeRequests();var _529=_528.features,_52a=this.featureLayer,_52b=_52a.objectIdField,i,len=_529.length,_52c,oid;for(i=0;i<len;i++){_52c=_529[i];oid=_52c.attributes[_52b];this._addFeatureIIf(oid,_52c);this._incRefCount(oid);}this._applyTimeFilter(true);_52a._fireUpdateEnd(null,_528.exceededTransferLimit?{queryLimitExceeded:true}:null);if(_528.exceededTransferLimit){_52a.onQueryLimitExceeded();}},_queryErrorHandler:function(err){this._purgeRequests();var _52d=this.featureLayer;_52d._errorHandler(err);_52d._fireUpdateEnd(err);}});if(has("extend-esri")){lang.setObject("layers._SnapshotMode",_51c,_518);}return _51c;});},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(_52e,lang,has,_52f,_530){var _531=_52e([_530],{declaredClass:"esri.layers._SelectionMode",constructor:function(_532){this.featureLayer=_532;this._featureMap={};},propertyChangeHandler:function(type){if(this._init&&type===0){this._applyTimeFilter();}},resume:function(){this.propertyChangeHandler(0);}});if(has("extend-esri")){lang.setObject("layers._SelectionMode",_531,_52f);}return _531;});},"esri/tasks/Task":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/deferredUtils","esri/urlUtils"],function(_533,lang,_534,has,_535,_536,_537){var Task=_533(null,{declaredClass:"esri.tasks._Task",constructor:function(url){if(url&&lang.isString(url)){this._url=_537.urlToObject(this.url=url);}this.normalization=true;this._errorHandler=lang.hitch(this,this._errorHandler);},_useSSL:function(){var _538=this._url,re=/^http:/i,rep="https:";if(this.url){this.url=this.url.replace(re,rep);}if(_538&&_538.path){_538.path=_538.path.replace(re,rep);}},_encode:function(_539,_53a,_53b){var _53c,type,_53d={},i,p,pl;for(i in _539){if(i==="declaredClass"){continue;}_53c=_539[i];type=typeof _53c;if(_53c!==null&&_53c!==undefined&&type!=="function"){if(lang.isArray(_53c)){_53d[i]=[];pl=_53c.length;for(p=0;p<pl;p++){_53d[i][p]=this._encode(_53c[p]);}}else{if(type==="object"){if(_53c.toJson){var json=_53c.toJson(_53b&&_53b[i]);if(_53c.declaredClass==="esri.tasks.FeatureSet"){if(json.spatialReference){json.sr=json.spatialReference;delete json.spatialReference;}}_53d[i]=_53a?json:_534.toJson(json);}}else{_53d[i]=_53c;}}}}return _53d;},_successHandler:function(args,_53e,_53f,dfd){if(_53e){this[_53e].apply(this,args);}if(_53f){_53f.apply(null,args);}if(dfd){_536._resDfd(dfd,args);}},_errorHandler:function(err,_540,dfd){this.onError(err);if(_540){_540(err);}if(dfd){dfd.errback(err);}},setNormalization:function(_541){this.normalization=_541;},onError:function(){}});if(has("extend-esri")){_535.Task=Task;}return Task;});},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(dojo,_542,_543){dojo.DeferredList=function(list,_544,_545,_546,_547){var _548=[];_542.call(this);var self=this;if(list.length===0&&!_544){this.resolve([0,[]]);}var _549=0;_543.forEach(list,function(item,i){item.then(function(_54a){if(_544){self.resolve([i,_54a]);}else{_54b(true,_54a);}},function(_54c){if(_545){self.reject(_54c);}else{_54b(false,_54c);}if(_546){return null;}throw _54c;});function _54b(_54d,_54e){_548[i]=[_54d,_54e];_549++;if(_549===list.length){self.resolve(_548);}};});};dojo.DeferredList.prototype=new _542();dojo.DeferredList.prototype.gatherResults=function(_54f){var d=new dojo.DeferredList(_54f,false,true,false);d.addCallback(function(_550){var ret=[];_543.forEach(_550,function(_551){ret.push(_551[1]);});return ret;});return d;};return dojo.DeferredList;});},"dijit/_OnDijitClickMixin":function(){define("dijit/_OnDijitClickMixin",["dojo/on","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/has","dojo/_base/unload","dojo/_base/window","./a11yclick"],function(on,_552,keys,_553,has,_554,win,_555){var ret=_553("dijit._OnDijitClickMixin",null,{connect:function(obj,_556,_557){return this.inherited(arguments,[obj,_556=="ondijitclick"?_555:_556,_557]);}});ret.a11yclick=_555;return ret;});},"dijit/a11yclick":function(){define("dijit/a11yclick",["dojo/on","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/has","dojo/_base/unload","dojo/_base/window"],function(on,_558,keys,_559,has,_55a,win){var _55b=null;if(has("dom-addeventlistener")){win.doc.addEventListener("keydown",function(evt){_55b=evt.target;},true);}else{(function(){var _55c=function(evt){_55b=evt.srcElement;};win.doc.attachEvent("onkeydown",_55c);_55a.addOnWindowUnload(function(){win.doc.detachEvent("onkeydown",_55c);});})();}function _55d(e){return (e.keyCode===keys.ENTER||e.keyCode===keys.SPACE)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey;};return function(node,_55e){if(/input|button/i.test(node.nodeName)){return on(node,"click",_55e);}else{var _55f=[on(node,"keydown",function(e){if(_55d(e)){_55b=e.target;e.preventDefault();}}),on(node,"keyup",function(e){if(_55d(e)&&e.target==_55b){_55b=null;on.emit(e.target,"click",{cancelable:true,bubbles:true});}}),on(node,"click",function(e){_55e.call(this,e);})];if(has("touch")){var _560;_55f.push(on(node,"touchend",function(e){var _561=e.target;_560=setTimeout(function(){_560=null;on.emit(_561,"click",{cancelable:true,bubbles:true});},600);}),on(node,"click",function(e){if(_560){clearTimeout(_560);}}));}return {remove:function(){_558.forEach(_55f,function(h){h.remove();});if(_560){clearTimeout(_560);_560=null;}}};}};return ret;});},"esri/layers/WMSLayer":function(){define(["require","dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/request","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/DynamicMapServiceLayer","esri/layers/WMSLayerInfo","dojo/query"],function(_562,_563,_564,lang,_565,has,_566,_567,_568,_569,_56a,_56b,_56c){var _56d=_564([_56b],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(url,_56e){url=this._stripParameters(url,["version","service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);this.url=url;this._url=_568.urlToObject(url);this._getCapabilitiesURL=url;this._initLayer=lang.hitch(this,this._initLayer);this._parseCapabilities=lang.hitch(this,this._parseCapabilities);this._getCapabilitiesError=lang.hitch(this,this._getCapabilitiesError);if(_56e){this.imageFormat=this._getImageFormat(_56e.format);this.imageTransparency=(_56e.transparent===false)?false:true;this.visibleLayers=_56e.visibleLayers?_56e.visibleLayers:[];if(_56e.resourceInfo){this._readResourceInfo(_56e.resourceInfo);}else{this._getCapabilities();}}else{this.imageFormat="image/png";this.imageTransparency=true;this.visibleLayers=[];this._getCapabilities();}this._blankImageURL=_562.toUrl("esri/layers")+"/../images/pixel.png";},setVisibleLayers:function(_56f){_56f=this._checkVisibleLayersList(_56f);this.visibleLayers=_56f?_56f:[];this.refresh(true);},setImageFormat:function(_570){this.imageFormat=this._getImageFormat(_570);this.refresh(true);},setImageTransparency:function(_571){this.imageTransparency=_571;this.refresh(true);},getImageUrl:function(_572,_573,_574,_575){if(!this.visibleLayers||this.visibleLayers.length===0){_575(this._blankImageURL);return;}var wkid=_572.spatialReference.wkid;if(_565.some(this._WEB_MERCATOR,function(el){return el==wkid;})){var _576=_565.filter(this.spatialReferences,function(el){return (_565.some(this._WEB_MERCATOR,function(el2){return el2==el;}));},this);if(_576.length==0){_576=_565.filter(this.spatialReferences,function(el){return (_565.some(this._WORLD_MERCATOR,function(el2){return el2==el;}));},this);}if(_576.length>0){wkid=_576[0];}else{wkid=this._WEB_MERCATOR[0];}}var list=_565.filter(this.spatialReferences,function(el){return el!==wkid;});this.spatialReferences=list;this.spatialReferences.unshift(wkid);var xmin=_572.xmin;var xmax=_572.xmax;var ymin=_572.ymin;var ymax=_572.ymax;var _577={};_577.SERVICE="WMS";_577.REQUEST="GetMap";_577.FORMAT=this.imageFormat;_577.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";_577.STYLES="";_577.VERSION=this.version;_577.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;_577.WIDTH=_573;_577.HEIGHT=_574;if(this.maxWidth<_573){_577.WIDTH=this.maxWidth;}if(this.maxHeight<_574){_577.HEIGHT=this.maxHeight;}var _578=wkid?wkid:NaN;if(!isNaN(_578)){if(this.version=="1.3.0"){_577.CRS="EPSG:"+_578;}else{_577.SRS="EPSG:"+_578;}}if(this.version=="1.3.0"&&this._useLatLong(_578)){_577.BBOX=ymin+","+xmin+","+ymax+","+xmax;}else{_577.BBOX=xmin+","+ymin+","+xmax+","+ymax;}var _579=this.getMapURL,key;_579+=(_579.indexOf("?")==-1)?"?":"";for(key in _577){_579+=(_579.substring(_579.length-1,_579.length)=="?")?"":"&";_579+=key+"="+_577[key];}_575(_568.addProxy(_579));},_initLayer:function(_57a,io){this.spatialReference=new _569(this.extent.spatialReference);this.initialExtent=new _56a(this.extent);this.fullExtent=new _56a(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=true;this.onLoad(this);var _57b=this._loadCallback;if(_57b){delete this._loadCallback;_57b(this);}},_readResourceInfo:function(_57c){if(!_57c.extent){console.error("esri.layers.WMSLayer: unable to find the 'extent' property in resourceInfo");return;}if(!_57c.layerInfos){console.error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo");return;}this.extent=_57c.extent;this.allExtents[0]=_57c.extent;this.layerInfos=_57c.layerInfos;this.description=_57c.description?_57c.description:"";this.copyright=_57c.copyright?_57c.copyright:"";this.title=_57c.title?_57c.title:"";this.getMapURL=_57c.getMapURL?_57c.getMapURL:this._getCapabilitiesURL;this.version=_57c.version?_57c.version:"1.3.0";this.maxWidth=_57c.maxWidth?_57c.maxWidth:5000;this.maxHeight=_57c.maxHeight?_57c.maxHeight:5000;this.spatialReferences=_57c.spatialReferences?_57c.spatialReferences:[];this.imageFormat=this._getImageFormat(_57c.format);this.setScaleRange(_57c.minScale,_57c.maxScale);this._initLayer();},_getCapabilities:function(){var _57d=this._url.query?this._url.query:{};_57d.SERVICE="WMS";_57d.REQUEST="GetCapabilities";var uri=this._url.path+"?",key;for(key in _57d){uri+=(uri.substring(uri.length-1,uri.length)=="?")?"":"&";uri+=key+"="+_57d[key];}var _57e=_567({url:uri,handleAs:"xml",load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:false});},_parseCapabilities:function(xml){if(!xml){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)");return;}this.version=this._getAttributeValue("WMS_Capabilities","version",xml,null);if(!this.version){this.version=this._getAttributeValue("WMT_MS_Capabilities","version",xml,"1.3.0");}var _57f=this._getTag("Service",xml);this.title=this._getTagValue("Title",_57f,"");if(!this.title||this.title.length==0){this.title=this._getTagValue("Name",_57f,"");}this.copyright=this._getTagValue("AccessConstraints",_57f,"");this.description=this._getTagValue("Abstract",_57f,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",_57f,5000),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",_57f,5000),10);var _580=this._getTag("Layer",xml);if(!_580){this._getCapabilitiesError({"error":{"message":"Response does not contain any layers."}});return;}var _581=this._getLayerInfo(_580);if(_581){this.layerInfos=_581.subLayers;if(!this.layerInfos||this.layerInfos.length==0){this.layerInfos=[_581];}this.extent=_581.extent;this.allExtents=_581.allExtents;this.spatialReferences=_581.spatialReferences;if(this.spatialReferences.length==0&&this.layerInfos.length>0){this.spatialReferences=this.layerInfos[0].spatialReferences;}}this.getMapURL=this._getCapabilitiesURL;var _582=_563.query("DCPType",this._getTag("GetMap",xml));if(_582&&_582.length>0){var _583=_563.query("HTTP",_582[0]);if(_583&&_583.length>0){var _584=_563.query("Get",_583[0]);if(_584&&_584.length>0){var _585=this._getAttributeValue("OnlineResource","xlink:href",_584[0],null);if(_585){if(_585.indexOf("&")==(_585.length-1)){_585=_585.substring(0,_585.length-1);}this.getMapURL=_585;}}}}this.getMapFormats=[];if(_563.query("Operation",xml).length==0){_565.forEach(_563.query("Format",this._getTag("GetMap",xml)),function(_586){this.getMapFormats.push(_586.text?_586.text:_586.textContent);},this);}else{_565.forEach(_563.query("Operation",xml),function(_587){if(_587.getAttribute("name")=="GetMap"){_565.forEach(_563.query("Format",_587),function(_588){this.getMapFormats.push(_588.text?_588.text:_588.textContent);},this);}},this);}if(!_565.some(this.getMapFormats,function(el){return el.indexOf(this.imageFormat)>-1;},this)){this.imageFormat=this.getMapFormats[0];}this._initLayer();},_getCapabilitiesError:function(_589,io){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",_589);},_getLayerInfo:function(_58a){if(!_58a){return null;}var _58b=new _56c();_58b.name="";_58b.title="";_58b.description="";_58b.allExtents=[];_58b.spatialReferences=[];_58b.subLayers=[];var _58c=this._getTag("LatLonBoundingBox",_58a);if(_58c){_58b.allExtents[0]=this._getExtent(_58c,4326);}var _58d=this._getTag("EX_GeographicBoundingBox",_58a);if(_58d){var _58e=new _56a(0,0,0,0,new _569({wkid:4326}));_58e.xmin=parseFloat(this._getTagValue("westBoundLongitude",_58d,0));_58e.ymin=parseFloat(this._getTagValue("southBoundLatitude",_58d,0));_58e.xmax=parseFloat(this._getTagValue("eastBoundLongitude",_58d,0));_58e.ymax=parseFloat(this._getTagValue("northBoundLatitude",_58d,0));_58b.allExtents[0]=_58e;}_58b.extent=_58b.allExtents[0];var _58f=(_565.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)>-1)?"SRS":"CRS";_565.forEach(_58a.childNodes,function(_590){if(_590.nodeName=="Name"){_58b.name=(_590.text?_590.text:_590.textContent)||"";}else{if(_590.nodeName=="Title"){_58b.title=(_590.text?_590.text:_590.textContent)||"";}else{if(_590.nodeName=="Abstract"){_58b.description=(_590.text?_590.text:_590.textContent)||"";}else{if(_590.nodeName=="BoundingBox"){var _591=_590.getAttribute(_58f),wkid;if(_591&&_591.indexOf("EPSG:")===0){wkid=parseInt(_591.substring(5),10);if(wkid!==0&&!isNaN(wkid)){var _592;if(this.version=="1.3.0"){_592=this._getExtent(_590,wkid,this._useLatLong(wkid));}else{_592=this._getExtent(_590,wkid);}_58b.allExtents[wkid]=_592;if(!_58b.extent){_58b.extent=_592;}}}else{if(_591&&_591.indexOf("CRS:")===0){wkid=parseInt(_591.substring(4),10);if(wkid!==0&&!isNaN(wkid)){if(this._CRS_TO_EPSG[wkid]){wkid=this._CRS_TO_EPSG[wkid];}_58b.allExtents[wkid]=this._getExtent(_590,wkid);}}else{wkid=parseInt(_591,10);if(wkid!==0&&!isNaN(wkid)){_58b.allExtents[wkid]=this._getExtent(_590,wkid);}}}}else{if(_590.nodeName==_58f){var _593=_590.text?_590.text:_590.textContent;var arr=_593.split(" ");_565.forEach(arr,function(val){if(val.indexOf(":")>-1){val=parseInt(val.split(":")[1],10);}else{val=parseInt(val,10);}if(val!==0&&!isNaN(val)){if(this._CRS_TO_EPSG[val]){val=this._CRS_TO_EPSG[val];}if(_565.indexOf(_58b.spatialReferences,val)==-1){_58b.spatialReferences.push(val);}}},this);}else{if(_590.nodeName=="Style"){var _594=this._getTag("LegendURL",_590);if(_594){var _595=this._getTag("OnlineResource",_594);if(_595){_58b.legendURL=_595.getAttribute("xlink:href");}}}else{if(_590.nodeName==="Layer"){_58b.subLayers.push(this._getLayerInfo(_590));}}}}}}}},this);return _58b;},_getImageFormat:function(_596){var _597=_596?_596.toLowerCase():"";switch(_597){case "jpg":return "image/jpeg";case "bmp":return "image/bmp";case "gif":return "image/gif";case "svg":return "image/svg+xml";default:return "image/png";}},getImageFormat:function(){var _598=this.imageFormat?this.imageFormat.toLowerCase():"";switch(_598){case "image/jpeg":return "jpg";case "image/bmp":return "bmp";case "image/gif":return "gif";case "image/svg+xml":return "svg";default:return "png";}},_getExtent:function(_599,wkid,_59a){var _59b;if(_599){_59b=new _56a();var minx=parseFloat(_599.getAttribute("minx"));var miny=parseFloat(_599.getAttribute("miny"));var maxx=parseFloat(_599.getAttribute("maxx"));var maxy=parseFloat(_599.getAttribute("maxy"));if(_59a){_59b.xmin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_59b.ymin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_59b.xmax=isNaN(maxy)?Number.MAX_VALUE:maxy;_59b.ymax=isNaN(maxx)?Number.MAX_VALUE:maxx;}else{_59b.xmin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_59b.ymin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_59b.xmax=isNaN(maxx)?Number.MAX_VALUE:maxx;_59b.ymax=isNaN(maxy)?Number.MAX_VALUE:maxy;}_59b.spatialReference=new _569({wkid:wkid});}return _59b;},_useLatLong:function(wkid){var _59c,i;for(i=0;i<this._REVERSED_LAT_LONG_RANGES.length;i++){var _59d=this._REVERSED_LAT_LONG_RANGES[i];if(wkid>=_59d[0]&&wkid<=_59d[1]){_59c=true;break;}}return _59c;},_getTag:function(_59e,xml){var tags=_563.query(_59e,xml);if(tags&&tags.length>0){return tags[0];}else{return null;}},_getTagValue:function(_59f,xml,_5a0){var _5a1=_563.query(_59f,xml);if(_5a1&&_5a1.length>0){if(_5a1[0].text){return _5a1[0].text;}else{return _5a1[0].textContent;}}else{return _5a0;}},_getAttributeValue:function(_5a2,_5a3,xml,_5a4){var _5a5=_563.query(_5a2,xml);if(_5a5&&_5a5.length>0){return _5a5[0].getAttribute(_5a3);}else{return _5a4;}},_checkVisibleLayersList:function(_5a6){if(_5a6&&_5a6.length>0&&this.layerInfos&&this.layerInfos.length>0){if((typeof _5a6[0])=="number"){var list=[];_565.forEach(_5a6,function(pos){if(pos<this.layerInfos.length){list.push(this.layerInfos[pos].name);}},this);_5a6=list;}}return _5a6;},_stripParameters:function(url,_5a7){var obj=_568.urlToObject(url),prop,qs=[];for(prop in obj.query){if(_565.indexOf(_5a7,prop.toLowerCase())===-1){qs.push(prop+"="+obj.query[prop]);}}return obj.path+(qs.length?("?"+qs.join("&")):"");}});if(has("extend-esri")){lang.setObject("layers.WMSLayer",_56d,_566);}return _56d;});},"dijit/hccss":function(){define("dijit/hccss",["dojo/dom-class","dojo/hccss","dojo/ready","dojo/_base/window"],function(_5a8,has,_5a9,win){_5a9(90,function(){if(has("highcontrast")){_5a8.add(win.body(),"dijit_a11y");}});return has;});},"dijit/_TemplatedMixin":function(){define("dijit/_TemplatedMixin",["dojo/_base/lang","dojo/touch","./_WidgetBase","dojo/string","dojo/cache","dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/sniff","dojo/_base/unload"],function(lang,_5aa,_5ab,_5ac,_5ad,_5ae,_5af,_5b0,has,_5b1){var _5b2=_5af("dijit._TemplatedMixin",null,{templateString:null,templatePath:null,_skipNodeCache:false,_earlyTemplatedStartup:false,constructor:function(){this._attachPoints=[];this._attachEvents=[];},_stringRepl:function(tmpl){var _5b3=this.declaredClass,_5b4=this;return _5ac.substitute(tmpl,this,function(_5b5,key){if(key.charAt(0)=="!"){_5b5=lang.getObject(key.substr(1),false,_5b4);}if(typeof _5b5=="undefined"){throw new Error(_5b3+" template:"+key);}if(_5b5==null){return "";}return key.charAt(0)=="!"?_5b5:_5b5.toString().replace(/"/g,"&quot;");},this);},buildRendering:function(){if(!this.templateString){this.templateString=_5ad(this.templatePath,{sanitize:true});}var _5b6=_5b2.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);var node;if(lang.isString(_5b6)){node=_5b0.toDom(this._stringRepl(_5b6),this.ownerDocument);if(node.nodeType!=1){throw new Error("Invalid template: "+_5b6);}}else{node=_5b6.cloneNode(true);}this.domNode=node;this.inherited(arguments);this._attachTemplateNodes(node,function(n,p){return n.getAttribute(p);});this._beforeFillContent();this._fillContent(this.srcNodeRef);},_beforeFillContent:function(){},_fillContent:function(_5b7){var dest=this.containerNode;if(_5b7&&dest){while(_5b7.hasChildNodes()){dest.appendChild(_5b7.firstChild);}}},_attachTemplateNodes:function(_5b8,_5b9){var _5ba=lang.isArray(_5b8)?_5b8:(_5b8.all||_5b8.getElementsByTagName("*"));var x=lang.isArray(_5b8)?0:-1;for(;x<0||_5ba[x];x++){var _5bb=(x==-1)?_5b8:_5ba[x];if(this.widgetsInTemplate&&(_5b9(_5bb,"dojoType")||_5b9(_5bb,"data-dojo-type"))){continue;}var _5bc=_5b9(_5bb,"dojoAttachPoint")||_5b9(_5bb,"data-dojo-attach-point");if(_5bc){var _5bd,_5be=_5bc.split(/\s*,\s*/);while((_5bd=_5be.shift())){if(lang.isArray(this[_5bd])){this[_5bd].push(_5bb);}else{this[_5bd]=_5bb;}this._attachPoints.push(_5bd);}}var _5bf=_5b9(_5bb,"dojoAttachEvent")||_5b9(_5bb,"data-dojo-attach-event");if(_5bf){var _5c0,_5c1=_5bf.split(/\s*,\s*/);var trim=lang.trim;while((_5c0=_5c1.shift())){if(_5c0){var _5c2=null;if(_5c0.indexOf(":")!=-1){var _5c3=_5c0.split(":");_5c0=trim(_5c3[0]);_5c2=trim(_5c3[1]);}else{_5c0=trim(_5c0);}if(!_5c2){_5c2=_5c0;}this._attachEvents.push(this.connect(_5bb,_5aa[_5c0]||_5c0,_5c2));}}}}},destroyRendering:function(){_5ae.forEach(this._attachPoints,function(_5c4){delete this[_5c4];},this);this._attachPoints=[];_5ae.forEach(this._attachEvents,this.disconnect,this);this._attachEvents=[];this.inherited(arguments);}});_5b2._templateCache={};_5b2.getCachedTemplate=function(_5c5,_5c6,doc){var _5c7=_5b2._templateCache;var key=_5c5;var _5c8=_5c7[key];if(_5c8){try{if(!_5c8.ownerDocument||_5c8.ownerDocument==(doc||document)){return _5c8;}}catch(e){}_5b0.destroy(_5c8);}_5c5=_5ac.trim(_5c5);if(_5c6||_5c5.match(/\$\{([^\}]+)\}/g)){return (_5c7[key]=_5c5);}else{var node=_5b0.toDom(_5c5,doc);if(node.nodeType!=1){throw new Error("Invalid template: "+_5c5);}return (_5c7[key]=node);}};if(has("ie")){_5b1.addOnWindowUnload(function(){var _5c9=_5b2._templateCache;for(var key in _5c9){var _5ca=_5c9[key];if(typeof _5ca=="object"){_5b0.destroy(_5ca);}delete _5c9[key];}});}lang.extend(_5ab,{dojoAttachEvent:"",dojoAttachPoint:""});return _5b2;});},"esri/tasks/GeometryService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/has","esri/kernel","esri/request","esri/deferredUtils","esri/tasks/Task","esri/geometry/Extent","esri/geometry/Polyline","esri/geometry/Polygon","esri/geometry/Multipoint","esri/geometry/jsonUtils"],function(_5cb,lang,_5cc,_5cd,_5ce,has,_5cf,_5d0,_5d1,Task,_5d2,_5d3,_5d4,_5d5,_5d6){var _5d7=_5cb(Task,{declaredClass:"esri.tasks.GeometryService",constructor:function(url){var _5d8=lang.hitch;this._projectHandler=_5d8(this,this._projectHandler);this._simplifyHandler=_5d8(this,this._simplifyHandler);this._bufferHandler=_5d8(this,this._bufferHandler);this._areasAndLengthsHandler=_5d8(this,this._areasAndLengthsHandler);this._lengthsHandler=_5d8(this,this._lengthsHandler);this._labelPointsHandler=_5d8(this,this._labelPointsHandler);this._relationHandler=_5d8(this,this._relationHandler);this._convexHullHandler=_5d8(this,this._convexHullHandler);this._unionHandler=_5d8(this,this._unionHandler);this._autoCompleteHandler=_5d8(this,this._autoCompleteHandler);this._reshapeHandler=_5d8(this,this._reshapeHandler);this._cutHandler=_5d8(this,this._cutHandler);this._intersectHandler=_5d8(this,this._intersectHandler);this._differenceHandler=_5d8(this,this._differenceHandler);this._trimExtendHandler=_5d8(this,this._trimExtendHandler);this._densifyHandler=_5d8(this,this._densifyHandler);this._generalizeHandler=_5d8(this,this._densifyHandler);this._offsetHandler=_5d8(this,this._offsetHandler);this._distanceHandler=_5d8(this,this._distanceHandler);},_encodeGeometries:function(_5d9){var gs=[],i,il=_5d9.length;for(i=0;i<il;i++){gs.push(_5d9[i].toJson());}return {geometryType:_5d6.getJsonType(_5d9[0]),geometries:gs};},_decodeGeometries:function(_5da,_5db,sr){var _5dc=_5d6.getGeometryType(_5db),_5dd=_5da.geometries,fs=[],_5de={spatialReference:sr.toJson()},_5df=lang.mixin;_5cc.forEach(_5dd,function(g,i){fs[i]=new _5dc(_5df(g,_5de));});return fs;},_toProjectGeometry:function(_5e0){var sr=_5e0.spatialReference.toJson();if(_5e0 instanceof _5d2){return new _5d4({rings:[[[_5e0.xmin,_5e0.ymin],[_5e0.xmin,_5e0.ymax],[_5e0.xmax,_5e0.ymax],[_5e0.xmax,_5e0.ymin],[_5e0.xmin,_5e0.ymin]]],spatialReference:sr});}else{return new _5d3({paths:[[].concat(_5e0.points)],spatialReference:sr});}},_fromProjectedGeometry:function(_5e1,_5e2,_5e3){if(_5e2==="esriGeometryEnvelope"){var ring=_5e1.rings[0];return new _5d2(ring[0][0],ring[0][1],ring[2][0],ring[2][1],_5e3);}else{return new _5d5({points:_5e1.paths[0],spatialReference:_5e3.toJson()});}},project:function(_5e4,_5e5,_5e6,_5e7){var _5e8=lang.mixin({},this._url.query,{f:"json"}),_5e9;if(!_5e4.geometries){_5e9=_5e4[0];_5e8=lang.mixin(_5e8,{outSR:_5e5.wkid||_5cd.toJson(_5e5.toJson()),inSR:_5e9.spatialReference.wkid||_5cd.toJson(_5e9.spatialReference.toJson()),geometries:_5cd.toJson(this._encodeGeometries(_5e4))});}else{_5e7=_5e6;_5e6=_5e5;_5e5=_5e4.outSR;_5e9=_5e4.geometries[0];_5e8=lang.mixin(_5e8,_5e4.toJson());}var _5ea=_5d6.getJsonType(_5e9),_5eb=this._projectHandler,_5ec=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/project",content:_5e8,callbackParamName:"callback",load:function(r,i){_5eb(r,i,_5ea,_5e5,_5e6,_5e7,dfd);},error:function(r){_5ec(r,_5e7,dfd);}});return dfd;},_projectHandler:function(_5ed,io,_5ee,_5ef,_5f0,_5f1,dfd){try{var fs=this._decodeGeometries(_5ed,_5ee,_5ef);this._successHandler([fs],"onProjectComplete",_5f0,dfd);}catch(err){this._errorHandler(err,_5f1,dfd);}},onProjectComplete:function(){},simplify:function(_5f2,_5f3,_5f4){var _5f5=_5f2[0].spatialReference;var _5f6=lang.mixin({},this._url.query,{f:"json",sr:_5f5.wkid?_5f5.wkid:_5cd.toJson(_5f5.toJson()),geometries:_5cd.toJson(this._encodeGeometries(_5f2))}),_5f7=_5d6.getJsonType(_5f2[0]),_5f8=this._simplifyHandler,_5f9=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/simplify",content:_5f6,callbackParamName:"callback",load:function(r,i){_5f8(r,i,_5f7,_5f5,_5f3,_5f4,dfd);},error:function(r){_5f9(r,_5f4,dfd);}});return dfd;},_simplifyHandler:function(_5fa,io,_5fb,sr,_5fc,_5fd,dfd){try{var fs=this._decodeGeometries(_5fa,_5fb,sr);this._successHandler([fs],"onSimplifyComplete",_5fc,dfd);}catch(err){this._errorHandler(err,_5fd,dfd);}},onSimplifyComplete:function(){},convexHull:function(_5fe,_5ff,_600){var _601=_5fe[0].spatialReference;var _602=lang.mixin({},this._url.query,{f:"json",sr:_5cd.toJson(_601.toJson()),geometries:_5cd.toJson(this._encodeGeometries(_5fe))}),_603=this._convexHullHandler,_604=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/convexHull",content:_602,callbackParamName:"callback",load:function(r,i){_603(r,i,_601,_5ff,_600,dfd);},error:function(r){_604(r,_600,dfd);}});return dfd;},_convexHullHandler:function(_605,io,_606,_607,_608,dfd){try{var geom=_5d6.fromJson(_605.geometry).setSpatialReference(_606);this._successHandler([geom],"onConvexHullComplete",_607,dfd);}catch(err){this._errorHandler(err,_608,dfd);}},onConvexHullComplete:function(){},union:function(_609,_60a,_60b){var _60c=_609[0].spatialReference;var _60d=lang.mixin({},this._url.query,{f:"json",sr:_5cd.toJson(_60c.toJson()),geometries:_5cd.toJson(this._encodeGeometries(_609))}),_60e=this._unionHandler,_60f=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/union",content:_60d,callbackParamName:"callback",load:function(r,i){_60e(r,i,_60c,_60a,_60b,dfd);},error:function(r){_60f(r,_60b,dfd);}});return dfd;},_unionHandler:function(_610,io,_611,_612,_613,dfd){try{var geom=_5d6.fromJson(_610.geometry).setSpatialReference(_611);this._successHandler([geom],"onUnionComplete",_612,dfd);}catch(err){this._errorHandler(err,_613,dfd);}},onUnionComplete:function(){},autoComplete:function(_614,_615,_616,_617){var _618=_614[0].spatialReference;var _619=lang.mixin({},this._url.query,{f:"json",sr:_5cd.toJson(_618.toJson()),polygons:_5cd.toJson(this._encodeGeometries(_614).geometries),polylines:_5cd.toJson(this._encodeGeometries(_615).geometries)}),_61a=this._autoCompleteHandler,_61b=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/autoComplete",content:_619,callbackParamName:"callback",load:function(r,i){_61a(r,i,_618,_616,_617,dfd);},error:function(r){_61b(r,_617,dfd);}});return dfd;},_autoCompleteHandler:function(_61c,io,_61d,_61e,_61f,dfd){try{var _620=_61c.geometries,_621=[],i,il=_620.length;for(i=0;i<il;i++){_621[i]=new _5d4({spatialReference:_61d,rings:_620[i].rings});}this._successHandler([_621],"onAutoCompleteComplete",_61e,dfd);}catch(err){this._errorHandler(err,_61f,dfd);}},onAutoCompleteComplete:function(){},reshape:function(_622,_623,_624,_625){var _626=_622.spatialReference;var _627=lang.mixin({},this._url.query,{f:"json",sr:_5cd.toJson(_626.toJson()),target:_5cd.toJson({geometryType:_5d6.getJsonType(_622),geometry:_622.toJson()}),reshaper:_5cd.toJson(_623.toJson())}),_628=this._reshapeHandler,_629=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/reshape",content:_627,callbackParamName:"callback",load:function(r,i){_628(r,i,_626,_624,_625,dfd);},error:function(r){_629(r,_625,dfd);}});return dfd;},_reshapeHandler:function(_62a,io,_62b,_62c,_62d,dfd){try{var geom=_5d6.fromJson(_62a.geometry).setSpatialReference(_62b);this._successHandler([geom],"onReshapeComplete",_62c,dfd);}catch(err){this._errorHandler(err,_62d,dfd);}},onReshapeComplete:function(){},cut:function(_62e,_62f,_630,_631){var _632=_62e[0].spatialReference;var _633=_5cc.map(_62e,function(_634){return _634.toJson();});var _635=lang.mixin({},this._url.query,{f:"json",sr:_5cd.toJson(_632.toJson()),target:_5cd.toJson({geometryType:_5d6.getJsonType(_62e[0]),geometries:_633}),cutter:_5cd.toJson(_62f.toJson())}),_636=this._cutHandler,_637=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/cut",content:_635,callbackParamName:"callback",load:function(r,i){_636(r,i,_632,_630,_631,dfd);},error:function(r){_637(r,_631,dfd);}});return dfd;},_cutHandler:function(_638,io,_639,_63a,_63b,dfd){try{var _63c=_638.geometries;var _63d={};_63d.cutIndexes=_638.cutIndexes;_63d.geometries=[];_5cc.forEach(_63c,function(geom){_63d.geometries.push(_5d6.fromJson(geom).setSpatialReference(_639));});this._successHandler([_63d],"onCutComplete",_63a,dfd);}catch(err){this._errorHandler(err,_63b,dfd);}},onCutComplete:function(){},intersect:function(_63e,_63f,_640,_641){var _642=_63e[0].spatialReference;var _643=lang.mixin({},this._url.query,{f:"json",sr:_5cd.toJson(_642.toJson()),geometries:_5cd.toJson(this._encodeGeometries(_63e)),geometry:_5cd.toJson({geometryType:_5d6.getJsonType(_63f),geometry:_63f.toJson()})}),_644=this._intersectHandler,_645=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/intersect",content:_643,callbackParamName:"callback",load:function(r,i){_644(r,i,_642,_640,_641,dfd);},error:function(r){_645(r,_641,dfd);}});return dfd;},_intersectHandler:function(_646,io,_647,_648,_649,dfd){try{var _64a=_646.geometries,_64b=[];_5cc.forEach(_64a,function(geom){_64b.push(_5d6.fromJson(geom).setSpatialReference(_647));});this._successHandler([_64b],"onIntersectComplete",_648,dfd);}catch(err){this._errorHandler(err,_649,dfd);}},onIntersectComplete:function(){},difference:function(_64c,_64d,_64e,_64f){var _650=_64c[0].spatialReference;var _651=lang.mixin({},this._url.query,{f:"json",sr:_5cd.toJson(_650.toJson()),geometries:_5cd.toJson(this._encodeGeometries(_64c)),geometry:_5cd.toJson({geometryType:_5d6.getJsonType(_64d),geometry:_64d.toJson()})}),_652=this._differenceHandler,_653=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/difference",content:_651,callbackParamName:"callback",load:function(r,i){_652(r,i,_650,_64e,_64f,dfd);},error:function(r){_653(r,_64f,dfd);}});return dfd;},_differenceHandler:function(_654,io,_655,_656,_657,dfd){try{var _658=_654.geometries,_659=[];_5cc.forEach(_658,function(geom){_659.push(_5d6.fromJson(geom).setSpatialReference(_655));});this._successHandler([_659],"onDifferenceComplete",_656,dfd);}catch(err){this._errorHandler(err,_657,dfd);}},onDifferenceComplete:function(){},buffer:function(_65a,_65b,_65c){var _65d=lang.mixin({},this._url.query,{f:"json"},_65a.toJson()),sr=_65a.outSpatialReference||_65a.geometries[0].spatialReference,_65e=this._bufferHandler,_65f=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/buffer",content:_65d,callbackParamName:"callback",load:function(r,i){_65e(r,i,sr,_65b,_65c,dfd);},error:function(r){_65f(r,_65c,dfd);}});return dfd;},_bufferHandler:function(_660,io,sr,_661,_662,dfd){try{var _663=_660.geometries,_664=[],i,il=_663.length;for(i=0;i<il;i++){_664[i]=new _5d4({spatialReference:sr,rings:_663[i].rings});}this._successHandler([_664],"onBufferComplete",_661,dfd);}catch(err){this._errorHandler(err,_662,dfd);}},onBufferComplete:function(){},areasAndLengths:function(_665,_666,_667){var _668=lang.mixin({},this._url.query,{f:"json"},_665.toJson()),_669=this._areasAndLengthsHandler,_66a=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/areasAndLengths",content:_668,callbackParamName:"callback",load:function(r,i){_669(r,i,_666,_667,dfd);},error:function(r){_66a(r,_667,dfd);}});return dfd;},_areasAndLengthsHandler:function(_66b,io,_66c,_66d,dfd){try{this._successHandler([_66b],"onAreasAndLengthsComplete",_66c,dfd);}catch(err){this._errorHandler(err,_66d,dfd);}},onAreasAndLengthsComplete:function(){},lengths:function(_66e,_66f,_670){var _671=lang.mixin({},this._url.query,{f:"json"},_66e.toJson()),_672=this._lengthsHandler,_673=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/lengths",content:_671,callbackParamName:"callback",load:function(r,i){_672(r,i,_66f,_670,dfd);},error:function(r){_673(r,_670,dfd);}});return dfd;},_lengthsHandler:function(_674,io,_675,_676,dfd){try{this._successHandler([_674],"onLengthsComplete",_675,dfd);}catch(err){this._errorHandler(err,_676,dfd);}},onLengthsComplete:function(){},labelPoints:function(_677,_678,_679){var _67a=_5cc.map(_677,function(geom){return geom.toJson();});var sr=_677[0].spatialReference,_67b=lang.mixin({},this._url.query,{f:"json",sr:sr.wkid?sr.wkid:_5cd.toJson(sr.toJson()),polygons:_5cd.toJson(_67a)}),_67c=this._labelPointsHandler,_67d=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/labelPoints",content:_67b,callbackParamName:"callback",load:function(r,i){_67c(r,i,_677,sr,_678,_679,dfd);},error:function(r){_67d(r,_679,dfd);}});return dfd;},_labelPointsHandler:function(_67e,io,_67f,sr,_680,_681,dfd){try{var _682=_67e.labelPoints,_683=[];_5cc.forEach(_682,function(geom){_683.push(_5d6.fromJson(geom).setSpatialReference(sr));});this._successHandler([_683],"onLabelPointsComplete",_680,dfd);}catch(err){this._errorHandler(err,_681,dfd);}},onLabelPointsComplete:function(){},relation:function(_684,_685,_686){var _687=lang.mixin({},this._url.query,{f:"json"},_684.toJson()),_688=this._relationHandler,_689=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/relation",content:_687,callbackParamName:"callback",load:function(r,i){_688(r,i,_685,_686,dfd);},error:function(r){_689(r,_686,dfd);}});return dfd;},_relationHandler:function(_68a,io,_68b,_68c,dfd){try{var _68d=_68a.relations;this._successHandler([_68d],"onRelationComplete",_68b,dfd);}catch(err){this._errorHandler(err,_68c,dfd);}},onRelationComplete:function(){},trimExtend:function(_68e,_68f,_690){var _691=lang.mixin({},this._url.query,{f:"json"},_68e.toJson()),_692=_68e.sr,_693=this._trimExtendHandler,_694=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/trimExtend",content:_691,callbackParamName:"callback",load:function(r,i){_693(r,i,_692,_68f,_690,dfd);},error:function(r){_694(r,_690,dfd);}});return dfd;},_trimExtendHandler:function(_695,io,_696,_697,_698,dfd){try{var _699=_695.geometries,_69a=[],i,il=_699.length;for(i=0;i<il;i++){_69a[i]=new _5d3({spatialReference:_696,paths:_699[i].paths});}this._successHandler([_69a],"onTrimExtendComplete",_697,dfd);}catch(err){this._errorHandler(err,_698,dfd);}},onTrimExtendComplete:function(){},densify:function(_69b,_69c,_69d){var _69e=lang.mixin({},this._url.query,{f:"json"},_69b.toJson()),_69f=_69b.geometries[0].spatialReference,_6a0=this._densifyHandler,_6a1=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/densify",content:_69e,callbackParamName:"callback",load:function(r,i){_6a0(r,i,_69f,_69c,_69d,dfd);},error:function(r){_6a1(r,_69d,dfd);}});return dfd;},_densifyHandler:function(_6a2,io,_6a3,_6a4,_6a5,dfd){try{var _6a6=_6a2.geometries,_6a7=[];_5cc.forEach(_6a6,function(geom){_6a7.push(_5d6.fromJson(geom).setSpatialReference(_6a3));});this._successHandler([_6a7],"onDensifyComplete",_6a4,dfd);}catch(err){this._errorHandler(err,_6a5,dfd);}},onDensifyComplete:function(){},generalize:function(_6a8,_6a9,_6aa){var _6ab=lang.mixin({},this._url.query,{f:"json"},_6a8.toJson()),_6ac=_6a8.geometries[0].spatialReference,_6ad=this._generalizeHandler,_6ae=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/generalize",content:_6ab,callbackParamName:"callback",load:function(r,i){_6ad(r,i,_6ac,_6a9,_6aa,dfd);},error:function(r){_6ae(r,_6aa,dfd);}});return dfd;},_generalizeHandler:function(_6af,io,_6b0,_6b1,_6b2,dfd){try{var _6b3=_6af.geometries,_6b4=[];_5cc.forEach(_6b3,function(geom){_6b4.push(_5d6.fromJson(geom).setSpatialReference(_6b0));});this._successHandler([_6b4],"onGeneralizeComplete",_6b1,dfd);}catch(err){this._errorHandler(err,_6b2,dfd);}},onGeneralizeComplete:function(){},offset:function(_6b5,_6b6,_6b7){var _6b8=lang.mixin({},this._url.query,{f:"json"},_6b5.toJson()),_6b9=_6b5.geometries[0].spatialReference,_6ba=this._offsetHandler,_6bb=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/offset",content:_6b8,callbackParamName:"callback",load:function(r,i){_6ba(r,i,_6b9,_6b6,_6b7,dfd);},error:function(r){_6bb(r,_6b7,dfd);}});return dfd;},_offsetHandler:function(_6bc,io,_6bd,_6be,_6bf,dfd){try{var _6c0=_6bc.geometries,_6c1=[];_5cc.forEach(_6c0,function(geom){_6c1.push(_5d6.fromJson(geom).setSpatialReference(_6bd));});this._successHandler([_6c1],"onOffsetComplete",_6be,dfd);}catch(err){this._errorHandler(err,_6bf,dfd);}},onOffsetComplete:function(){},distance:function(_6c2,_6c3,_6c4){var _6c5=lang.mixin({},this._url.query,{f:"json"},_6c2.toJson()),_6c6=_6c2.geometry1.spatialReference,_6c7=this._distanceHandler,_6c8=this._errorHandler,dfd=new _5ce(_5d1._dfdCanceller);dfd._pendingDfd=_5d0({url:this._url.path+"/distance",content:_6c5,callbackParamName:"callback",load:function(r,i){_6c7(r,i,_6c6,_6c3,_6c4,dfd);},error:function(r){_6c8(r,_6c4,dfd);}});return dfd;},_distanceHandler:function(_6c9,io,_6ca,_6cb,_6cc,dfd){try{_6c9=_6c9&&_6c9.distance;this._successHandler([_6c9],"onDistanceComplete",_6cb,dfd);}catch(err){this._errorHandler(err,_6cc,dfd);}},onDistanceComplete:function(){}});lang.mixin(_5d7,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});if(has("extend-esri")){lang.setObject("tasks.GeometryService",_5d7,_5cf);}return _5d7;});},"dojo/parser":function(){define(["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./_base/html","./_base/window","./_base/url","./_base/json","./aspect","./date/stamp","./Deferred","./has","./query","./on","./ready"],function(_6cd,dojo,_6ce,_6cf,_6d0,_6d1,_6d2,_6d3,_6d4,_6d5,_6d6,_6d7,has,_6d8,don,_6d9){new Date("X");var _6da=0;_6d5.after(_6ce,"extend",function(){_6da++;},true);function _6db(ctor){var map=ctor._nameCaseMap,_6dc=ctor.prototype;if(!map||map._extendCnt<_6da){map=ctor._nameCaseMap={};for(var name in _6dc){if(name.charAt(0)==="_"){continue;}map[name.toLowerCase()]=name;}map._extendCnt=_6da;}return map;};var _6dd={};function _6de(_6df){var ts=_6df.join();if(!_6dd[ts]){var _6e0=[];for(var i=0,l=_6df.length;i<l;i++){var t=_6df[i];_6e0[_6e0.length]=(_6dd[t]=_6dd[t]||(_6ce.getObject(t)||(~t.indexOf("/")&&_6cd(t))));}var ctor=_6e0.shift();_6dd[ts]=_6e0.length?(ctor.createSubclass?ctor.createSubclass(_6e0):ctor.extend.apply(ctor,_6e0)):ctor;}return _6dd[ts];};var _6e1={_clearCache:function(){_6da++;_6dd={};},_functionFromScript:function(_6e2,_6e3){var _6e4="",_6e5="",_6e6=(_6e2.getAttribute(_6e3+"args")||_6e2.getAttribute("args")),_6e7=_6e2.getAttribute("with");var _6e8=(_6e6||"").split(/\s*,\s*/);if(_6e7&&_6e7.length){_6cf.forEach(_6e7.split(/\s*,\s*/),function(part){_6e4+="with("+part+"){";_6e5+="}";});}return new Function(_6e8,_6e4+_6e2.innerHTML+_6e5);},instantiate:function(_6e9,_6ea,_6eb){_6ea=_6ea||{};_6eb=_6eb||{};var _6ec=(_6eb.scope||dojo._scopeName)+"Type",_6ed="data-"+(_6eb.scope||dojo._scopeName)+"-",_6ee=_6ed+"type",_6ef=_6ed+"mixins";var list=[];_6cf.forEach(_6e9,function(node){var type=_6ec in _6ea?_6ea[_6ec]:node.getAttribute(_6ee)||node.getAttribute(_6ec);if(type){var _6f0=node.getAttribute(_6ef),_6f1=_6f0?[type].concat(_6f0.split(/\s*,\s*/)):[type];list.push({node:node,types:_6f1});}});return this._instantiate(list,_6ea,_6eb);},_instantiate:function(_6f2,_6f3,_6f4){var _6f5=_6cf.map(_6f2,function(obj){var ctor=obj.ctor||_6de(obj.types);if(!ctor){throw new Error("Unable to resolve constructor for: '"+obj.types.join()+"'");}return this.construct(ctor,obj.node,_6f3,_6f4,obj.scripts,obj.inherited);},this);if(!_6f3._started&&!_6f4.noStart){_6cf.forEach(_6f5,function(_6f6){if(typeof _6f6.startup==="function"&&!_6f6._started){_6f6.startup();}});}return _6f5;},construct:function(ctor,node,_6f7,_6f8,_6f9,_6fa){var _6fb=ctor&&ctor.prototype;_6f8=_6f8||{};var _6fc={};if(_6f8.defaults){_6ce.mixin(_6fc,_6f8.defaults);}if(_6fa){_6ce.mixin(_6fc,_6fa);}var _6fd;if(has("dom-attributes-explicit")){_6fd=node.attributes;}else{if(has("dom-attributes-specified-flag")){_6fd=_6cf.filter(node.attributes,function(a){return a.specified;});}else{var _6fe=/^input$|^img$/i.test(node.nodeName)?node:node.cloneNode(false),_6ff=_6fe.outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");_6fd=_6cf.map(_6ff.split(/\s+/),function(name){var _700=name.toLowerCase();return {name:name,value:(node.nodeName=="LI"&&name=="value")||_700=="enctype"?node.getAttribute(_700):node.getAttributeNode(_700).value};});}}var _701=_6f8.scope||dojo._scopeName,_702="data-"+_701+"-",hash={};if(_701!=="dojo"){hash[_702+"props"]="data-dojo-props";hash[_702+"type"]="data-dojo-type";hash[_702+"mixins"]="data-dojo-mixins";hash[_701+"type"]="dojoType";hash[_702+"id"]="data-dojo-id";}var i=0,item,_703=[],_704,_705;while(item=_6fd[i++]){var name=item.name,_706=name.toLowerCase(),_707=item.value;switch(hash[_706]||_706){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":_705=_707;break;case "data-dojo-id":case "jsid":_704=_707;break;case "data-dojo-attach-point":case "dojoattachpoint":_6fc.dojoAttachPoint=_707;break;case "data-dojo-attach-event":case "dojoattachevent":_6fc.dojoAttachEvent=_707;break;case "class":_6fc["class"]=node.className;break;case "style":_6fc["style"]=node.style&&node.style.cssText;break;default:if(!(name in _6fb)){var map=_6db(ctor);name=map[_706]||name;}if(name in _6fb){switch(typeof _6fb[name]){case "string":_6fc[name]=_707;break;case "number":_6fc[name]=_707.length?Number(_707):NaN;break;case "boolean":_6fc[name]=_707.toLowerCase()!="false";break;case "function":if(_707===""||_707.search(/[^\w\.]+/i)!=-1){_6fc[name]=new Function(_707);}else{_6fc[name]=_6ce.getObject(_707,false)||new Function(_707);}_703.push(name);break;default:var pVal=_6fb[name];_6fc[name]=(pVal&&"length" in pVal)?(_707?_707.split(/\s*,\s*/):[]):(pVal instanceof Date)?(_707==""?new Date(""):_707=="now"?new Date():_6d6.fromISOString(_707)):(pVal instanceof _6d3)?(dojo.baseUrl+_707):_6d4.fromJson(_707);}}else{_6fc[name]=_707;}}}for(var j=0;j<_703.length;j++){var _708=_703[j].toLowerCase();node.removeAttribute(_708);node[_708]=null;}if(_705){try{_705=_6d4.fromJson.call(_6f8.propsThis,"{"+_705+"}");_6ce.mixin(_6fc,_705);}catch(e){throw new Error(e.toString()+" in data-dojo-props='"+_705+"'");}}_6ce.mixin(_6fc,_6f7);if(!_6f9){_6f9=(ctor&&(ctor._noScript||_6fb._noScript)?[]:_6d8("> script[type^='dojo/']",node));}var _709=[],_70a=[],_70b=[],ons=[];if(_6f9){for(i=0;i<_6f9.length;i++){var _70c=_6f9[i];node.removeChild(_70c);var _70d=(_70c.getAttribute(_702+"event")||_70c.getAttribute("event")),prop=_70c.getAttribute(_702+"prop"),_70e=_70c.getAttribute(_702+"method"),_70f=_70c.getAttribute(_702+"advice"),_710=_70c.getAttribute("type"),nf=this._functionFromScript(_70c,_702);if(_70d){if(_710=="dojo/connect"){_709.push({method:_70d,func:nf});}else{if(_710=="dojo/on"){ons.push({event:_70d,func:nf});}else{_6fc[_70d]=nf;}}}else{if(_710=="dojo/aspect"){_709.push({method:_70e,advice:_70f,func:nf});}else{if(_710=="dojo/watch"){_70b.push({prop:prop,func:nf});}else{_70a.push(nf);}}}}}var _711=ctor.markupFactory||_6fb.markupFactory;var _712=_711?_711(_6fc,node,ctor):new ctor(_6fc,node);if(_704){_6ce.setObject(_704,_712);}for(i=0;i<_709.length;i++){_6d5[_709[i].advice||"after"](_712,_709[i].method,_6ce.hitch(_712,_709[i].func),true);}for(i=0;i<_70a.length;i++){_70a[i].call(_712);}for(i=0;i<_70b.length;i++){_712.watch(_70b[i].prop,_70b[i].func);}for(i=0;i<ons.length;i++){don(_712,ons[i].event,ons[i].func);}return _712;},scan:function(root,_713){var list=[],mids=[],_714={};var _715=(_713.scope||dojo._scopeName)+"Type",_716="data-"+(_713.scope||dojo._scopeName)+"-",_717=_716+"type",_718=_716+"textdir",_719=_716+"mixins";var node=root.firstChild;var _71a=_713.inherited;if(!_71a){function _71b(node,attr){return (node.getAttribute&&node.getAttribute(attr))||(node.parentNode&&_71b(node.parentNode,attr));};_71a={dir:_71b(root,"dir"),lang:_71b(root,"lang"),textDir:_71b(root,_718)};for(var key in _71a){if(!_71a[key]){delete _71a[key];}}}var _71c={inherited:_71a};var _71d;var _71e;function _71f(_720){if(!_720.inherited){_720.inherited={};var node=_720.node,_721=_71f(_720.parent);var _722={dir:node.getAttribute("dir")||_721.dir,lang:node.getAttribute("lang")||_721.lang,textDir:node.getAttribute(_718)||_721.textDir};for(var key in _722){if(_722[key]){_720.inherited[key]=_722[key];}}}return _720.inherited;};while(true){if(!node){if(!_71c||!_71c.node){break;}node=_71c.node.nextSibling;_71e=false;_71c=_71c.parent;_71d=_71c.scripts;continue;}if(node.nodeType!=1){node=node.nextSibling;continue;}if(_71d&&node.nodeName.toLowerCase()=="script"){type=node.getAttribute("type");if(type&&/^dojo\/\w/i.test(type)){_71d.push(node);}node=node.nextSibling;continue;}if(_71e){node=node.nextSibling;continue;}var type=node.getAttribute(_717)||node.getAttribute(_715);var _723=node.firstChild;if(!type&&(!_723||(_723.nodeType==3&&!_723.nextSibling))){node=node.nextSibling;continue;}var _724;var ctor=null;if(type){var _725=node.getAttribute(_719),_726=_725?[type].concat(_725.split(/\s*,\s*/)):[type];try{ctor=_6de(_726);}catch(e){}if(!ctor){_6cf.forEach(_726,function(t){if(~t.indexOf("/")&&!_714[t]){_714[t]=true;mids[mids.length]=t;}});}var _727=ctor&&!ctor.prototype._noScript?[]:null;_724={types:_726,ctor:ctor,parent:_71c,node:node,scripts:_727};_724.inherited=_71f(_724);list.push(_724);}else{_724={node:node,scripts:_71d,parent:_71c};}node=_723;_71d=_727;_71e=ctor&&ctor.prototype.stopParser&&!(_713.template);_71c=_724;}var d=new _6d7();if(mids.length){if(has("dojo-debug-messages")){console.warn("WARNING: Modules being Auto-Required: "+mids.join(", "));}_6cd(mids,function(){d.resolve(_6cf.filter(list,function(_728){if(!_728.ctor){try{_728.ctor=_6de(_728.types);}catch(e){}}var _729=_728.parent;while(_729&&!_729.types){_729=_729.parent;}var _72a=_728.ctor&&_728.ctor.prototype;_728.instantiateChildren=!(_72a&&_72a.stopParser&&!(_713.template));_728.instantiate=!_729||(_729.instantiate&&_729.instantiateChildren);return _728.instantiate;}));});}else{d.resolve(list);}return d.promise;},_require:function(_72b){var hash=_6d4.fromJson("{"+_72b.innerHTML+"}"),vars=[],mids=[],d=new _6d7();for(var name in hash){vars.push(name);mids.push(hash[name]);}_6cd(mids,function(){for(var i=0;i<vars.length;i++){_6ce.setObject(vars[i],arguments[i]);}d.resolve(arguments);});return d.promise;},_scanAmd:function(root){var _72c=new _6d7(),_72d=_72c.promise;_72c.resolve(true);var self=this;_6d8("script[type='dojo/require']",root).forEach(function(node){_72d=_72d.then(function(){return self._require(node);});node.parentNode.removeChild(node);});return _72d;},parse:function(_72e,_72f){var root;if(!_72f&&_72e&&_72e.rootNode){_72f=_72e;root=_72f.rootNode;}else{if(_72e&&_6ce.isObject(_72e)&&!("nodeType" in _72e)){_72f=_72e;}else{root=_72e;}}root=root?_6d1.byId(root):_6d2.body();_72f=_72f||{};var _730=_72f.template?{template:true}:{},_731=[],self=this;var p=this._scanAmd(root,_72f).then(function(){return self.scan(root,_72f);}).then(function(_732){return _731=_731.concat(self._instantiate(_732,_730,_72f));}).otherwise(function(e){console.error("dojo/parser::parse() error",e);throw e;});_6ce.mixin(_731,p);return _731;}};if(1){dojo.parser=_6e1;}if(_6d0.parseOnLoad){_6d9(100,_6e1,"parse");}return _6e1;});},"dijit/_Widget":function(){define("dijit/_Widget",["dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/ready","./registry","./_WidgetBase","./_OnDijitClickMixin","./_FocusMixin","dojo/uacss","./hccss"],function(_733,_734,_735,_736,has,_737,lang,_738,_739,_73a,_73b,_73c,_73d){function _73e(){};function _73f(_740){return function(obj,_741,_742,_743){if(obj&&typeof _741=="string"&&obj[_741]==_73e){return obj.on(_741.substring(2).toLowerCase(),lang.hitch(_742,_743));}return _740.apply(_735,arguments);};};_733.around(_735,"connect",_73f);if(_737.connect){_733.around(_737,"connect",_73f);}var _744=_736("dijit._Widget",[_73b,_73c,_73d],{onClick:_73e,onDblClick:_73e,onKeyDown:_73e,onKeyPress:_73e,onKeyUp:_73e,onMouseDown:_73e,onMouseMove:_73e,onMouseOut:_73e,onMouseOver:_73e,onMouseLeave:_73e,onMouseEnter:_73e,onMouseUp:_73e,constructor:function(_745){this._toConnect={};for(var name in _745){if(this[name]===_73e){this._toConnect[name.replace(/^on/,"").toLowerCase()]=_745[name];delete _745[name];}}},postCreate:function(){this.inherited(arguments);for(var name in this._toConnect){this.on(name,this._toConnect[name]);}delete this._toConnect;},on:function(type,func){if(this[this._onMap(type)]===_73e){return _735.connect(this.domNode,type.toLowerCase(),this,func);}return this.inherited(arguments);},_setFocusedAttr:function(val){this._focused=val;this._set("focused",val);},setAttribute:function(attr,_746){_737.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(attr,_746);},attr:function(name,_747){if(_734.isDebug){var _748=arguments.callee._ach||(arguments.callee._ach={}),_749=(arguments.callee.caller||"unknown caller").toString();if(!_748[_749]){_737.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+_749,"","2.0");_748[_749]=true;}}var args=arguments.length;if(args>=2||typeof name==="object"){return this.set.apply(this,arguments);}else{return this.get(name);}},getDescendants:function(){_737.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?_738("[widgetId]",this.containerNode).map(_73a.byNode):[];},_onShow:function(){this.onShow();},onShow:function(){},onHide:function(){},onClose:function(){return true;}});if(has("dijit-legacy-requires")){_739(0,function(){var _74a=["dijit/_base"];require(_74a);});}return _744;});},"dijit/focus":function(){define("dijit/focus",["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/ready","dojo/sniff","dojo/Stateful","dojo/_base/unload","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(_74b,_74c,dom,_74d,_74e,_74f,lang,on,_750,has,_751,_752,win,_753,a11y,_754,_755){var _756=_74c([_751,_74f],{curNode:null,activeStack:[],constructor:function(){var _757=lang.hitch(this,function(node){if(dom.isDescendant(this.curNode,node)){this.set("curNode",null);}if(dom.isDescendant(this.prevNode,node)){this.set("prevNode",null);}});_74b.before(_74e,"empty",_757);_74b.before(_74e,"destroy",_757);},registerIframe:function(_758){return this.registerWin(_758.contentWindow,_758);},registerWin:function(_759,_75a){var _75b=this;var _75c=function(evt){_75b._justMouseDowned=true;setTimeout(function(){_75b._justMouseDowned=false;},0);if(has("ie")&&evt&&evt.srcElement&&evt.srcElement.parentNode==null){return;}_75b._onTouchNode(_75a||evt.target||evt.srcElement,"mouse");};var doc=has("ie")?_759.document.documentElement:_759.document;if(doc){if(has("ie")){_759.document.body.attachEvent("onmousedown",_75c);var _75d=function(evt){var tag=evt.srcElement.tagName.toLowerCase();if(tag=="#document"||tag=="body"){return;}if(a11y.isTabNavigable(evt.srcElement)){_75b._onFocusNode(_75a||evt.srcElement);}else{_75b._onTouchNode(_75a||evt.srcElement);}};doc.attachEvent("onfocusin",_75d);var _75e=function(evt){_75b._onBlurNode(_75a||evt.srcElement);};doc.attachEvent("onfocusout",_75e);return {remove:function(){_759.document.detachEvent("onmousedown",_75c);doc.detachEvent("onfocusin",_75d);doc.detachEvent("onfocusout",_75e);doc=null;}};}else{doc.body.addEventListener("mousedown",_75c,true);doc.body.addEventListener("touchstart",_75c,true);var _75f=function(evt){_75b._onFocusNode(_75a||evt.target);};doc.addEventListener("focus",_75f,true);var _760=function(evt){_75b._onBlurNode(_75a||evt.target);};doc.addEventListener("blur",_760,true);return {remove:function(){doc.body.removeEventListener("mousedown",_75c,true);doc.body.removeEventListener("touchstart",_75c,true);doc.removeEventListener("focus",_75f,true);doc.removeEventListener("blur",_760,true);doc=null;}};}}},_onBlurNode:function(node){if(this._clearFocusTimer){clearTimeout(this._clearFocusTimer);}this._clearFocusTimer=setTimeout(lang.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null);}),0);if(this._justMouseDowned){return;}if(this._clearActiveWidgetsTimer){clearTimeout(this._clearActiveWidgetsTimer);}this._clearActiveWidgetsTimer=setTimeout(lang.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([]);}),0);},_onTouchNode:function(node,by){if(this._clearActiveWidgetsTimer){clearTimeout(this._clearActiveWidgetsTimer);delete this._clearActiveWidgetsTimer;}var _761=[];try{while(node){var _762=_74d.get(node,"dijitPopupParent");if(_762){node=_754.byId(_762).domNode;}else{if(node.tagName&&node.tagName.toLowerCase()=="body"){if(node===win.body()){break;}node=_753.get(node.ownerDocument).frameElement;}else{var id=node.getAttribute&&node.getAttribute("widgetId"),_763=id&&_754.byId(id);if(_763&&!(by=="mouse"&&_763.get("disabled"))){_761.unshift(id);}node=node.parentNode;}}}}catch(e){}this._setStack(_761,by);},_onFocusNode:function(node){if(!node){return;}if(node.nodeType==9){return;}if(this._clearFocusTimer){clearTimeout(this._clearFocusTimer);delete this._clearFocusTimer;}this._onTouchNode(node);if(node==this.curNode){return;}this.set("prevNode",this.curNode);this.set("curNode",node);},_setStack:function(_764,by){var _765=this.activeStack;this.set("activeStack",_764);for(var _766=0;_766<Math.min(_765.length,_764.length);_766++){if(_765[_766]!=_764[_766]){break;}}var _767;for(var i=_765.length-1;i>=_766;i--){_767=_754.byId(_765[i]);if(_767){_767._hasBeenBlurred=true;_767.set("focused",false);if(_767._focusManager==this){_767._onBlur(by);}this.emit("widget-blur",_767,by);}}for(i=_766;i<_764.length;i++){_767=_754.byId(_764[i]);if(_767){_767.set("focused",true);if(_767._focusManager==this){_767._onFocus(by);}this.emit("widget-focus",_767,by);}}},focus:function(node){if(node){try{node.focus();}catch(e){}}}});var _768=new _756();_750(function(){var _769=_768.registerWin(_753.get(win.doc));if(has("ie")){_752.addOnWindowUnload(function(){if(_769){_769.remove();_769=null;}});}});_755.focus=function(node){_768.focus(node);};for(var attr in _768){if(!/^_/.test(attr)){_755.focus[attr]=typeof _768[attr]=="function"?lang.hitch(_768,attr):_768[attr];}}_768.watch(function(attr,_76a,_76b){_755.focus[attr]=_76b;});return _768;});},"dijit/_FocusMixin":function(){define("dijit/_FocusMixin",["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(_76c,_76d,_76e,lang){lang.extend(_76d,{focused:false,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus();},_onBlur:function(){this.onBlur();}});return _76e("dijit._FocusMixin",null,{_focusManager:_76c});});},"esri/tasks/QueryTask":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/_base/json","dojo/has","esri/kernel","esri/request","esri/deferredUtils","esri/geometry/normalizeUtils","esri/tasks/Task","esri/tasks/FeatureSet"],function(_76f,lang,_770,_771,_772,has,_773,_774,_775,_776,Task,_777){var _778=_76f(Task,{declaredClass:"esri.tasks.QueryTask",constructor:function(url,_779){this._handler=lang.hitch(this,this._handler);this._relationshipQueryHandler=lang.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=lang.hitch(this,this._executeForIdsHandler);this._countHandler=lang.hitch(this,this._countHandler);this.source=_779&&_779.source;this.gdbVersion=_779&&_779.gdbVersion;},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},execute:function(_77a,_77b,_77c,_77d,_77e){var _77f=_77e.assembly,_780=this._encode(lang.mixin({},this._url.query,{f:"json"},_77a.toJson(_77f&&_77f[0]))),_781=this._handler,_782=this._errorHandler;if(this.source){var _783={source:this.source.toJson()};_780.layer=_772.toJson(_783);}if(this.gdbVersion){_780.gdbVersion=this.gdbVersion;}return _774({url:this._url.path+"/query",content:_780,callbackParamName:"callback",load:function(r,i){_781(r,i,_77b,_77c,_77e.dfd);},error:function(r){_782(r,_77c,_77e.dfd);},callbackSuffix:_77d});},executeRelationshipQuery:function(_784,_785,_786){var _787=this._encode(lang.mixin({},this._url.query,{f:"json"},_784.toJson())),_788=this._relationshipQueryHandler,_789=this._errorHandler;if(this.gdbVersion){_787.gdbVersion=this.gdbVersion;}var dfd=new _771(_775._dfdCanceller);dfd._pendingDfd=_774({url:this._url.path+"/queryRelatedRecords",content:_787,callbackParamName:"callback",load:function(r,i){_788(r,i,_785,_786,dfd);},error:function(r){_789(r,_786,dfd);}});return dfd;},executeForIds:function(_78a,_78b,_78c,_78d){var _78e=_78d.assembly,_78f=this._encode(lang.mixin({},this._url.query,{f:"json",returnIdsOnly:true},_78a.toJson(_78e&&_78e[0]))),_790=this._executeForIdsHandler,_791=this._errorHandler;if(this.source){var _792={source:this.source.toJson()};_78f.layer=_772.toJson(_792);}if(this.gdbVersion){_78f.gdbVersion=this.gdbVersion;}return _774({url:this._url.path+"/query",content:_78f,callbackParamName:"callback",load:function(r,i){_790(r,i,_78b,_78c,_78d.dfd);},error:function(r){_791(r,_78c,_78d.dfd);}});},executeForCount:function(_793,_794,_795,_796){var _797=_796.assembly,_798=this._encode(lang.mixin({},this._url.query,{f:"json",returnIdsOnly:true,returnCountOnly:true},_793.toJson(_797&&_797[0]))),_799=this._countHandler,_79a=this._errorHandler;if(this.source){var _79b={source:this.source.toJson()};_798.layer=_772.toJson(_79b);}if(this.gdbVersion){_798.gdbVersion=this.gdbVersion;}return _774({url:this._url.path+"/query",content:_798,callbackParamName:"callback",load:function(r,i){_799(r,i,_794,_795,_796.dfd);},error:function(r){_79a(r,_795,_796.dfd);}});},_handler:function(_79c,io,_79d,_79e,dfd){try{var _79f=new _777(_79c);this._successHandler([_79f],"onComplete",_79d,dfd);}catch(err){this._errorHandler(err,_79e,dfd);}},_relationshipQueryHandler:function(_7a0,io,_7a1,_7a2,dfd){try{var gt=_7a0.geometryType,sr=_7a0.spatialReference,_7a3={};_770.forEach(_7a0.relatedRecordGroups,function(gr){var _7a4={};_7a4.geometryType=gt;_7a4.spatialReference=sr;_7a4.features=gr.relatedRecords;var fset=new _777(_7a4);_7a3[gr.objectId]=fset;});this._successHandler([_7a3],"onExecuteRelationshipQueryComplete",_7a1,dfd);}catch(err){this._errorHandler(err,_7a2,dfd);}},_executeForIdsHandler:function(_7a5,io,_7a6,_7a7,dfd){try{this._successHandler([_7a5.objectIds],"onExecuteForIdsComplete",_7a6,dfd);}catch(err){this._errorHandler(err,_7a7,dfd);}},_countHandler:function(_7a8,io,_7a9,_7aa,dfd){try{var _7ab,_7ac=_7a8.features,ids=_7a8.objectIds;if(ids){_7ab=ids.length;}else{if(_7ac){throw new Error("Unable to perform query. Please check your parameters.");}else{_7ab=_7a8.count;}}this._successHandler([_7ab],"onExecuteForCountComplete",_7a9,dfd);}catch(err){this._errorHandler(err,_7aa,dfd);}}});_776._createWrappers(_778);if(has("extend-esri")){lang.setObject("tasks.QueryTask",_778,_773);}return _778;});},"esri/layers/ArcGISImageServiceLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","dojo/io-query","esri/kernel","esri/config","esri/lang","esri/request","esri/urlUtils","esri/geometry/Extent","esri/layers/DynamicMapServiceLayer","esri/layers/TimeInfo","esri/layers/Field"],function(_7ad,lang,_7ae,has,ioq,_7af,_7b0,_7b1,_7b2,_7b3,_7b4,_7b5,_7b6,_7b7){var _7b8=_7ad(_7b5,{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(url,_7b9){this._url=_7b3.urlToObject(url);var _7ba=_7b9&&_7b9.imageServiceParameters;this.format=_7ba&&_7ba.format;this.interpolation=_7ba?_7ba.interpolation:null;this.compressionQuality=_7ba?_7ba.compressionQuality:null;this.bandIds=_7ba?_7ba.bandIds:null;this.mosaicRule=_7ba?_7ba.mosaicRule:null;this.renderingRule=_7ba?_7ba.renderingRule:null;this._params=lang.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},_7ba?_7ba.toJson():{});this._initLayer=lang.hitch(this,this._initLayer);this.useMapImage=(_7b9&&_7b9.useMapImage)||false;this._loadCallback=_7b9&&_7b9.loadCallback;var _7bb=_7b9&&_7b9.resourceInfo;if(_7bb){this._initLayer(_7bb);}else{_7b2({url:this._url.path,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}},disableClientCaching:false,_initLayer:function(_7bc,io){this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_7bc&&_7bc._ssl);if(ssl){this._useSSL();}var _7bd=this.minScale,_7be=this.maxScale;lang.mixin(this,_7bc);this.minScale=_7bd;this.maxScale=_7be;this.initialExtent=(this.fullExtent=this.extent=(new _7b4(_7bc.extent)));this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var i,il,mins=this.minValues,maxs=this.maxValues,_7bf=this.meanValues,_7c0=this.stdvValues,bs=(this.bands=[]);for(i=0,il=this.bandCount;i<il;i++){bs[i]={min:mins[i],max:maxs[i],mean:_7bf[i],stddev:_7c0[i]};}var _7c1=this.timeInfo;this.timeInfo=(_7c1&&_7c1.timeExtent)?new _7b6(_7c1):null;var _7c2=this.fields=[];var _7c3=_7bc.fields;if(_7c3){for(i=0;i<_7c3.length;i++){_7c2.push(new _7b7(_7c3[i]));}}this.version=_7bc.currentVersion;if(!this.version){var ver;if("fields" in _7bc||"objectIdField" in _7bc||"timeInfo" in _7bc){ver=10;}else{ver=9.3;}this.version=ver;}if(_7b1.isDefined(_7bc.minScale)&&!this._hasMin){this.setMinScale(_7bc.minScale);}if(_7b1.isDefined(_7bc.maxScale)&&!this._hasMax){this.setMaxScale(_7bc.maxScale);}this.loaded=true;this.onLoad(this);var _7c4=this._loadCallback;if(_7c4){delete this._loadCallback;_7c4(this);}},getImageUrl:function(_7c5,_7c6,_7c7,_7c8){var sr=_7c5.spatialReference.wkid||_7ae.toJson(_7c5.spatialReference.toJson());delete this._params._ts;var path=this._url.path+"/exportImage?";lang.mixin(this._params,{bbox:_7c5.xmin+","+_7c5.ymin+","+_7c5.xmax+","+_7c5.ymax,imageSR:sr,bboxSR:sr,size:_7c6+","+_7c7},this.disableClientCaching?{_ts:new Date().getTime()}:{});var _7c9=(this._params.token=this._getToken()),_7ca=_7b3.addProxy(path+ioq.objectToQuery(lang.mixin(this._params,{f:"image"})));if((_7ca.length>_7b0.defaults.io.postLength)||this.useMapImage){this._jsonRequest=_7b2({url:path,content:lang.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(_7cb,io){var href=_7cb.href;if(_7c9){href+=(href.indexOf("?")===-1?("?token="+_7c9):("&token="+_7c9));}_7c8(_7b3.addProxy(href));},error:this._errorHandler});}else{_7c8(_7ca);}},setInterpolation:function(_7cc,_7cd){this.interpolation=(this._params.interpolation=_7cc);if(!_7cd){this.refresh(true);}},setCompressionQuality:function(_7ce,_7cf){this.compressionQuality=(this._params.compressionQuality=_7ce);if(!_7cf){this.refresh(true);}},setBandIds:function(ids,_7d0){this.bandIds=ids;this._params.bandIds=ids.join(",");if(!_7d0){this.refresh(true);}},setDefaultBandIds:function(_7d1){this.bandIds=(this._params.bandIds=null);if(!_7d1){this.refresh(true);}},setDisableClientCaching:function(_7d2){this.disableClientCaching=_7d2;},setMosaicRule:function(_7d3,_7d4){this.mosaicRule=_7d3;this._params.mosaicRule=_7ae.toJson(_7d3.toJson());if(!_7d4){this.refresh(true);}},setRenderingRule:function(_7d5,_7d6){this.renderingRule=_7d5;this._params.renderingRule=_7ae.toJson(_7d5.toJson());if(!_7d6){this.refresh(true);}},setImageFormat:function(_7d7,_7d8){this.format=(this._params.format=_7d7);if(!_7d8){this.refresh(true);}},refresh:function(_7d9){if(_7d9){this.inherited(arguments);}else{var dc=this.disableClientCaching;this.disableClientCaching=true;this.inherited(arguments);this.disableClientCaching=dc;}},exportMapImage:function(_7da,_7db){var m=_7b0.defaults.map,p=lang.mixin({size:m.width+","+m.height},this._params,_7da?_7da.toJson(this.normalization):{},{f:"json"});delete p._ts;this._exportMapImage(this._url.path+"/exportImage",p,_7db);}});if(has("extend-esri")){lang.setObject("layers.ArcGISImageServiceLayer",_7b8,_7af);}return _7b8;});},"esri/arcgis/csv":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/sniff","dojo/number","dojox/data/CsvStore","esri/kernel","esri/config","esri/request","esri/SpatialReference","esri/geometry/Point","esri/geometry/jsonUtils","esri/geometry/webMercatorUtils"],function(lang,_7dc,_7dd,has,_7de,_7df,_7e0,_7e1,_7e2,_7e3,_7e4,_7e5,_7e6){var _7e7=["lat","latitude","y","ycenter","latitude83","latdecdeg","POINT-Y"],_7e8=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","POINT-X"];function _7e9(_7ea){var _7eb=[","," ",";","|","\t"];var _7ec=0;var _7ed="";_7dc.forEach(_7eb,function(_7ee){var _7ef=_7ea.split(_7ee).length;if(_7ef>_7ec){_7ec=_7ef;_7ed=_7ee;}});return _7ed;};function _7f0(d,_7f1){if(!d||Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){return false;}var _7f2=true;if(has("chrome")&&/\d+\W*$/.test(_7f1)){var _7f3=_7f1.match(/[a-zA-Z]{2,}/);if(_7f3){var _7f4=false,i=0,len=_7f3.length,_7f5=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;while(!_7f4&&(i<=len)&&!(_7f4=!_7f5.test(_7f3[i]))){i++;}_7f2=!_7f4;}}return _7f2;};function _7f6(data,_7f7,_7f8){var _7f9=data.indexOf("\n");var _7fa=lang.trim(data.substr(0,_7f9));var _7fb=_7f7.columnDelimiter;if(!_7fb){_7fb=_7e9(_7fa);}var _7fc=new _7df({data:data,separator:_7fb});var _7fd=(has("ie")<9)?750:1001;_7fc.fetch({start:0,count:_7fd,onComplete:function(_7fe,_7ff){var _800=0;var _801={"layerDefinition":_7f7.layerDefinition,"featureSet":{"features":[],"geometryType":"esriGeometryPoint"}};var _802=_801.layerDefinition.objectIdField;if(!_802){if(!_7dc.some(_801.layerDefinition.fields,function(_803){if(_803.type=="esriFieldTypeOID"){_802=_803.name;return true;}return false;})){_801.layerDefinition.fields.push({"name":"__OBJECTID","alias":"__OBJECTID","type":"esriFieldTypeOID","editable":false,"domain":null});_802="__OBJECTID";}}var _804,_805;var _806=_7fc._attributes;var _807=[];var _808=[];_7dc.forEach(_801.layerDefinition.fields,function(_809,_80a){if(_809.type==="esriFieldTypeDate"){_807.push(_809.name);}else{if(_809.type==="esriFieldTypeDouble"||_809.type==="esriFieldTypeInteger"){_808.push(_809.name);}}});if(_7f7.locationInfo&&_7f7.locationInfo.locationType==="coordinates"){_804=_7f7.locationInfo.latitudeFieldName;_805=_7f7.locationInfo.longitudeFieldName;}else{_7dc.forEach(_806,function(_80b){var _80c;_80c=_7dc.indexOf(_7e7,_80b.toLowerCase());if(_80c!==-1){_804=_80b;}_80c=_7dc.indexOf(_7e8,_80b.toLowerCase());if(_80c!==-1){_805=_80b;}},this);}if(!_804||!_805){setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.");},1);return;}var i=0,il=_7fe.length;for(i;i<il;i++){if(_801.featureSet.features.length>=1000){setTimeout(function(){console.error("1000 feature limit reached. Unable to load any more data.");},1);break;}var item=_7fe[i];var _80d=_7fc.getAttributes(item),_80e={};_7dc.forEach(_80d,function(attr,_80f){if(attr){var _810=attr;if(attr.length===0){_7dc.forEach(_801.layerDefinition.fields,function(_811,idx){if(_811.name==="attribute_"+(idx-1)){attr="attribute_"+(idx-1);}});}if(_7dc.some(_807,function(a){return a===attr;})){var val=_7fc.getValue(item,_810),date=new Date(val);_80e[attr]=_7f0(date,val)?date.getTime():null;}else{if(_7dc.some(_808,function(a){return a===attr;})){var _812=_7de.parse(_7fc.getValue(item,_810));if((attr==_804||attr==_805)&&(isNaN(_812)||Math.abs(_812)>181)){_812=parseFloat(_7fc.getValue(item,_810));if(isNaN(_812)){_80e[attr]=null;}else{_80e[attr]=_812;}}else{if(isNaN(_812)){_80e[attr]=null;}else{_80e[attr]=_812;}}}else{_80e[attr]=_7fc.getValue(item,_810);}}}});_80e[_802]=_800;_800++;var _813=_80e[_804];var _814=_80e[_805];if(_814==null||_813==null||isNaN(_813)||isNaN(_814)){continue;}var _815=new _7e4(_814,_813,new _7e3({wkid:4326}));var _816={"geometry":_815.toJson(),"attributes":_80e};_801.featureSet.features.push(_816);}_801.layerDefinition.name="csv";if(_7f8){_7f8(_801);}},onError:function(_817){console.error("Error fetching items from CSV store: ",_817);}});return true;};function _818(_819,_81a,inSR,_81b,_81c,_81d){if(_819.length===0){_81c(null);}var _81e=_7e5.getGeometryType(_81a);var _81f=[];_7dc.forEach(_819,function(_820){var _821=new _81e(_820);_821.spatialReference=inSR;_81f.push(_821);},this);var _822=[102113,102100,3857];if(inSR.wkid&&inSR.wkid===4326&&_81b.wkid&&_7dc.indexOf(_822,_81b.wkid)>-1){_7dc.forEach(_81f,function(_823){if(_823.xmin){_823.xmin=Math.max(_823.xmin,-180);_823.xmax=Math.min(_823.xmax,180);_823.ymin=Math.max(_823.ymin,-89.99);_823.ymax=Math.min(_823.ymax,89.99);}else{if(_823.rings){_7dc.forEach(_823.rings,function(ring){_7dc.forEach(ring,function(_824){_824[0]=Math.min(Math.max(_824[0],-180),180);_824[1]=Math.min(Math.max(_824[1],-89.99),89.99);},this);},this);}else{if(_823.paths){_7dc.forEach(_823.paths,function(path){_7dc.forEach(path,function(_825){_825[0]=Math.min(Math.max(_825[0],-180),180);_825[1]=Math.min(Math.max(_825[1],-89.99),89.99);},this);},this);}else{if(_823.x){_823.x=Math.min(Math.max(_823.x,-180),180);_823.y=Math.min(Math.max(_823.y,-89.99),89.99);}}}}},this);_819=[];_7dc.forEach(_81f,function(_826){var _827=_7e6.geographicToWebMercator(_826);if(_81b.wkid!==102100){_827.spatialReference=_81b;}_819.push(_827.toJson());},this);_81c(_819);}else{if(inSR.wkid!==null&&_7dc.indexOf(_822,inSR.wkid)>-1&&_81b.wkid!==null&&_81b.wkid===4326){_819=[];_7dc.forEach(_81f,function(_828){_819.push(_7e6.webMercatorToGeographic(_828).toJson());},this);_81c(_819);}else{var _829=function(_82a,args){if(_82a&&_82a.length===_819.length){_819=[];_7dc.forEach(_82a,function(_82b){if(_82b&&((_82b.rings&&_82b.rings.length>0&&_82b.rings[0].length>0&&_82b.rings[0][0].length>0&&!isNaN(_82b.rings[0][0][0])&&!isNaN(_82b.rings[0][0][1]))||(_82b.paths&&_82b.paths.length>0&&_82b.paths[0].length>0&&_82b.paths[0][0].length>0&&!isNaN(_82b.paths[0][0][0])&&!isNaN(_82b.paths[0][0][1]))||(_82b.xmin&&!isNaN(_82b.xmin)&&_82b.ymin&&!isNaN(_82b.ymin))||(_82b.x&&!isNaN(_82b.x)&&_82b.y&&!isNaN(_82b.y)))){_819.push(_82b.toJson());}else{_819.push(null);}},this);_81c(_819);}else{_81d(_82a,args);}};if(_7e1.defaults.geometryService){_7e1.defaults.geometryService.project(_81f,_81b,lang.hitch(this,_829),_81d);}else{_81c(null);}}}};function _82c(sp1,sp2){var _82d=[102113,102100,3857];if(sp1&&sp2&&sp1.wkid===sp2.wkid&&sp1.wkt===sp2.wkt){return true;}else{if(sp1&&sp2&&sp1.wkid&&sp2.wkid&&_7dc.indexOf(_82d,sp1.wkid)>-1&&_7dc.indexOf(_82d,sp2.wkid)>-1){return true;}}return false;};function _82e(_82f,_830,_831,_832){if(!_82f.featureSet||_82f.featureSet.length===0){return;}if(_82c(_831,_830)){_832(_82f);return;}var _833=function(_834){var _835=[];_7dc.forEach(_82f.featureSet.features,function(_836,i){if(_834[i]){_836.geometry=_834[i];_835.push(_836);}},this);_832(_82f);};var _837=function(_838,args){console.error("error projecting featureSet ("+_82f.layerDefinition.name+"). Final try.");_832(_82f);};var _839=function(_83a,args){console.error("error projecting featureSet ("+_82f.layerDefinition.name+"). Try one more time.");_818(_83b,_82f.featureSet.geometryType,_830,_831,lang.hitch(this,_833),lang.hitch(this,_837));};if(_82f.featureSet.features&&_82f.featureSet.features.length>0){var _83b=[];_7dc.forEach(_82f.featureSet.features,function(_83c){_83b.push(_83c.geometry);});_818(_83b,_82f.featureSet.geometryType,_830,_831,lang.hitch(this,_833),lang.hitch(this,_839));}else{_832(_82f);}};function _83d(_83e){var _83f=new _7dd();var _840=function(_841){_83f.callback(_841);};var _842=_7e2({url:_83e.url,handleAs:"text",load:function(_843){_7f6(_843,_83e,lang.hitch(this,_840));},error:function(_844){console.error("error: "+_844);}},{usePost:false});return _83f;};function _845(_846,_847){var _848=new _7dd();var _849=function(_84a){_848.callback(_84a);};_82e(_846,new _7e3({wkid:4326}),_847,lang.hitch(this,_849));return _848;};function _84b(_84c){var _84d=_84c.layerDefinition.fields;var _84e={"esriFieldTypeDouble":1,"esriFieldTypeSingle":1};var _84f={"esriFieldTypeInteger":1,"esriFieldTypeSmallInteger":1};var dt={"esriFieldTypeDate":1};var _850=null;var _851=_7dc.map(_84d,lang.hitch(this,function(item){if(item.name.toUpperCase()==="NAME"){_850=item.name;}var _852=(item.type!=="esriFieldTypeOID"&&item.type!=="esriFieldTypeGlobalID"&&item.type!=="esriFieldTypeGeometry");var _853=null;if(_852){var f=item.name.toLowerCase();var _854=",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";if(_854.indexOf(","+f+",")>-1||f.indexOf("area")>-1||f.indexOf("length")>-1||f.indexOf("shape")>-1||f.indexOf("perimeter")>-1||f.indexOf("objectid")>-1||f.indexOf("_")===f.length-1||(f.indexOf("_i")===f.length-2&&f.length>1)){_852=false;}if(item.type in _84f){_853={places:0,digitSeparator:true};}else{if(item.type in _84e){_853={places:2,digitSeparator:true};}else{if(item.type in dt){_853={dateFormat:"shortDateShortTime"};}}}}return lang.mixin({},{fieldName:item.name,label:item.alias,isEditable:true,tooltip:"",visible:_852,format:_853,stringFieldOption:"textbox"});}));var _855={title:_850?"{"+_850+"}":"",fieldInfos:_851,description:null,showAttachments:false,mediaInfos:[]};return _855;};var csv={latFieldStrings:_7e7,longFieldStrings:_7e8,buildCSVFeatureCollection:_83d,projectFeatureCollection:_845,generateDefaultPopupInfo:_84b,_getSeparator:_7e9,_isValidDate:_7f0,_processCsvData:_7f6,_projectGeometries:_818,_sameSpatialReference:_82c,_projectFeatureSet:_82e};if(has("extend-esri")){lang.setObject("arcgis.csv",csv,_7e0);}return csv;});},"dijit/Destroyable":function(){define("dijit/Destroyable",["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(_856,_857,_858){return _858("dijit.Destroyable",null,{destroy:function(_859){this._destroyed=true;},own:function(){_856.forEach(arguments,function(_85a){var _85b="destroyRecursive" in _85a?"destroyRecursive":"destroy" in _85a?"destroy":"remove";var odh=_857.before(this,"destroy",function(_85c){_85a[_85b](_85c);});var hdh=_857.after(_85a,_85b,function(){odh.remove();hdh.remove();},true);},this);return arguments;}});});},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_85d,lang,has,_85e){var _85f=_85d(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(json){if(json&&lang.isObject(json)){this.objectId=json.objectId;this.success=json.success;if(!json.success){var err=json.error;this.error=new Error();this.error.code=err.code;this.error.message=err.description;}}}});if(has("extend-esri")){lang.setObject("layers.FeatureEditResult",_85f,_85e);}return _85f;});},"dojo/cache":function(){define(["./_base/kernel","./text"],function(dojo){return dojo.cache;});},"esri/tasks/query":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/has","esri/kernel","esri/geometry/jsonUtils","esri/tasks/SpatialRelationship","dojo/has!extend-esri?esri/tasks/QueryTask","dojo/has!extend-esri?esri/tasks/RelationshipQuery","dojo/has!extend-esri?esri/tasks/StatisticDefinition"],function(_860,lang,_861,_862,has,_863,_864,_865){var _866=_860(null,{declaredClass:"esri.tasks.Query",constructor:function(){this.spatialRelationship=_866.SPATIAL_REL_INTERSECTS;},text:null,where:"",geometry:null,groupByFieldsForStatistics:null,objectIds:null,returnGeometry:false,orderByFields:null,outSpatialReference:null,outFields:null,outStatistics:null,timeExtent:null,relationParam:null,toJson:function(_867){var json={text:this.text,where:this.where,returnGeometry:this.returnGeometry,spatialRel:this.spatialRelationship,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},g=_867&&_867["geometry"]||this.geometry,ids=this.objectIds,_868=this.outFields,_869=this.outSpatialReference,_86a=this.groupByFieldsForStatistics,_86b=this.orderByFields,_86c=this.outStatistics;if(g){json.geometry=g;json.geometryType=_864.getJsonType(g);json.inSR=g.spatialReference.wkid||_862.toJson(g.spatialReference.toJson());}if(ids){json.objectIds=ids.join(",");}if(_868){json.outFields=_868.join(",");}if(_86a){json.groupByFieldsForStatistics=_86a.join(",");}if(_86b){json.orderByFields=_86b.join(",");}if(_86c){var _86d=[];_861.forEach(_86c,function(item,idx){_86d.push(item.toJson());});json.outStatistics=_862.toJson(_86d);}if(_869!==null){json.outSR=_869.wkid||_862.toJson(_869.toJson());}else{if(g){json.outSR=g.spatialReference.wkid||_862.toJson(g.spatialReference.toJson());}}var _86e=this.timeExtent;json.time=_86e?_86e.toJson().join(","):null;var _86f=this.relationParam;if(_86f&&this.spatialRelationship===_866.SPATIAL_REL_RELATION){json.relationParam=_86f;}json._ts=this._ts;return json;}});lang.mixin(_866,_865);if(has("extend-esri")){lang.setObject("tasks.Query",_866,_863);}return _866;});},"esri/tasks/FeatureSet":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/graphic","esri/SpatialReference","esri/graphicsUtils","esri/geometry/jsonUtils","esri/symbols/jsonUtils"],function(_870,lang,_871,has,_872,_873,_874,_875,_876,_877,_878){var _879=_870(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(json){if(json){lang.mixin(this,json);var _87a=this.features,sr=json.spatialReference,_87b=_877.getGeometryType(json.geometryType);sr=(this.spatialReference=new _875(sr));this.geometryType=json.geometryType;if(json.fields){this.fields=json.fields;}_871.forEach(_87a,function(_87c,i){var _87d=_87c.geometry&&_87c.geometry.spatialReference;_87a[i]=new _874((_87b&&_87c.geometry)?new _87b(_87c.geometry):null,_87c.symbol&&_878.fromJson(_87c.symbol),_87c.attributes);if(_87a[i].geometry&&!_87d){_87a[i].geometry.setSpatialReference(sr);}});}else{this.features=[];}},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(_87e){var json={};if(this.displayFieldName){json.displayFieldName=this.displayFieldName;}if(this.fields){json.fields=this.fields;}if(this.spatialReference){json.spatialReference=this.spatialReference.toJson();}else{if(this.features[0]&&this.features[0].geometry){json.spatialReference=this.features[0].geometry.spatialReference.toJson();}}if(this.features[0]){if(this.features[0].geometry){json.geometryType=_877.getJsonType(this.features[0].geometry);}json.features=_876._encodeGraphics(this.features,_87e);}json.exceededTransferLimit=this.exceededTransferLimit;return _873.fixJson(json);}});if(has("extend-esri")){lang.setObject("tasks.FeatureSet",_879,_872);}return _879;});},"esri/layers/FeatureTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/graphic"],function(_87f,lang,has,_880,_881,_882){var _883=_87f(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(json){if(json&&lang.isObject(json)){this.name=json.name;this.description=json.description;this.drawingTool=json.drawingTool;var _884=json.prototype;this.prototype=new _882(_884.geometry,null,_884.attributes);}},toJson:function(){return _881.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()});}});lang.mixin(_883,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});if(has("extend-esri")){lang.setObject("layers.FeatureTemplate",_883,_880);}return _883;});},"esri/layers/ImageServiceParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/lang"],function(_885,lang,_886,has,_887,_888){var _889=_885(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,toJson:function(_88a){var ext=this.bbox||this.extent;ext=ext&&_88a&&ext._normalize(true);var wkid=ext?(ext.spatialReference.wkid||_886.toJson(ext.spatialReference.toJson())):null,_88b=this.imageSpatialReference,json={bbox:ext?(ext.xmin+","+ext.ymin+","+ext.xmax+","+ext.ymax):null,bboxSR:wkid,size:(this.width!==null&&this.height!==null?this.width+","+this.height:null),imageSR:(_88b?(_88b.wkid||_886.toJson(_88b.toJson())):wkid),format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?_886.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?_886.toJson(this.renderingRule.toJson()):null,noData:this.noData};var _88c=this.timeExtent;json.time=_88c?_88c.toJson().join(","):null;return _888.filter(json,function(_88d){if(_88d!==null){return true;}});}});lang.mixin(_889,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor"});if(has("extend-esri")){lang.setObject("layers.ImageServiceParameters",_889,_887);}return _889;});},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(lang){var _88e={};lang.setObject("dojo.data.util.filter",_88e);_88e.patternToRegExp=function(_88f,_890){var rxp="^";var c=null;for(var i=0;i<_88f.length;i++){c=_88f.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_88f.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_890){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _88e;});},"esri/dijit/PopupTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojo/dom-construct","esri/kernel","esri/InfoTemplate","esri/PopupInfo","esri/dijit/PopupRenderer"],function(_891,lang,has,_892,_893,_894,_895,_896){var PT=_891([_894,_895],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(json,_897){lang.mixin(this,_897);this.initialize(json,_897);},getTitle:function(_898){return this.info?this.getComponents(_898).title:"";},getContent:function(_899){return this.info?new _896({template:this,graphic:_899,chartTheme:this.chartTheme},_892.create("div")).domNode:"";}});if(has("extend-esri")){lang.setObject("dijit.PopupTemplate",PT,_893);}return PT;});},"*noref":1}});define("esri/arcgis/utils",["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/_base/json","dojo/_base/url","dojo/has","dojo/DeferredList","dojo/dom-construct","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/map","esri/urlUtils","esri/geometry/ScreenPoint","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/symbols/jsonUtils","esri/renderers/jsonUtils","esri/dijit/PopupTemplate","esri/dijit/Popup","esri/tasks/query","esri/tasks/GeometryService","esri/arcgis/csv","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/layers/WebTiledLayer","esri/layers/FeatureLayer","esri/layers/WMSLayer","esri/layers/KMLLayer","esri/layers/GeoRSSLayer","esri/virtualearth/VETiledLayer","esri/layers/TileInfo","esri/layers/DynamicLayerInfo","esri/layers/LayerDrawingOptions","esri/layers/ImageParameters","esri/layers/ImageServiceParameters","esri/layers/WMSLayerInfo","dojo/i18n!esri/nls/jsapi"],function(lang,_89a,_89b,_89c,_89d,Url,has,_89e,_89f,_8a0,_8a1,_8a2,_8a3,_8a4,Map,_8a5,_8a6,_8a7,_8a8,_8a9,_8aa,_8ab,_8ac,_8ad,_8ae,csv,_8af,_8b0,_8b1,_8b2,_8b3,_8b4,_8b5,_8b6,_8b7,_8b8,_8b9,_8ba,_8bb,_8bc,_8bd,_8be,_8bf){String.prototype.endsWith=function(str){return (this.match(str+"$")==str);};var _8c0;function _8c1(_8c2){var url=_8c0.arcgisUrl+"/"+_8c2.itemId+"/data";var _8c3=_8a3({url:url,content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:true,_preLookup:true});return _8c3;};function _8c4(_8c5){var _8c6={f:"json"};if(_8a0.id){var _8c7=_8a0.id.findCredential(_8a5.urlToObject(_8c0.arcgisUrl).path);if(_8c7){_8c6.token=_8c7.token;}}var _8c8=_8a3({url:_8c5,content:_8c6,callbackParamName:"callback"});return _8c8;};function _8c9(_8ca){if(_8ca.itemProperties.layerDefinition){if(_8ca.layerDefinition){if(!_8ca.layerDefinition.drawingInfo){_8ca.layerDefinition.drawingInfo=_8ca.itemProperties.layerDefinition.drawingInfo;}if(!_8a2.isDefined(_8ca.layerDefinition.definitionExpression)){_8ca.layerDefinition.definitionExpression=_8ca.itemProperties.layerDefinition.definitionExpression;}if(!_8a2.isDefined(_8ca.layerDefinition.minScale)){_8ca.layerDefinition.minScale=_8ca.itemProperties.layerDefinition.minScale;}if(!_8a2.isDefined(_8ca.layerDefinition.maxScale)){_8ca.layerDefinition.maxScale=_8ca.itemProperties.layerDefinition.maxScale;}}else{_8ca.layerDefinition=_8ca.itemProperties.layerDefinition;}}if(_8ca.itemProperties.popupInfo&&!_8ca.popupInfo&&!_8ca.disablePopup){_8ca.popupInfo=_8ca.itemProperties.popupInfo;}};function _8cb(_8cc,_8cd){var _8ce=new _89c();var _8cf=_8cc.itemData;var _8d0=[];var _8d1=[];_89a.forEach(_8cf.operationalLayers,function(_8d2){if(_8d2.itemId&&!_8d2.type){var _8d3=_8d2.url.toLowerCase();if(_8d3.indexOf("/featureserver")>-1){_8d1.push(_8d2);_8d0.push(_8c1(_8d2));}else{if(_8d3.indexOf("/mapserver")>-1&&_8d3.indexOf("/mapserver/")===-1&&(!_8d2.layers||(!_8a2.isDefined(_8d2.minScale)&&!_8a2.isDefined(_8d2.maxScale)))){_8d1.push(_8d2);_8d0.push(_8c1(_8d2));}else{if(_8d3.indexOf("/imageserver")>-1&&!_8a2.isDefined(_8d2.minScale)&&!_8a2.isDefined(_8d2.maxScale)){_8d1.push(_8d2);_8d0.push(_8c1(_8d2));}}}}});if(_8cf.baseMap&&_8cf.baseMap.baseMapLayers){_89a.forEach(_8cf.baseMap.baseMapLayers,function(_8d4){if((_8d4.type==="BingMapsAerial"||_8d4.type==="BingMapsRoad"||_8d4.type==="BingMapsHybrid")&&_8d4.portalUrl){_8d1.push(_8d4);_8d0.push(_8c4(_8d4.portalUrl));}});}if(_8d0.length>0){var _8d5=new _89e(_8d0);_8d5.addCallback(function(_8d6){_89a.forEach(_8d1,function(_8d7,i){if((_8d7.type==="BingMapsAerial"||_8d7.type==="BingMapsRoad"||_8d7.type==="BingMapsHybrid")&&_8d7.portalUrl){_8cd.bingMapsKey=_8d6[i][1].bingKey;return;}var _8d8=_8d6[i][1];if(_8d8){var _8d9=_8d7.url.toLowerCase();if(_8d9.indexOf("/featureserver")>-1&&_8d8.layers){_89a.forEach(_8d8.layers,function(_8da){if(_8d9.endsWith("/featureserver/"+_8da.id)){_8d7.itemProperties=_8da;_8c9(_8d7);}});}else{if(_8d9.indexOf("/mapserver")>-1){if(_8d8.layers&&!_8d7.layers){_8d7.layers=_8d8.layers;}if(_8a2.isDefined(_8d8.minScale)&&!_8a2.isDefined(_8d7.minScale)){_8d7.minScale=_8d8.minScale;}if(_8a2.isDefined(_8d8.maxScale)&&!_8a2.isDefined(_8d7.maxScale)){_8d7.maxScale=_8d8.maxScale;}}else{if(_8d9.indexOf("/imageserver")>-1){if(_8a2.isDefined(_8d8.minScale)&&!_8a2.isDefined(_8d7.minScale)){_8d7.minScale=_8d8.minScale;}if(_8a2.isDefined(_8d8.maxScale)&&!_8a2.isDefined(_8d7.maxScale)){_8d7.maxScale=_8d8.maxScale;}}}}}});_8ce.callback(_8cc);});}else{_8ce.callback(_8cc);}return _8ce;};function _8db(_8dc,_8dd){var _8de=_8dc.dynamicLayerInfos||_8dc.layerInfos;var _8df=_8dd.layers;if(_8df&&_8de){var _8e0=[],ids=[],urls=[];_89a.forEach(_8de,function(_8e1){var id=_8e1.id,i;if(!_8e1.subLayerIds&&_89a.indexOf(_8dc.visibleLayers,id)!==-1){for(i=0;i<_8df.length;i++){var _8e2=_8df[i];if(_8e2.id===id){ids.push(id);_8e0.push(_8e2.popupInfo);urls.push(_8e2.layerUrl||"");break;}}}});if(_8e0.length){_8dc.__popups=_8e0;_8dc.__popupIds=ids;_8dc.__popupUrls=urls;_8dc.__resourceInfo=_8dd.resourceInfo;}}};function _8e3(url){if(!url){return false;}var _8e4=".arcgis.com/";var _8e5=(new Url(_8c0.arcgisUrl)).authority;return (url.indexOf(_8e4)!==-1||url.indexOf(_8e5)!==-1);};function _8e6(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);};function _8e7(url){if(location.protocol==="https:"&&(_8e3(url)||_8e6(url))){url=url.replace("http:","https:");}return url;};function _8e8(_8e9){var _8ea=[];if(!_8e9.displayLevels){_8ea=_89a.map(_8e9.resourceInfo.tileInfo.lods,function(lod){return lod.level;});}var _8eb=new _8af(_8e7(_8e9.url),{resourceInfo:_8e9.resourceInfo,opacity:_8e9.opacity,visible:_8e9.visibility,displayLevels:_8e9.displayLevels||_8ea,id:_8e9.id,minScale:_8e9.minScale,maxScale:_8e9.maxScale});_8db(_8eb,_8e9);return _8eb;};function _8ec(_8ed,_8ee){if(!_8ed||!_8ee||_8ee.length===0){return [];}var _8ef=","+_8ee+",";var _8f0=[];var _8f1="";var k,_8f2=",";for(k=0;k<_8ed.length;k++){if(_8ed[k].subLayerIds!==null){if(_8ef.indexOf(","+_8ed[k].id+",")===-1||_8f2.indexOf(","+_8ed[k].id+",")>-1){_8f2+=_8ed[k].subLayerIds.toString()+",";}}else{if(_8ef.indexOf(","+_8ed[k].id+",")>-1&&_8f2.indexOf(","+_8ed[k].id+",")===-1){_8f0.push(_8ed[k].id);_8f1=",";}}}return _8f0;};function _8f3(_8f4){var _8f5=new _8bc();_8f5.format="png24";if(_8f4.resourceInfo&&_8f4.resourceInfo.supportedImageFormatTypes&&_8f4.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")>-1){_8f5.format="png32";}var _8f6=new _8b0(_8e7(_8f4.url),{resourceInfo:_8f4.resourceInfo,opacity:_8f4.opacity,visible:_8f4.visibility,id:_8f4.id,imageParameters:_8f5,minScale:_8f4.minScale,maxScale:_8f4.maxScale});var _8f7=_8f4.visibleLayers;if(!_8f4.visibleLayers){var _8f8="";var _8f9=_8f6.layerInfos;_89a.forEach(_8f9,function(_8fa){if(_8fa.defaultVisibility){_8f8+=(_8f8.length>0?",":"")+_8fa.id;}});_8f7=_8f8;}_8f7=_8ec(_8f6.layerInfos,_8f7);_8f6.setVisibleLayers(_8f7);if(_8f4.layers&&_8f4.layers.length>0){var _8fb=[],_8fc=[],_8fd,_8fe=[],_8ff;_89a.forEach(_8f4.layers,function(_900){if(_900.layerDefinition&&_900.layerDefinition.definitionExpression){_8fb[_900.id]=_900.layerDefinition.definitionExpression;}if(_900.layerDefinition&&_900.layerDefinition.source){_8fd=new _8ba(lang.mixin(_900,_900.layerDefinition));delete _8fd.layerDefinition;_8fd.id=_900.id;if(_8f4.visibleLayers&&_89a.indexOf(_8f4.visibleLayers,_900.id)===-1){_8fd.defaultVisibility=false;}if(_8a2.isDefined(_900.parentLayerId)){_8fd.parentLayerId=_900.parentLayerId;}if(_900.subLayerIds){_8fd.subLayerIds=_900.subLayerIds;}if(_900.name){_8fd.name=_900.name;}_8fc.push(_8fd);}if(_900.layerDefinition&&_900.layerDefinition.source&&_900.layerDefinition.drawingInfo){_8ff=new _8bb(_900.layerDefinition.drawingInfo);_8fe[_900.id]=_8ff;}},this);if(_8fb.length>0){_8f6.setLayerDefinitions(_8fb);}if(_8fc.length>0){_8f6.setDynamicLayerInfos(_8fc,true);if(_8fe.length>0){_8f6.setLayerDrawingOptions(_8fe,true);}}}_8db(_8f6,_8f4);return _8f6;};function _901(_902,_903){var _904=[102113,102100,3857];var sp1=new _8a4(_903[0].layerObject.fullExtent.spatialReference);var sp2=new _8a4(_902.resourceInfo.fullExtent.spatialReference);if(_89d.toJson(sp1.toJson())===_89d.toJson(sp2.toJson())){return true;}else{if(_89a.some(_904,function(wkid){return wkid===sp2.wkid;})&&_89a.some(_904,function(wkid){return wkid===sp1.wkid;})){return true;}}return false;};function _905(_906,_907){if(!_907[0].layerObject.tileInfo){return false;}var _908=[];_89a.forEach(_907,function(_909){if(_909.baseMapLayer){if(_909.layerObject.tileInfo){_908=_908.concat(_89a.map(_909.layerObject.tileInfo.lods,function(lod){return lod.scale;}));}}});var _90a=_89a.some(_906.resourceInfo.tileInfo.lods,function(lod){return _89a.some(_908,function(_90b){return _90b===lod.scale;});});return _90a;};function _90c(_90d,_90e,_90f,_910){var _911,_912=_90f._clazz;if(_90d.type==="OpenStreetMap"){_911=new _8b2({id:_90d.id,opacity:_90d.opacity,visible:(_90d.visibility!==null&&_90d.visibility!==undefined)?_90d.visibility:true});}else{if(_90d.type==="WMS"){var _913=[];var _914=[];_89a.forEach(_90d.layers,function(_915){_914.push(new _8be({name:_915.name,title:_915.title,legendURL:_915.legendURL}));_913.push(_915.name);},this);if(_90d.visibleLayers){_913=_90d.visibleLayers;}var _916=new _8a7(_90d.extent[0][0],_90d.extent[0][1],_90d.extent[1][0],_90d.extent[1][1],new _8a4({wkid:4326}));var _917={extent:_916,layerInfos:_914,version:_90d.version,maxWidth:_90d.maxWidth,maxHeight:_90d.maxHeight,getMapUrl:_90d.mapUrl,spatialReferences:_90d.spatialReferences,title:_90d.title,copyright:_90d.copyright};_911=new _8b5(_90d.url,{id:_90d.id,visibleLayers:_913,format:"png",transparent:_90d.baseMapLayer?false:true,opacity:_90d.opacity,visible:(_90d.visibility!==null)?_90d.visibility:true,resourceInfo:_917});_911.spatialReference.wkid=_917.spatialReferences[0];}else{if(_90d.type==="KML"){_911=new _8b6(_90d.url,{id:_90d.id,visible:(_90d.visibility!==null)?_90d.visibility:true,outSR:_910});_89b.connect(_911,"onLoad",function(){var _918=function(_919){_89a.forEach(_919,function(_91a){if(_91a.declaredClass==="esri.layers.FeatureLayer"||_91a.declaredClass==="esri.layers.MapImageLayer"){_91a.setOpacity(_90d.opacity);}else{if(_91a.declaredClass==="esri.layers.KMLLayer"){if(_91a.loaded){_918(_91a.getLayers());}else{_89b.connect(_91a,"onLoad",lang.hitch(this,function(lyr){_918(lyr.getLayers());}));}}}});};if(_90d.opacity||_90d.opacity===0){_918(_911.getLayers());}if(_90d.visibleFolders){_89a.forEach(_911.folders,function(_91b){if(_89a.indexOf(_90d.visibleFolders,_91b.id)>-1){_911.setFolderVisibility(_91b,true);}else{_911.setFolderVisibility(_91b,false);}},this);}});}else{if(_90d.type==="WebTiledLayer"){_911=new _8b3(_90d.templateUrl,{id:_90d.id,visible:(_90d.visibility!==null)?_90d.visibility:true,opacity:_90d.opacity,copyright:_90d.copyright,fullExtent:_90d.fullExtent&&new _8a7(_90d.fullExtent),initialExtent:_90d.fullExtent&&new _8a7(_90d.fullExtent),subDomains:_90d.subDomains,tileInfo:_90d.tileInfo?new _8b9(_90d.tileInfo):null});_89b.connect(_911,"onLoad",function(){if(_8a2.isDefined(_90d.minScale)||_8a2.isDefined(_90d.maxScale)){_911.setScaleRange(_90d.minScale,_90d.maxScale);}});}else{if(_90d.type==="GeoRSS"){_911=new _8b7(_90d.url,{id:_90d.id,visible:(_90d.visibility!==null)?_90d.visibility:true,opacity:_90d.opacity,outSpatialReference:_910});_89b.connect(_911,"onLoad",function(){var _91c=_911.getFeatureLayers();_89a.forEach(_91c,function(_91d){if(_90d.pointSymbol&&_91d.geometryType==="esriGeometryPoint"){_91d.renderer.symbol=_8a9.fromJson(_90d.pointSymbol);}else{if(_90d.lineSymbol&&_91d.geometryType==="esriGeometryPolyline"){_91d.renderer.symbol=_8a9.fromJson(_90d.lineSymbol);}else{if(_90d.polygonSymbol&&_91d.geometryType==="esriGeometryPolygon"){_91d.renderer.symbol=_8a9.fromJson(_90d.polygonSymbol);}}}if(_8a2.isDefined(_90d.minScale)||_8a2.isDefined(_90d.maxScale)){_91d.setScaleRange(_90d.minScale,_90d.maxScale);}});});}else{if(_90d.type=="CSV"&&_90d.url){_911=new _8b4(_90d.featureCollection,{infoTemplate:new _8ab(_90d.popupInfo?_90d.popupInfo:csv.generateDefaultPopupInfo(_90d.featureCollection)),id:_90d.id?_90d.id:null,outFields:["*"],visible:(_90d.visibility!==null)?_90d.visibility:true,opacity:_90d.opacity,autoGeneralize:true});}else{if(_90d.layerDefinition&&!_90d.url){var _91e=_89d.fromJson(_89d.toJson(_90d));delete _91e.id;delete _91e.opacity;delete _91e.visibility;_911=new _8b4(_91e,{id:_90d.id,opacity:_90d.opacity,visible:_90d.visibility,outFields:["*"],infoTemplate:_91e.popupInfo&&new _912(_91e.popupInfo),autoGeneralize:true});}else{if(_90d.type==="BingMapsAerial"||_90d.type==="BingMapsRoad"||_90d.type==="BingMapsHybrid"){var _91f=_8b8.MAP_STYLE_AERIAL_WITH_LABELS;if(_90d.type==="BingMapsAerial"){_91f=_8b8.MAP_STYLE_AERIAL;}else{if(_90d.type==="BingMapsRoad"){_91f=_8b8.MAP_STYLE_ROAD;}}_911=new _8b8({bingMapsKey:_90f.bingMapsKey,mapStyle:_91f,opacity:_90d.opacity,id:_90d.id});}else{if(_90d.resourceInfo&&_90d.resourceInfo.mapName){if(_90d.resourceInfo.singleFusedMapCache===true){if(!_90d.baseMapLayer){if(_901(_90d,_90e)){if(_905(_90d,_90e)){_911=_8e8(_90d);}else{_911=_8f3(_90d);}}else{_911=_8f3(_90d);}}else{_911=_8e8(_90d);}}else{_911=_8f3(_90d);}}else{if(_90d.resourceInfo&&_90d.resourceInfo.pixelSizeX){var _920=new _8bd();_920.bandIds=_90d.bandIds;if(!_90d.bandIds&&_90d.resourceInfo.bandCount&&parseInt(_90d.resourceInfo.bandCount,10)>3){_920.bandIds=[0,1,2];}_911=new _8b1(_8e7(_90d.url),{resourceInfo:_90d.resourceInfo,opacity:_90d.opacity,visible:_90d.visibility,id:_90d.id,imageServiceParameters:_920,minScale:_90d.minScale,maxScale:_90d.maxScale});}else{if(_90d.resourceInfo&&_90d.resourceInfo.type==="Feature Layer"){_911=new _8b4(_8e7(_90d.url),{resourceInfo:_90d.resourceInfo,opacity:_90d.opacity,visible:_90d.visibility,id:_90d.id,mode:_8a2.isDefined(_90d.mode)?_90d.mode:_8b4.MODE_ONDEMAND,outFields:["*"],infoTemplate:_90d.popupInfo&&new _912(_90d.popupInfo),autoGeneralize:true});if(_90d.layerDefinition){if(_90d.layerDefinition.drawingInfo&&_90d.layerDefinition.drawingInfo.renderer){var _921=_8aa.fromJson(_90d.layerDefinition.drawingInfo.renderer);_921.isMaxInclusive=true;_911.setRenderer(_921);}if(_90d.layerDefinition.definitionExpression){_911.setDefinitionExpression(_90d.layerDefinition.definitionExpression);}if(_8a2.isDefined(_90d.layerDefinition.minScale)){_911.setMinScale(_90d.layerDefinition.minScale);}if(_8a2.isDefined(_90d.layerDefinition.maxScale)){_911.setMaxScale(_90d.layerDefinition.maxScale);}}}}}}}}}}}}}if(_911){_911.arcgisProps={title:_90d.title};if(_90d.baseMapLayer){if(_90d.isReference){_911._basemapGalleryLayerType="reference";}else{_911._basemapGalleryLayerType="basemap";}}}return _911;};function _922(_923,_924,_925){_89a.forEach(_923,function(_926,_927){if(_926.url&&!_926.type){if(_927===0||_923[0].layerObject){_926.layerObject=_90c(_926,_923,_924,_925);}}else{if(_926.url&&_926.type=="CSV"){_926.layerObject=_90c(_926,_923,_924,_925);}else{_926.layerObject=_90c(_926,_923,_924,_925);}}});var _928=_89a.filter(_923,function(lyr){return !lyr.isReference;});var _929=_89a.filter(_923,function(lyr){return !!lyr.isReference;});_923=_928.concat(_929);return _923;};function _92a(_92b){var _92c=null;var _92d=_92b[0];if(_92d.url&&!_92d.type){if(_92d.resourceInfo.spatialReference){_92c=new _8a4();if(_92d.resourceInfo.spatialReference.wkid){_92c.wkid=_92d.resourceInfo.spatialReference.wkid;}if(_92d.resourceInfo.spatialReference.wkt){_92c.wkt=_92d.resourceInfo.spatialReference.wkt;}}}else{if(_92d.type.indexOf("BingMaps")>-1||_92d.type=="OpenStreetMap"){_92c=new _8a4({wkid:102100});}else{if(_92d.type=="WMS"){_92c=new _8a4({wkid:_92d.spatialReferences[0]});}}}return _92c;};function _92e(_92f,_930,_931,_932,_933){_89a.forEach(_930,function(_934,_935){if(_934.url&&!_934.type){_934.resourceInfo=_92f[_934.deferredsPos][1];delete _934.deferredsPos;}else{if(_934.url&&_934.type=="CSV"){_934.featureCollection=_932[_934.deferredsPos].results[0];delete _934.deferredsPos;}}});var _936=_92a(_930);var _937=[];var _938=new _89c();_89a.forEach(_930,function(_939){if(_939.url&&_939.type=="CSV"){_939.deferredsPos=_937.length;_937.push(csv.projectFeatureCollection(_939.featureCollection,_936));}});if(_937.length==0){_930=_922(_930,_931,_936);_933.callback(_930);}else{var _93a=new _89e(_937);_93a.addCallback(function(){_89a.forEach(_930,function(_93b){if(_93b.url&&_93b.type=="CSV"){_93b.featureCollection=_937[_93b.deferredsPos].results[0];delete _93b.deferredsPos;}});_930=_922(_930,_931,_936);_933.callback(_930);});}};function _93c(url,_93d){var url2=_8e7(url);return _8a3({url:url2,content:{f:"json"},callbackParamName:"callback",error:function(_93e,io){if(_93e.message){_93e.message+=" [url:"+url2+"]";}else{_93e.message="[url:"+url2+"]";}_93d.push(_93e);_8a1.defaults.io.errorHandler(_93e,io);}});};function _93f(_940,_941){var _942=[];var _943=[];var _944=[];var _945=new _89c();_89a.forEach(_940.operationalLayers,function(_946,_947){if(_946.featureCollection){_89a.forEach(_946.featureCollection.layers,function(_948,idx){var _949=true;if(_946.visibleLayers){if(_89a.indexOf(_946.visibleLayers,idx)==-1){_949=false;}}_948.visibility=(_946.visibility&&_949);_948.opacity=_946.opacity;_948.id=(_946.id||("operational"+_947))+"_"+idx;_944.push(_948);},this);}else{_944.push(_946);}});_89a.forEach(_940.baseMap.baseMapLayers,function(_94a,_94b){_94a.baseMapLayer=true;_94a.id=_94a.id||("base"+_94b);_942.push(_94a);});_89a.forEach(_944,function(_94c,_94d){_94c.id=_94c.id||("operational"+_94d);_942.push(_94c);});_89a.forEach(_942,function(_94e){if(_94e.url&&!_94e.type){_94e.deferredsPos=_943.length;_94e.errors=[];_943.push(_93c(_94e.url,_94e.errors));}else{if(_94e.url&&_94e.type=="CSV"){_94e.deferredsPos=_943.length;_943.push(csv.buildCSVFeatureCollection(_94e));}}});if(_943.length==0){var _94f=_92a(_942);_942=_922(_942,_941,_94f);_945.callback(_942);}else{var _950=new _89e(_943);_950.addCallback(function(_951){_92e(_951,_942,_941,_943,_945);});}return _945;};function _952(_953,_954){if(_954.version<=10.1&&_953){var i,id=parseInt(_954.url.substring(_954.url.lastIndexOf("/")+1,_954.url.length));for(i=_953.length-1;i>=0;i--){if(_953[i].id==id){if(_954.minScale==0&&_953[i].minScale>0){_954.minScale=_953[i].minScale;}else{if(_954.minScale>0&&_953[i].minScale==0){_954.minScale=_954.minScale;}else{if(_954.minScale>0&&_953[i].minScale>0){_954.minScale=Math.min(_954.minScale,_953[i].minScale);}}}_954.maxScale=Math.max(_954.maxScale||0,_953[i].maxScale||0);if(_953[i].parentLayerId>-1){id=_953[i].parentLayerId;}else{break;}}}}};function _955(_956,_957,_958,map){var url=_956.url;var _959=_956.__popups;var ids=_956.__popupIds;var urls=_956.__popupUrls;var _95a=_956.__resourceInfo;var _95b=[];_89a.forEach(_959,function(_95c,_95d){if(!_95c){return;}var _95e,_95f=[];_89a.forEach(_95c.fieldInfos,function(item){_95f.push(item.fieldName);});if(_956.dynamicLayerInfos&&_956.dynamicLayerInfos.length>0){var _960=_89a.filter(_956.dynamicLayerInfos,function(item){return ids[_95d]==item.id;})[0].source;_95e=new _8b4(url+"/dynamicLayer",{id:_956.id+"_"+ids[_95d],source:_960,outFields:_95f,mode:_8b4.MODE_SELECTION,infoTemplate:_95c&&new _958(_95c),drawMode:false,visible:_956.visible,autoGeneralize:true});}else{var i,_961=null;if(_957){for(i=0;i<_957.length;i++){if(_957[i].id===ids[_95d]){_961=_957[i];break;}}}var _962=url+"/"+ids[_95d];if(urls[_95d].length){_962=urls[_95d];}_95e=new _8b4(_8e7(_962),{id:_956.id+"_"+ids[_95d],outFields:_95f,mode:_8b4.MODE_SELECTION,infoTemplate:_95c&&new _958(_95c),drawMode:false,visible:_956.visible,resourceInfo:_961,autoGeneralize:true});}if(_95e.loaded){_952(_95a.layers,_95e);}else{_89b.connect(_95e,"onLoad",function(_963){_952(_95a.layers,_963);});}_95b.push(_95e);});if(_95b.length>0){var _964=function(_965,_966){_89a.forEach(_965,function(_967){if(_966){_967.show();}else{_967.hide();}});};_89b.connect(_956,"onVisibilityChange",lang.hitch(this,_964,_95b));var _968=function(_969,_96a,_96b){if(_969.id===_96b.id){_89a.forEach(_96a,function(_96c){map.removeLayer(_96c);});}};_89b.connect(map,"onLayerRemove",lang.hitch(this,_968,_956,_95b));}delete _956.__popups;delete _956.__popupIds;delete _956.__popupUrls;delete _956.__resourceInfo;return _95b;};function _96d(_96e){return _8a3({url:_8e7(_96e.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}});};function _96f(_970,map,_971){var _972=[];_89a.forEach(_970,function(_973){var _974=_973.__popups;if(_974&&_974.length>1&&_973.version>=10){_973.__deferredsPos=_972.length;_972.push(_96d(_973));}});var _975=[];if(_972.length>0){var _976=new _89e(_972);_976.addCallback(function(_977){_89a.forEach(_970,function(_978){if(_978.__popups&&_978.__popups.length>0){if(_978.__deferredsPos||_978.__deferredsPos===0){var _979=_977[_978.__deferredsPos][1];_975=_975.concat(_955(_978,_979.layers,_971,map));delete _978.__deferredsPos;}else{_975=_975.concat(_955(_978,null,_971,map));}}});map.addLayers(_975);});}else{_89a.forEach(_970,function(_97a){if(_97a.__popups&&_97a.__popups.length>0){_975=_975.concat(_955(_97a,null,_971,map));}});map.addLayers(_975);}};function _97b(_97c){_89a.forEach(_97c,function(_97d){var _97e=_97d.layer;if(_97e.toJson){var json=_97e.toJson();if(json.featureSet&&_97e.name.indexOf("Text")>-1){_89a.forEach(json.featureSet.features,function(_97f,idx){if(_97f.attributes.TEXT){var _980=_97e.graphics[idx];_980.symbol.setText(_97f.attributes.TEXT);if(_97f.symbol.horizontalAlignment){_980.symbol.align=_97f.symbol.horizontalAlignment;}_980.setSymbol(_980.symbol);_980.setAttributes(_97f.attributes);}},this);}}});};function _981(_982){var _983=6;_89a.forEach(_982,function(_984){var _985=_984.renderer;if(_985.declaredClass==="esri.renderer.SimpleRenderer"){var _986=_985.symbol;if(_986&&_986.xoffset){_983=Math.max(_983,Math.abs(_986.xoffset));}if(_986&&_986.yoffset){_983=Math.max(_983,Math.abs(_986.yoffset));}}else{if(_985.declaredClass==="esri.renderer.UniqueValueRenderer"||_985.declaredClass==="esri.renderer.ClassBreaksRenderer"){_89a.forEach(_985.infos,function(info){var _987=info.symbol;if(_987&&_987.xoffset){_983=Math.max(_983,Math.abs(_987.xoffset));}if(_987&&_987.yoffset){_983=Math.max(_983,Math.abs(_987.yoffset));}});}}});return _983;};function _988(evt){var map=this,_989=map.infoWindow,_98a=evt.graphic;if(!map.loaded){return;}_989.hide();_989.clearFeatures();var _98b=[];_89a.forEach(map.graphicsLayerIds,function(_98c){var _98d=map.getLayer(_98c);if(_98d&&_98d.declaredClass.indexOf("FeatureLayer")!==-1&&_98d.loaded&&_98d.visible){_98d.clearSelection();if(_98d.infoTemplate&&!_98d.suspended){_98b.push(_98d);}}});_98a=(_98a&&_98a._getEffInfoTemplate())?_98a:null;if(!_98b.length&&!_98a){return;}var _98e=_981(_98b);var _98f=evt.screenPoint,_990=map.toMap(new _8a6(_98f.x-_98e,_98f.y+_98e)),_991=map.toMap(new _8a6(_98f.x+_98e,_98f.y-_98e)),_992=new _8a7(_990.x,_990.y,_991.x,_991.y,map.spatialReference);var _993=new _8ad();_993.geometry=_992;_993.timeExtent=map.timeExtent;var _994=_89a.map(_98b,function(_995){var dfd=_995.selectFeatures(_993);dfd.addCallback(function(){var _996=_995.getSelectedFeatures();return _996;});return dfd;});if(_98a){var dfd=new _89c();dfd.callback([_98a]);_994.splice(0,0,dfd);}var _997=_89a.some(_994,function(dfd){return dfd.fired===-1;});if(!_997){var _998=_98a?1:0;_89a.forEach(_98b,function(_999){_998=_998+_999.getSelectedFeatures().length;});if(!_998){return;}}_989.setFeatures(_994);_989.show(evt.mapPoint,{closestFirst:true});};function _99a(_99b,_99c,_99d,_99e,_99f,_9a0){var _9a1=(_99f.mapOptions||{}),_9a2,_9a3;if(!_9a1.infoWindow){_9a2=new _8ac(null,_89f.create("div"));_9a1.infoWindow=_9a2;}if(!_8a2.isDefined(_9a1.showInfoWindowOnClick)){_9a1.showInfoWindowOnClick=false;}var map=new Map(_99e,_9a1);if(_99f.ignorePopups){_89a.forEach(_99b,function(_9a4){delete _9a4.infoTemplate;});}if(!(_99f.ignorePopups||_99f.disableClickBehavior)){_9a3=_89b.connect(map,"onClick",_988);}_89b.connect(map,"onLayersAddResult",_97b);map.addLayers(_99b);if(!_99f.ignorePopups){_96f(_99b,map,_99f._clazz);}var _9a5=[];_89a.forEach(_99c,function(_9a6){_9a5=_9a5.concat(_9a6.errors);},this);_9a0.callback({map:map,itemInfo:_99d,errors:_9a5,clickEventHandle:_9a3,clickEventListener:_988});};function _9a7(_9a8,_9a9,_9aa,_9ab,_9ac){try{var _9ad=_9aa.mapOptions||{};_9aa.mapOptions=_9ad;var card=_9a8.item;var _9ae=[];_89a.forEach(_9ac,function(_9af){if(lang.isArray(_9af.layerObject)){_89a.forEach(_9af.layerObject,function(l){_9ae.push(l);});}else{_9ae.push(_9af.layerObject);}});if(!_9ae[0]){_9ab.errback(new Error(_8bf.arcgis.utils.baseLayerError));return;}_9ae=_89a.filter(_9ae,_8a2.isDefined);if(card){if(card.extent){if(!_9ad.extent){var _9b0=new _8a7(card.extent[0][0],card.extent[0][1],card.extent[1][0],card.extent[1][1],new _8a4({wkid:4326}));var _9b1=_9ae[0].spatialReference;if(_9b1.wkid===4326){_9ad.extent=_9b0;_99a(_9ae,_9ac,_9a8,_9a9,_9aa,_9ab);}else{if(_9b1.wkid===102100||_9b1.wkid===102113||_9b1.wkid===3857){_9b0.xmin=Math.max(_9b0.xmin,-180);_9b0.xmax=Math.min(_9b0.xmax,180);_9b0.ymin=Math.max(_9b0.ymin,-89.99);_9b0.ymax=Math.min(_9b0.ymax,89.99);_9ad.extent=_8a8.geographicToWebMercator(_9b0);_99a(_9ae,_9ac,_9a8,_9a9,_9aa,_9ab);}else{if(_9aa.geometryServiceURL||_8a1.defaults.geometryService){var gs;if(_9aa.geometryServiceURL){gs=new _8ae(_9aa.geometryServiceURL);}else{gs=_8a1.defaults.geometryService;}gs.project([_9b0],_9b1,function(_9b2){var _9b3=_9b2[0];_9ad.extent=_9ad.extent||_9b3;_99a(_9ae,_9ac,_9a8,_9a9,_9aa,_9ab);});}else{_9ab.errback(new Error(_8bf.arcgis.utils.geometryServiceError));}}}}else{_99a(_9ae,_9ac,_9a8,_9a9,_9aa,_9ab);}}else{_99a(_9ae,_9ac,_9a8,_9a9,_9aa,_9ab);}}else{_99a(_9ae,_9ac,_9a8,_9a9,_9aa,_9ab);}}catch(err){_9ab.errback(err);}};function _9b4(_9b5){var _9b6=[];var _9b7=_9b5.baseMap.baseMapLayers.concat(_9b5.operationalLayers);_89a.forEach(_9b7,function(_9b8,_9b9){var _9ba={};if(_9b8.featureCollection&&_9b8.type!=="CSV"){if(_9b8.featureCollection.showLegend===true){_89a.forEach(_9b8.featureCollection.layers,function(_9bb){if(_9bb.showLegend!==false){_9ba={"layer":_9bb.layerObject,"title":_9b8.title,"defaultSymbol":false};if(_9b8.featureCollection.layers.length>1){_9ba.title+=" - "+_9bb.layerDefinition.name;}_9b6.push(_9ba);}});}}else{if((_9b8.baseMapLayer&&_9b8.showLegend===true&&_9b8.layerObject)||(!_9b8.baseMapLayer&&_9b8.showLegend!==false&&_9b8.layerObject)){var _9bc=false;if(_9b8.layerObject.version<10.1&&(_9b8.layerObject instanceof _8b0||_9b8.layerObject instanceof _8af)){_9bc=true;}_9ba={"layer":_9b8.layerObject,"title":_9b8.title,"defaultSymbol":_9bc};if(_9b8.layers){var _9bd=_89a.map(_89a.filter(_9b8.layers,function(lyr){return (lyr.showLegend===false);}),function(lyr){return lyr.id;});if(_9bd.length){_9ba.hideLayers=_9bd;}}_9b6.push(_9ba);}}});return _9b6;};function _9be(_9bf){if(_8c0._arcgisUrl&&_8c0._arcgisUrl.length>0){_8c0.arcgisUrl=_8c0._arcgisUrl;}var url=_8c0.arcgisUrl+"/"+_9bf;var _9c0={},_9c1=new _89c();_8a3({url:url,content:{f:"json"},callbackParamName:"callback",load:function(_9c2){_9c0.item=_9c2;_8a3({url:url+"/data",content:{f:"json"},callbackParamName:"callback",load:function(_9c3){_9c0.itemData=_9c3;_9c1.callback(_9c0);},error:function(_9c4){_9c1.errback(_9c4);}});},error:function(_9c5){_9c1.errback(_9c5);}});return _9c1;};function _9c6(arg1,_9c7,_9c8){var _9c9=new _89c();_9c8=_9c8||{};var _9ca=_9c8.infoTemplateClass;_9c8._clazz=(_9ca&&(lang.isObject(_9ca)?_9ca:lang.getObject(_9ca)))||_8ab;if(lang.isString(arg1)){_9be(arg1).addCallback(function(_9cb){_8cb(_9cb,_9c8).addCallback(function(_9cc){_93f(_9cc.itemData,_9c8).addCallback(lang.hitch(null,_9a7,_9cc,_9c7,_9c8,_9c9));});}).addErrback(lang.hitch(_9c9,_9c9.errback));}else{_8cb(arg1,_9c8).addCallback(function(_9cd){_93f(_9cd.itemData,_9c8).addCallback(lang.hitch(null,_9a7,_9cd,_9c7,_9c8,_9c9));});}return _9c9;};function _9ce(_9cf){if(_9cf&&_9cf.itemInfo&&_9cf.itemInfo.itemData){return _9b4(_9cf.itemInfo.itemData);}else{return [];}};_8c0={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:_9be,createMap:_9c6,getLegendLayers:_9ce,_arcgisUrl:null,_getItemProps:_8cb,_getItemData:_8c1,_getBingKey:_8c4,_processFSItemProperties:_8c9,_getLayers:_93f,_preBuildLayerObjects:_92e,_buildLayerObjects:_922,_preCreateMap:_9a7,_getMapSR:_92a,_createMap:_99a,_addSelectionLayers:_96f,_createSelectionFeatureLayers:_955,_getServiceInfo:_93c,_getLayersInfo:_96d,_initLayer:_90c,_loadAsCached:_8e8,_loadAsDynamic:_8f3,_processPopups:_8db,_onLayersAddResult:_97b,_sameSpatialReferenceAsBasemap:_901,_sameTilingSchemeAsBasemap:_905,_showPopup:_988,_calculateClickTolerance:_981,_getVisibleFeatureLayers:_8ec,_updateLayerScaleInfo:_952,_checkUrl:_8e7,_isHostedService:_8e3,_isAgolService:_8e6,_getLegendLayers:_9b4};lang.setObject("arcgis.utils",_8c0,_8a0);return _8c0;});