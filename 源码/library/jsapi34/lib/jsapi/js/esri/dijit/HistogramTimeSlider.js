/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"url:dojox/form/resources/HorizontalRangeSlider.html":"<table class=\"dijit dijitReset dijitSlider dijitSliderH dojoxRangeSlider\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" rules=\"none\" dojoAttachEvent=\"onkeypress:_onKeyPress,onkeyup:_onKeyUp\" role=\"presentation\"\n\t><tr class=\"dijitReset\"\n\t\t><td class=\"dijitReset\" colspan=\"2\"></td\n\t\t><td dojoAttachPoint=\"topDecoration\" class=\"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH\"></td\n\t\t><td class=\"dijitReset\" colspan=\"2\"></td\n\t></tr\n\t><tr class=\"dijitReset\"\n\t\t><td class=\"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH\"\n\t\t\t><div class=\"dijitSliderDecrementIconH\" tabIndex=\"-1\" style=\"display:none\" dojoAttachPoint=\"decrementButton\"><span class=\"dijitSliderButtonInner\">-</span></div\n\t\t></td\n\t\t><td class=\"dijitReset\"\n\t\t\t><div class=\"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper\" dojoAttachEvent=\"onmousedown:_onClkDecBumper\"></div\n\t\t></td\n\t\t><td class=\"dijitReset\"\n\t\t\t><input dojoAttachPoint=\"valueNode\" type=\"hidden\" ${!nameAttrSetting}\n\t\t\t/><div role=\"presentation\" class=\"dojoxRangeSliderBarContainer\" dojoAttachPoint=\"sliderBarContainer\"\n\t\t\t\t><div dojoAttachPoint=\"sliderHandle\" tabIndex=\"${tabIndex}\" class=\"dijitSliderMoveable dijitSliderMoveableH\" dojoAttachEvent=\"onmousedown:_onHandleClick\" role=\"slider\"\n\t\t\t\t\t><div class=\"dijitSliderImageHandle dijitSliderImageHandleH\"></div\n\t\t\t\t></div\n\t\t\t\t><div role=\"presentation\" dojoAttachPoint=\"progressBar,focusNode\" class=\"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH\" dojoAttachEvent=\"onmousedown:_onBarClick\"></div\n\t\t\t\t><div dojoAttachPoint=\"sliderHandleMax\" tabIndex=\"${tabIndex}\" class=\"dijitSliderMoveable dijitSliderMoveableH\" dojoAttachEvent=\"onmousedown:_onHandleClickMax\" role=\"slider\"\n\t\t\t\t\t><div class=\"dijitSliderImageHandle dijitSliderImageHandleH\"></div\n\t\t\t\t></div\n\t\t\t\t><div role=\"presentation\" dojoAttachPoint=\"remainingBar\" class=\"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH\" dojoAttachEvent=\"onmousedown:_onRemainingBarClick\"></div\n\t\t\t></div\n\t\t></td\n\t\t><td class=\"dijitReset\"\n\t\t\t><div class=\"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper\" dojoAttachEvent=\"onmousedown:_onClkIncBumper\"></div\n\t\t></td\n\t\t><td class=\"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH\"\n\t\t\t><div class=\"dijitSliderIncrementIconH\" tabIndex=\"-1\" style=\"display:none\" dojoAttachPoint=\"incrementButton\"><span class=\"dijitSliderButtonInner\">+</span></div\n\t\t></td\n\t></tr\n\t><tr class=\"dijitReset\"\n\t\t><td class=\"dijitReset\" colspan=\"2\"></td\n\t\t><td dojoAttachPoint=\"containerNode,bottomDecoration\" class=\"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH\"></td\n\t\t><td class=\"dijitReset\" colspan=\"2\"></td\n\t></tr\n></table>\n","url:esri/dijit/templates/HistogramTimeSlider.html":"<div class=\"esriTimeSlider esriHistogramTimeSlider\">\r\n   <div id=\"temporal\" class=\"bottom_overlay\" style=\"height:189px\">\r\n      <div id='temporal_controls'>\r\n        <div id=\"focusControls\" class=\"header\">\r\n        <button class=\"play\" id=\"play\" data-dojo-attach-point=\"playButton\">\r\n          <div id=\"playInternal\" class=\"play-mode\"></div>\r\n          <h1 id=\"temporalTitle\" class=\"play temporal-title\" style=\"margin-top:-1px\">PLAY</h1>\r\n        </button>\r\n        <!--<h1 id=\"temporalTitle\" class=\"play\" style=\"\"><button dojoType=\"dijit.form.Button\" showLabel=\"false\" iconClass=\"tsButton tsPlayButton\" dojoAttachEvent=\"onClick:_onPlay\" dojoAttachPoint=\"playPauseBtn\" type=\"button\">${NLS_play}</button></h1>-->\r\n        <div id=\"playModeChooser\" class=\"fg-buttonset fg-buttonset-single\">\r\n          <button id=\"rangeMode\" class=\"range-mode fg-button ui-state-default ui-priority-primary ui-corner-left ui-state-active\" value=\"range\" data-dojo-attach-point=\"rangeMode\">range</button>\r\n          <button id=\"cumulativeMode\"class=\"cumulative-mode fg-button ui-state-default ui-priority-primary ui-corner-right\" value=\"cumulative\" data-dojo-attach-point=\"cumulativeMode\">cumulative</button>\r\n          </div>\r\n        <div class=\"focus-range\" id=\"focusRange\" data-dojo-attach-point=\"focusRange\"></div>\r\n      </div>\r\n       <div id=\"chartsContainer\">\r\n          <div id=\"focusContainer\">\r\n          <div id=\"pageHolder_left\">\r\n            <button class=\"pg-left\" id=\"page_left\" data-dojo-attach-point=\"pageLeft\"></button>\r\n          </div>\r\n          <div id=\"focusChartHolder\" class=\"focusChart\" data-dojo-attach-point=\"focusChart\">\r\n            <div class=\"focus-annotation\" id=\"focusAnnotation\" data-dojo-attach-point=\"focusAnnotation\"></div>\r\n            <div class=\"focus\" id=\"focus\" data-dojo-attach-point=\"focus\"></div>\r\n            <div id=\"resolutionChooser\" class=\"res-chooser fg-buttonset fg-buttonset-single\" data-dojo-attach-point=\"resChooser\">\r\n              <button id=\"esriTimeUnitsSeconds\" class=\"fg-button ui-state-default ui-priority-primary ui-corner-left\" value=\"second\">sec</button>\r\n              <button id=\"esriTimeUnitsMinutes\" class=\"fg-button ui-state-default ui-priority-primary\" value=\"minute\">min</button>\r\n              <button id=\"esriTimeUnitsHours\" class=\"fg-button ui-state-default ui-priority-primary\" value=\"hour\">hh</button>\r\n              <button id=\"esriTimeUnitsDays\" class=\"fg-button ui-state-default ui-priority-primary\" value=\"day\">dd</button>\r\n              <button id=\"esriTimeUnitsMonths\" class=\"fg-button ui-state-default ui-priority-primary\" value=\"month\">mm</button>\r\n              <button id=\"esriTimeUnitsYears\" class=\"fg-button ui-state-default ui-priority-primary ui-corner-right\" value=\"year\">yy</button>\r\n            </div>\r\n            <div id=\"focusTip\"></div>\r\n          </div>\r\n          <div id=\"pageHolder_right\" >\r\n            <button class=\"pg-right\" id=\"page_right\" data-dojo-attach-point=\"pageRight\"></button>\r\n          </div>\r\n        </div>\r\n        <div class=\"overview-container\" id=\"overviewContainer\" data-dojo-attach-point=\"overviewContainer\">\r\n          <div id=\"overviews\">\r\n            <div class=\"overview-annotation\" id=\"overviewAnnotation\" data-dojo-attach-point=\"overviewAnnotation\"></div>\r\n            <div class=\"overview\" id=\"overview\" data-dojo-attach-point=\"overview\"></div>\r\n            <div class=\"overview-blockers\" id=\"overviewBlockers\" data-dojo-attach-point=\"overviewBlockers\"></div>\r\n            <div class=\"overview-slider\" id=\"overviewSlider\" data-dojo-attach-point=\"overviewSlider\"></div>\r\n          </div>\r\n        </div>\r\n        <div id=\"overviewControls\">\r\n          <!--<button id=\"hideOverview\" class=\"hide\"></button>-->\r\n          <h1 id=\"overviewTitle\">OVERVIEW</h1>\r\n          <p id=\"overviewRange\">(full range: <span class=\"overview-range-span\" id=\"overviewRangeSpan\" data-dojo-attach-point=\"overviewRangeSpan\"></span>)</p>\r\n        </div>\r\n        </div>\r\n    </div>\r\n   </div>\r\n</div>\r\n"}});define("esri/dijit/HistogramTimeSlider",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/array","dojo/has","dojo/query","dojo/dom","dojo/_base/html","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dojo/require","dojox/gfx","dojox/gfx/fx","dijit/_WidgetBase","dijit/_TemplatedMixin","dojox/form/RangeSlider","dojo/text!dojox/form/resources/HorizontalRangeSlider.html","dijit/form/HorizontalSlider","dijit/form/HorizontalRuleLabels","dijit/form/HorizontalRule","dojox/timing/_base","dojo/on","dojo/text!esri/dijit/templates/HistogramTimeSlider.html","esri/kernel","esri/lang","esri/TimeExtent","dojo/i18n!esri/nls/jsapi"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,fx,_f,_10,_11,_12,_13,_14,_15,_16,on,_17,_18,_19,_1a,_1b){var _1c=_1([_f,_10],{declaredClass:"esri.dijit.HistogramTimeSlider",widgetsInTemplate:false,templateString:_17,constructor:function(_1d,_1e){_2.mixin(this,_1b.widgets.HistogramTimeSlider);this.layer=_1d.layer;this.element=_1e;this._iconClass="tsButton tsPlayButton";this.playing=false;this.loop=false;this.thumbCount=2;this.thumbMovingRate=300;this._createTimeInstants=false;this._options=_2.mixin({excludeDataAtTrailingThumb:false,excludeDataAtLeadingThumb:false},_1d.options||{});},startup:function(){var _1f=this;this.inherited(arguments);this._timer=new _16.Timer();this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=_2.hitch(this,"_bumpSlider",1);var _20=_3.connect(this.layer,"onUpdateEnd",function(){_1f._calculateBins();_3.disconnect(_20);});},options:{showingOverview:true,maxOverviewBins:500,maxFocusBins:500,stepPercentage:0.015,playInterval:300,allowOverview:true,playMode:"range"},_resolutions:{"esriTimeUnitsSeconds":1000,"esriTimeUnitsMinutes":1000*60,"esriTimeUnitsHours":1000*60*60,"esriTimeUnitsDays":1000*60*60*24,"esriTimeUnitsMonths":1000*60*60*24*30,"esriTimeUnitsYears":1000*60*60*24*365},initSlider:function(){this._setStyles();_6(".esriHistogramTimeSlider")[0].style.display="block";this.isRegistered=true;this._createSlider();this._wire();this._isPlaying=false;this._isDragging=false;this._bins={};this._maxCounts={};this._resolutionDirty=true;this._timespanDirty=true;this._initCharts();this.loaded=false;this.overviewTimespan={};this._onTemporalReady();},destroy:function(){this._timer.stop();this._timer=null;this.timeStops=null;this._slider.destroy();this._slider=null;if(this._hTicks){this._hTicks.destroyRecursive();this._hTicks=null;}if(this._hLabels){this._hLabels.destroyRecursive();this._hLabels=null;}this.inherited(arguments);},_wire:function(){dojo.NodeList.prototype.hover=function(_21,out){return this.onmouseenter(_21).onmouseleave(out||_21);};on(this.playButton,"click",_2.hitch(this,this._onPlay));on(this.pageRight,"click",_2.hitch(this,this._onNext));on(this.pageLeft,"click",_2.hitch(this,this._onPrev));on(this.rangeMode,"click",_2.hitch(this,function(_22){this.setPlayMode(_22.target.value);}));on(this.cumulativeMode,"click",_2.hitch(this,function(_23){this.setPlayMode(_23.target.value);}));on(this.resChooser,"click",_2.hitch(this,function(_24){if(_9.contains(_24.target,"ui-state-disabled")){return;}_4.forEach(this.focusBarSets[this.focusResolution],function(f,i){f.removeShape();});this.focusResolution=_24.target.id;this._resolutionDirty=true;this._calculateBins(this.focusResolution);this._addBins(this.bins,this.focusResolution);this._updateFocusChart();var _25=_6(".ui-state-active",this.resChooser)[0];_9.remove(_25,"ui-state-active");var btn=_6("#"+this.focusResolution,this.resChooser)[0];_9.add(btn,"ui-state-active");}));_6(this.resChooser)[0].style.display="none";_3.connect(this.focusChart,"onmouseenter",_2.hitch(this,function(e){_6(this.resChooser)[0].style.display="block";}));_3.connect(this.focusChart,"onmouseleave",_2.hitch(this,function(e){_6(this.resChooser)[0].style.display="none";}));this._windowRS=null;_3.connect(window,"resize",this,function(){if(this._windowRS!=null){clearTimeout(this._windowRS);}this._windowRS=setTimeout(_2.hitch(this,function(){this.refresh();},500));});},refresh:function(_26){this._calculateBins(this.focusResolution);this._setStyles();this._initCharts(true);this._onTemporalReady();},_setStyles:function(){var _27=_7.byId(this.element.id).parentNode;var _28=_8.style(_27,"width");_b.set("focusChartHolder","width",_28-50+"px");_b.set("overviewContainer","width",_28-60+"px");_b.set(this.overviewAnnotation,"width",_28-50+"px");_b.set(this.focusAnnotation,"width",_28-50+"px");_b.set(this.overviewSlider,"width",_28-50+"px");_b.set(this.focus,"width",_28-50+"px");_b.set(this.overview,"width",_28-50+"px");_b.set(this.overviewBlockers,"width",_28-50+"px");},_calculateBins:function(res){this.features=this.features||this.layer.graphics;this.timefield=this.timefield||this.layer._startTimeField;this.bins=[];if(!res){res=this.layer.timeInfo.timeIntervalUnits;}var _29=this.fullTimeExtent;if(!_29){this._setTimeExtent(res);}else{this.createTimeStopsByTimeInterval(_29,1,res);}var _2a=[];var _2b=[];for(i=0;i<this.timeStops.length-1;i++){_2a[i]=this.timeStops[i].getTime();this.bins.push({"count":0,"timestamp":this.timeStops[i],"utc":_2a[i]});}var _2c=_2a[0];for(var i=0;i<this.features.length;i++){var _2d=this.features[i].attributes[this.timefield];for(var j=0;j<=_2a.length;j++){var val=this.bins[j-1]?j-1:j;if(j!=_2a.length-1){if(_2d>=_2c&&_2d<=_2a[j]){this.bins[val].count++;}}else{if(_2d>=_2c&&_2d<=_2a[j]){this.bins[val].count++;}}if(j==_2a.length){if(_2d>=_2a[_2a.length]){this.bins[val].count++;}}_2c=_2a[j];}}if(!this.isRegistered){this.initSlider();}},_setTimeExtent:function(res){var _2e=this.features;var _2f=[];_4.forEach(_2e,_2.hitch(this,function(_30,i){var val=_30.attributes[this.timefield];_2f.push(val);if(i==_2e.length-1){var min=Math.min.apply(null,_2f);var max=Math.max.apply(null,_2f);var _31=new _1a();_31.startTime=min;_31.endTime=max;this.createTimeStopsByTimeInterval(_31,1,res);}}));},_onTemporalReady:function(){var _32=this.bins;var res=this._timeIntervalUnits;this.overviewResolution=res;this.overviewTimespan.min=_32[0].utc;this.overviewTimespan.max=_32[_32.length-1].utc;this.focusTimespan=this._getInitialFocusTimespan();_6(this.overviewRangeSpan)[0].innerHTML=this._getSingleDateText(_32[0].timestamp,res)+" - "+this._getSingleDateText(_32[_32.length-1].timestamp,res);this._onHorizontalChange();this._addBins(_32,res);this._drawOverview();this._updateChartAnnotation(this.overviewAnnotationCanvas,this.overviewTimespan,5,"#DDD");this._updateFocusIndicators();this.focusResolution=res;this._timespanDirty=true;this._updateFocusRepresentations(true);_6("#resolutionChooser button#"+this.focusResolution).addClass("ui-state-active");},setPlayMode:function(_33){this._playMode=_33;if(_33=="range"){_9.add(this.rangeMode,"ui-state-active");_9.remove(this.cumulativeMode,"ui-state-active");this.thumbCount=2;this._createSlider();}else{_9.add(this.cumulativeMode,"ui-state-active");_9.remove(this.rangeMode,"ui-state-active");this.thumbCount=1;this._createSlider();}},_initCharts:function(_34){if(this.overviewAnnotationCanvas){this.focusAnnotationCanvas.destroy();this.focusCanvas.destroy();this.overviewCanvas.destroy();this.overviewAnnotationCanvas.destroy();this.obscuringCanvas.destroy();}this.overviewBars=[];this.highlightBars=[];this.obscuringBars=[];var _35=_6(this.overviewAnnotation)[0];this.overviewAnnotationCanvas=_e.createSurface(_35,_6(this.overviewAnnotation)[0].offsetWidth,_6(this.overviewAnnotation)[0].offsetHeight);var _36=_6(this.focus)[0];this.focusCanvas=_e.createSurface(_36,_6(this.focus)[0].offsetWidth,_6(this.focus)[0].offsetHeight);var _37=_6(this.focusAnnotation)[0];this.focusAnnotationCanvas=_e.createSurface(_37,_6(this.focusAnnotation)[0].offsetWidth,_6(this.focusAnnotation)[0].offsetHeight);var _38=_6(this.overview)[0];this.overviewCanvas=_e.createSurface(_38,_6(this.overview)[0].offsetWidth,_6(this.overview)[0].offsetHeight);var _39=_6(this.overviewBlockers)[0];this.obscuringCanvas=_e.createSurface(_39,_6(this.overviewBlockers)[0].offsetWidth,_6(this.overviewBlockers)[0].offsetHeight);this.obscuringBars.push(this.obscuringCanvas.createRect({x:-1,y:0,width:10,height:_6(this.overview)[0].offsetHeight}),this.obscuringCanvas.createRect({x:300,y:0,width:10,height:_6(this.overview)[0].offsetHeight}));this.obscuringBars.push(this.obscuringCanvas.createRect({x:0,y:_6(this.overview)[0].offsetHeight-1,width:10,height:10}));_4.forEach(this.obscuringBars,function(f,i){f.setFill([236,236,236,0.8]);f.setStroke("#666");});if(!_34){this.focusBarSets={};}},_next_resolution:function(_3a){var _3b=false;var _3c;for(i=0;i<this._resolutions;i++){_3c=this._resolutions[i];if(_3b){return false;}if(_3a==this._resolutions[i]){_3b=true;}}return _3c;},_prev_resolution:function(_3d){var _3e;for(i=0;i<this._resolutions;i++){if(_3d==this._resolutions[i]){return false;}_3e=this._resolutions[i];}return _3e;},_addBins:function(_3f,_40){var _41=[],ms=this._resolutions[_40],_42=this.fullTimeExtent.startTime,max=-999,ind=0;for(var i=0;i<_3f.length;i++){if(_3f[i].count>max){max=_3f[i].count;}_3f[i].utc=_3f[i].timestamp.getTime();ind=Math.round((_3f[i].utc-_42)/ms);_41.push(_3f[i]);}this._bins[_40]=_41;this._maxCounts[_40]=max;},_drawOverview:function(_43){this.dateLines=[];var _44=this._bins[this.overviewResolution],_45=this.overviewTimespan.max-this.overviewTimespan.min,_46=this._maxCounts[this.overviewResolution],_47=this._resolutions[this.overviewResolution],_48=Math.ceil(_45/_47),_49=(_47*this.overviewCanvas._parent.clientWidth)/_45+0.5,gap=_49/5,bin,x,y,h;for(var i=0;i<_44.length;i++){bin=_44[i];if(!bin){continue;}x=(bin.timestamp.getTime()-this.overviewTimespan.min)/_45*this.overviewCanvas._parent.clientWidth;h=(this.overviewCanvas._parent.clientHeight-5)*bin.count/_46;y=this.overviewCanvas._parent.clientHeight-h;this.dateLines.push(x);var bar=this.overviewCanvas.createRect({x:x,y:y,width:_49-gap,height:h});this.overviewBars.push(bar);bar=this.overviewCanvas.createRect({x:x,y:y,width:_49-gap,height:h});this.highlightBars.push(bar);}_4.forEach(this.overviewBars,function(f,i){f.setFill("#ddd");f.setStroke("none");});_4.forEach(this.highlightBars,function(f,i){f.setFill("#084594");f.setStroke("none");});},_getInitialFocusTimespan:function(){var max=this.overviewTimespan.min+(0.075*(this.overviewTimespan.max-this.overviewTimespan.min));return {min:this.overviewTimespan.min,max:max};},_updateFocusIndicators:function(){if(!this.focusTimespan){return;}var _4a=this.getCurrentTimeExtent();var min=_4a.startTime.getTime(),max=_4a.endTime.getTime();this.focusTimespan.min=min;this.focusTimespan.max=max;this._updateFocusHighlight();this._updateFocusDateRangeText();},_updateFocusRepresentations:function(_4b){if(!this.focusResolution){return;}if(_4b){this._checkCurrentFocusResolution();this._updateFocusResolutions();}this._updateFocusChart();this._updateChartAnnotation(this.focusAnnotationCanvas,this.focusTimespan,10);},_checkCurrentFocusResolution:function(){var _4c=(this.focusTimespan.max-this.focusTimespan.min)/this._resolutions[this.focusResolution];if(_4c<1){if(this.focusBarSets[this.focusResolution]){this.focusBarSets[this.focusResolution].hide();}while(_4c<1){this.focusResolution=this._prev_resolution(this.focusResolution);_4c=(this.focusTimespan.max-this.focusTimespan.min)/this._resolutions[this.focusResolution];}this._resolutionDirty=true;}else{if(_4c>this.options.maxFocusBins){if(this.focusBarSets[this.focusResolution]){this.focusBarSets[this.focusResolution].hide();}while(_4c>this.options.maxFocusBins){this.focusResolution=this._next_resolution(this.focusResolution);_4c=(this.focusTimespan.max-this.focusTimespan.min)/this._resolutions[this.focusResolution];}this._resolutionDirty=true;}else{return;}}},_updateFocusDateRangeText:function(){if(!this.focusTimespan){return;}var _4d=this._getDateRangeText(this.focusTimespan,false);_6(this.focusRange)[0].innerHTML=_4d;},_getDateRangeText:function(_4e,_4f){var _50=new Date(_4e.min),_51=new Date(_4e.max),_52=_4e.max-_4e.min;var _53=this._getDateText(_50,_4e,_4f);_53+=" to ";_53+=this._getDateText(_51,_4e,_4f);if(_52<(0.25*this._resolutions["month"])){_53+=" GMT";}return _53;},_updateFocusHighlight:function(){var x,_54,_55,_56;x=(this.focusTimespan.min-this.overviewTimespan.min)/(this.overviewTimespan.max-this.overviewTimespan.min)*this.overviewCanvas._parent.clientWidth;_54=(this.focusTimespan.max-this.focusTimespan.min)/(this.overviewTimespan.max-this.overviewTimespan.min)*this.overviewCanvas._parent.clientWidth;var _57=(x+_54<=700)?x+_54:700;var _58=_6(this.overviewContainer)[0];_58=_8.coords(_58).x-7;_55=_6(".dijitSliderImageHandleH",_7.byId(this.element.id))[0];var _59=_c.position(_55).x;var min=_59-_58;if(this.thumbCount==2){_56=_6(".dijitSliderImageHandleH",_7.byId(this.element.id))[1];var _5a=_c.position(_56).x||0;var max=_5a-_58||0;}else{_5a=_c.position(_55).x;max=_5a-_58;min=0;_59=0;}this.obscuringBars[0].setShape({"width":min});this.obscuringBars[1].setShape({"x":max,"width":(this.overviewCanvas._parent.clientWidth)-(max)});this.obscuringBars[2].setShape({"x":x,"width":_54});},_getSingleDateText:function(_5b,_5c){var _5d="";if(_5c=="esriTimeUnitsDays"){_5d+=_5b.toDateString().split(" ")[0]+" ";}if(_5c=="esriTimeUnitsMonths"||_5c=="esriTimeUnitsDays"){_5d+=_5b.getMonth()+1+"/";}if(_5c=="esriTimeUnitsDays"){_5d+=_5b.getDate()+"/";}if(_5c=="esriTimeUnitsDays"||_5c=="esriTimeUnitsMonths"||_5c=="esriTimeUnitsYears"){_5d+=_5b.getFullYear();}if(_5c=="esriTimeUnitsHours"||_5c=="esriTimeUnitsMinutes"||_5c=="esriTimeUnitsSeconds"){_5d+=_5b.toTimeString().substr(0,5);}if(_5c=="esriTimeUnitsSeconds"){_5d+=_5b.toTimeString().substr(5,3);}return _5d;},_getDateText:function(_5e,_5f,_60){var _61=new Date(_5f.min);var _62=new Date(_5f.max);var _63=_60?"<a href=\"\">":"";_63+="<span class=\"dateText\">";var _64=(_5e.getTime()==_5f.min);var _65=_5f.max-_5f.min;if(_65<this._resolutions["esriTimeUnitsMonths"]&&(_64||(_65>this._resolutions["esriTimeUnitsDays"]||(_61.getDate()!=_62.getDate())))){_63+=_5e.toDateString().split(" ")[0]+" ";}if(_65<(10*this._resolutions["esriTimeUnitsYears"])&&(_64||(_65>this._resolutions["esriTimeUnitsDays"]||(_61.getDate()!=_62.getDate())))){_63+=_5e.getMonth()+1+"/"+_5e.getDate()+"/";}if(_64||(_65>this._resolutions["esriTimeUnitsDays"]||(_61.getDate()!=_62.getDate()))){_63+=_5e.getFullYear();}var _66=(_65<(0.25*this._resolutions["esriTimeUnitsMonths"]));if(_66){if(_64||_65>this._resolutions["esriTimeUnitsDays"]||(_61.getDate()!=_62.getDate())){_63+=" at ";}_63+=_5e.toTimeString().substr(0,5);if(_65<(0.25*this._resolutions["esriTimeUnitsHours"])){_63+=_5e.toTimeString().substr(5,3);}}_63+="</span>";if(_60){_63+="</a>";}return _63;},hideTipForFocusBin:function(){_7.byId("focusTip").style.display="none";},showTipForFocusBin:function(bin){_7.byId("focusTip").innerHTML=(this._getSingleDateText(bin.timestamp,this.focusResolution)+": "+bin.count+" features");_7.byId("focusTip").style.display="block";var x=(bin.utc-this.focusTimespan.min)/(this.focusTimespan.max-this.focusTimespan.min)*this.focusCanvas._parent.clientWidth;x+=0.5*(this._resolutions[this.focusResolution]/(this.focusTimespan.max-this.focusTimespan.min)*this.focusCanvas._parent.clientWidth);x=Math.min(this.focusCanvas._parent.clientWidth-_7.byId("focusTip").offsetWidth,x);x=Math.max(1,x);var _67=this._maxCounts[this.focusResolution];var h=this.focusCanvas._parent.clientHeight*bin.count/_67;var y=this.focusCanvas._parent.clientHeight-h-_7.byId("focusTip").offsetHeight-15;y=Math.max(1,y);var _68=_7.byId("focusTip");_8.style(_68,{"left":x+"px","top":y+"px"});},_updateFocusResolutions:function(){var _69=this;for(var res in this._resolutions){var _6a=(_69.focusTimespan.max-_69.focusTimespan.min)/this._resolutions[res];var _6b=_6("#resolutionChooser button#"+res);if(_6a<1||_6a>_69.options.maxFocusBins){_6b.addClass("ui-state-disabled");}else{_6b.removeClass("ui-state-disabled");}}},_updateChartAnnotation:function(_6c,_6d,_6e,_6f){if(!_6e){_6e=10;}if(!_6f){_6f="#ddd";}_6c.clear();var res=this._timeIntervalUnits;var _70=_6d.max-_6d.min;while((_70/2)<this._resolutions[res]){res=this._prev_resolution(res);if(!res){break;}}var num=_70/this._resolutions[res];var _71,_72;var _73=new Date(_6d.min);var _74;if(!res){res="esriTimeUnitsHours";}switch(res){case "esriTimeUnitsSeconds":if(num<_6e){_74=new Date(_73.getFullYear(),_73.getMonth(),_73.getDate(),_73.getHours(),_73.getMinutes(),_73.getSeconds());}else{_71=[2,5,10,15,30];}break;case "esriTimeUnitsMinutes":if(num<_6e){_74=new Date(_73.getFullYear(),_73.getMonth(),_73.getDate(),_73.getHours(),_73.getMinutes());}else{_71=[2,5,10,15,30];}break;case "esriTimeUnitsHours":if(num<_6e){_74=new Date(_73.getFullYear(),_73.getMonth(),_73.getDate(),_73.getHours());}else{_71=[2,6,12];}break;case "esriTimeUnitsDays":if(num<_6e){_74=new Date(_73.getFullYear(),_73.getMonth(),_73.getDate());}else{_71=[2,7];}break;case "esriTimeUnitsMonths":if(num<_6e){_74=new Date(_73.getFullYear(),_73.getMonth());}else{_71=[2,6];}break;case "esriTimeUnitsYears":_74=new Date();if(num<_6e){_74.setYear(_73.getFullYear());}else{_71=[2,5,10,20,25,50,100];}break;}if(num<_6e){_72=this._resolutions[res];}else{for(var i=0;i<_71.length;i++){if((_70/(this._resolutions[res]*_71[i]))<_6e){break;}}switch(res){case "esriTimeUnitsSeconds":_74=new Date(_73.getFullYear(),_73.getMonth(),_73.getDate(),_73.getHours(),_73.getMinutes(),Math.floor(_73.getSeconds()/_71[i])*_71[i]);break;case "esriTimeUnitsMinutes":_74=new Date(_73.getFullYear(),_73.getMonth(),_73.getDate(),_73.getHours(),Math.floor(_73.getMinutes()/_71[i])*_71[i]);break;case "esriTimeUnitsHours":_74=new Date(_73.getFullYear(),_73.getMonth(),_73.getDate(),Math.floor(_73.getHours()/_71[i])*_71[i]);break;case "esriTimeUnitsDays":_74=new Date(_73.getFullYear(),_73.getMonth(),Math.floor(_73.getDate()/_71[i])*_71[i]);break;case "esriTimeUnitsMonths":_74=new Date(_73.getFullYear(),Math.floor(_73.getMonth()/_71[i])*_71[i]);break;case "esriTimeUnitsYears":_74.setYear(Math.floor(_73.getFullYear()/_71[i])*_71[i]);break;}_72=this._resolutions[res]*_71[i];}var _75=_74.getTime();var x,_76,_77;while(_75<_6d.max){x=(_75-_6d.min)/_70*_6c._parent.clientWidth;if(!isFinite(x)){return;}_6c.createLine({x1:x,y1:0,x2:x,y2:_6c._parent.clientHeight}).setStroke(_6f);_77=new Date(_75);_76=((res=="esriTimeUnitsMonths"||res=="esriTimeUnitsDays")?(_77.getMonth()+1+"/"+_77.getDate()+"/"):"")+((res=="esriTimeUnitsMonths"||res=="esriTimeUnitsDays"||res=="esriTimeUnitsYears")?_77.getFullYear():"")+((res=="esriTimeUnitsHours"||res=="esriTimeUnitsMinutes"||res=="esriTimeUnitsSeconds")?(" "+_77.toTimeString().substr(0,5)):"")+((res=="esriTimeUnitsSeconds")?(":"+_77.getSeconds()):"");_6c.createText({x:x+5,y:15,text:_76}).setFont({size:"12px"}).setFill(_6f);_75+=_72;}},_updateFocusChart:function(){var _78=this;if(this._resolutionDirty){if(!this.focusBarSets[this.focusResolution]){this.focusBarSets[this.focusResolution]=[];}else{_4.forEach(this.focusBarSets[this.focusResolution],function(f,i){f.removeShape();});}this._timespanDirty=true;this._resolutionDirty=false;}if(this._timespanDirty){var _79=this._bins[this.focusResolution];var _7a=this.overviewTimespan.max-this.overviewTimespan.min;var _7b=this.focusTimespan.max-this.focusTimespan.min;var res=this._resolutions[this.focusResolution];var _7c=this._maxCounts[this.focusResolution];var _7d=Math.max(1,this.focusCanvas._parent.clientWidth/(_7b/res));_7d=(_7d<=700)?_7d:700;var gap=Math.min(5,Math.floor(_7d/5));var _7e=Math.floor((this.focusTimespan.min-this.overviewTimespan.min)/res);var _7f=Math.ceil((this.focusTimespan.max-this.overviewTimespan.min)/res);_7e=0;_7f=_79.length;var bin,x,y,h;if(_79){for(var i=_7e;i<_7f;i++){bin=_79[i];if(!bin){continue;}if(_7b==0){_7b=1;}x=(bin.utc-this.focusTimespan.min)/_7b*this.focusCanvas._parent.clientWidth;if(bin.bar&&!this._attributeDirty){bin.bar.setShape({"x":x,"width":_7d-gap});}else{h=this.focusCanvas._parent.clientHeight*bin.count/_7c;y=this.focusCanvas._parent.clientHeight-h;bin.bar=this.focusCanvas.createRect({x:x,y:y,width:_7d-gap,height:h}).setFill("#084594").setStroke("none");bin.bar.bin=bin;bin.bar.connect("onmouseenter",bin.bar,function(){_78.showTipForFocusBin(this.bin);fx.animateFill({shape:this,duration:500,color:{end:"#708090"}}).play();});bin.bar.connect("onmouseleave",bin.bar,function(){_78.hideTipForFocusBin();fx.animateFill({shape:this,duration:500,color:{end:"#084594"}}).play();});this.focusBarSets[this.focusResolution].push(bin.bar);}}this._timespanDirty=false;this._attributeDirty=false;}}},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var _80=this._sliderToTimeExtent();this.onTimeExtentChange(_80);this._timespanDirty=true;this._updateFocusRepresentations();this._updateFocusIndicators();},_onPlay:function(){this.playing=!this.playing;this._updateUI();if(this.playing){this._timer.start();this.onPlay(this._sliderToTimeExtent());this._updateFocusIndicators();this._timespanDirty=true;this._updateFocusRepresentations();}else{this._timer.stop();this.onPause(this._sliderToTimeExtent());this._updateFocusIndicators();this._timespanDirty=true;this._updateFocusRepresentations();}var val=this._getSliderValue();this._offset=_2.isArray(val)?(val[1]-val[0]):0;},_onNext:function(){if(!this.playing){this._bumpSlider(1);this.onNext(this._sliderToTimeExtent());this._timespanDirty=true;this._updateFocusRepresentations();this._updateFocusIndicators();}},_onPrev:function(){if(!this.playing){this._bumpSlider(-1);this.onPrevious(this._sliderToTimeExtent());this._timespanDirty=true;this._updateFocusRepresentations();this._updateFocusIndicators();}},createTimeStopsByCount:function(_81,_82){if(!_81||!_81.startTime||!_81.endTime){console.log(this.NLS_invalidTimeExtent);return;}_82=_82||this._defaultCount;var _83=Math.ceil((_81.endTime-_81.startTime)/(_82-1));this.createTimeStopsByTimeInterval(_81,_83,"esriTimeUnitsMilliseconds");},createTimeStopsByTimeInterval:function(_84,_85,_86,_87){if(!_84||!_84.startTime||!_84.endTime){console.log(this.NLS_invalidTimeExtent);return;}this.fullTimeExtent=new _1a(new Date(_84.startTime),new Date(_84.endTime));if(_87&&_87.resetStartTime===true){this._resetStartTime(this.fullTimeExtent,_86);}this._timeIntervalUnits=_86;var te=this.fullTimeExtent.startTime;var _88=[];while(te<=_84.endTime){_88.push(te);te=_84._getOffsettedDate(te,_85,_86);}if(_88.length>0&&_88[_88.length-1]<_84.endTime){_88.push(te);}this.setTimeStops(_88);},getCurrentTimeExtent:function(){return this._sliderToTimeExtent();},setTimeStops:function(_89){this.timeStops=_89||[];this._numStops=this.timeStops.length;this._numTicks=this._numStops;if(_19.isDefined(this.fullTimeExtent)===false){this.fullTimeExtent=new _1a(_89[0],_89[_89.length-1]);}},setLoop:function(_8a){this.loop=_8a;},setThumbCount:function(_8b){this.thumbCount=_8b;this.singleThumbAsTimeInstant(this._createTimeInstants);if(this._slider){this._createSlider();}},setThumbIndexes:function(_8c){this.thumbIndexes=_2.clone(_8c)||[0,3];this._initializeThumbs();},setThumbMovingRate:function(_8d){this.thumbMovingRate=_8d;if(this._timer){this._timer.setInterval(this.thumbMovingRate);}},setLabels:function(_8e){this.labels=_8e;if(this._slider){this._createSlider();}},setTickCount:function(_8f){this._numTicks=_8f;if(this._slider){this._createSlider();}},singleThumbAsTimeInstant:function(_90){this._createTimeInstants=(_90&&this.thumbCount===1);},next:function(){this._onNext();},pause:function(){this.playing=false;this._updateUI();this._updateFocusIndicators();this._timer.stop();},play:function(){if(this.playing===true){return;}this.playing=false;this._onPlay();},previous:function(){this._onPrev();},_updateUI:function(){if(this.playing){var p=_6(".play-mode",this.playButton)[0];_9.add(p,"pause");_6(".temporal-title",this.playButton)[0].innerHTML="PAUSE";}else{var p=_6(".play-mode",this.playButton)[0];_9.remove(p,"pause");_6(".temporal-title",this.playButton)[0].innerHTML="PLAY";}},_createSlider:function(){if(this._slider){this._slider.destroy();this._slider=null;}var _91=this.domNode;while(_91.parentNode&&!_91.dir){_91=_91.parentNode;}var _92={onChange:_2.hitch(this,"_onHorizontalChange"),showButtons:false,discreteValues:this._numStops-1,intermediateChanges:"true",slideDuration:this._slideDuration,"class":"ts",id:this.element.id+"_ts",dir:_91.dir};var _93=this.overviewSlider;var ts=_a.create("div",{id:this.element.id+"_ts"},_93,"first");_a.create("div",{id:"timeSliderTicks"},ts,"first");_a.create("div",{id:"timeSliderLabels"},ts);if(this.thumbCount===2){this._createRangeSlider(_92);}else{this._createSingleSlider(_92);}this.thumbIndexes=this.thumbIndexes||[0,3];this._createHorizRule();this._createLabels();if(this._createTimeInstants===true){_6(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper").forEach("html.style(item, { background: 'none' });");}this._initializeThumbs();_3.disconnect(this._onChangeConnect);this._onChangeConnect=_3.connect(this._slider,"onChange",_2.hitch(this,"_updateThumbIndexes"));},_createRangeSlider:function(_94){this._isRangeSlider=true;var _95=_1([_13,_11],{templateString:_12});this._slider=new _95(_94,_7.byId(this.element.id+"_ts"));},_createSingleSlider:function(_96){this._isRangeSlider=false;this._slider=new _13(_96,_7.byId(this.element.id+"_ts"));},_createHorizRule:function(){if(this._hTicks){this._hTicks.destroyRecursive();this._hTicks=null;}if(this._numTicks<2){return;}this._hTicks=new _15({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks,id:this.element.id+"_tsTicks"},_7.byId("timeSliderTicks"));},_createLabels:function(){if(this._hLabels){this._hLabels.destroyRecursive();this._hLabels=null;}if(this.labels&&this.labels.length>0){this._hLabels=new _14({labels:this.labels,labelStyle:"","class":"tsLabels",id:this.element.id+"_tsLabels"},_7.byId("timeSliderLabels"));}},_initializeThumbs:function(){if(!this._slider){return;}this._offset=this._toSliderValue(this.thumbIndexes[1])||0;var t1=this._toSliderValue(this.thumbIndexes[0]);t1=(t1>this._slider.maximum||t1<this._slider.minimum)?this._slider.minimum:t1;if(this._isRangeSlider===true){var t2=this._toSliderValue(this.thumbIndexes[1]);t2=(t2>this._slider.maximum||t2<this._slider.minimum)?this._slider.maximum:t2;t2=t2<t1?t1:t2;this._setSliderValue([t1,t2]);}else{this._setSliderValue(t1);}},_bumpSlider:function(dir){var val=this._getSliderValue();var max=val,min=max;var _97=dir;if(_2.isArray(val)){min=val[0];max=val[1];_97=[{"change":dir,"useMaxValue":true},{"change":dir,"useMaxValue":false}];}if((Math.abs(min-this._slider.minimum)<1e-10&&dir<0)||(Math.abs(max-this._slider.maximum)<1e-10&&dir>0)){if(this._timer.isRunning){if(this.loop){this._timer.stop();this._setSliderValue(this._getSliderMinValue());var _98=this._sliderToTimeExtent();this.onTimeExtentChange(_98);this._timer.start();this.playing=true;}else{this.pause();}}}else{this._slider._bumpValue(_97);}},_updateThumbIndexes:function(){var val=this._getSliderValue();if(_2.isArray(val)){this.thumbIndexes[0]=this._toSliderIndex(val[0]);this.thumbIndexes[1]=this._toSliderIndex(val[1]);}else{this.thumbIndexes[0]=this._toSliderIndex(val);}},_sliderToTimeExtent:function(){if(!this.timeStops||this.timeStops.length===0){return;}var _99=new _1a();var val=this._getSliderValue();if(_2.isArray(val)){_99.startTime=new Date(this.timeStops[this._toSliderIndex(val[0])]);_99.endTime=new Date(this.timeStops[this._toSliderIndex(val[1])]);this._adjustTimeExtent(_99);}else{_99.startTime=(this._createTimeInstants===true)?new Date(this.timeStops[this._toSliderIndex(val)]):new Date(this.fullTimeExtent.startTime);_99.endTime=(this._createTimeInstants===true)?_99.startTime:new Date(this.timeStops[this._toSliderIndex(val)]);}return _99;},_adjustTimeExtent:function(_9a){if(this._options.excludeDataAtTrailingThumb===false&&this._options.excludeDataAtLeadingThumb===false){return;}if(_9a.startTime.getTime()===_9a.endTime.getTime()){return;}if(this._options.excludeDataAtTrailingThumb){var _9b=_9a.startTime;_9b.setUTCSeconds(_9b.getUTCSeconds()+1);}if(this._options.excludeDataAtLeadingThumb){var _9c=_9a.endTime;_9c.setUTCSeconds(_9c.getUTCSeconds()-1);}},_resetStartTime:function(_9d,_9e){switch(_9e){case "esriTimeUnitsSeconds":_9d.startTime.setUTCMilliseconds(0);break;case "esriTimeUnitsMinutes":_9d.startTime.setUTCSeconds(0,0,0);break;case "esriTimeUnitsHours":_9d.startTime.setUTCMinutes(0,0,0);break;case "esriTimeUnitsDays":_9d.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsWeeks":_9d.startTime.setUTCDate(_9d.startTime.getUTCDate()-_9d.startTime.getUTCDay());break;case "esriTimeUnitsMonths":_9d.startTime.setUTCDate(1);_9d.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsDecades":_9d.startTime.setUTCFullYear(_9d.startTime.getUTCFullYear()-(_9d.startTime.getUTCFullYear()%10));break;case "esriTimeUnitsCenturies":_9d.startTime.setUTCFullYear(_9d.startTime.getUTCFullYear()-(_9d.startTime.getUTCFullYear()%100));break;}},_getSliderMinValue:function(){if(this._isRangeSlider){return [this._slider.minimum,this._slider.minimum+this._offset];}else{return this._slider.minimum;}},_toSliderIndex:function(val){var idx=Math.floor((val-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum));if(idx<0){idx=0;}if(idx>=this._numStops){idx=this._numStops-1;}return idx;},_toSliderValue:function(val){return val*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum;},_getSliderValue:function(){return this._slider.get("value");},_setSliderValue:function(val){this._slider._setValueAttr(val,false,false);}});if(_5("extend-esri")){_2.setObject("dijit.HistogramTimeSlider",_1c,_18);}return _1c;});